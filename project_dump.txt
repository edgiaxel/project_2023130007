

=== FILE: app/Models\CatalogBanner.php ===

<?php

// app/Models/CatalogBanner.php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class CatalogBanner extends Model
{
    use HasFactory;
    
    protected $fillable = ['title', 'image_path', 'order'];
}

=== FILE: app/Models\Costume.php ===

<?php

// app/Models/Costume.php
namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;

class Costume extends Model
{
    use HasFactory, SoftDeletes; 

    protected $fillable = [
        'user_id',
        'name',
        'series',
        'size',
        'condition',
        'price_per_day',
        'stock',
        'main_image_path',
        'is_approved',
        'tags'
    ];

    protected $casts = [
        'tags' => 'array',
        'is_approved' => 'boolean',
    ];

    public function renter()
    {
        return $this->belongsTo(User::class, 'user_id');
    }
    
    public function orders()
    {
        return $this->hasMany(Order::class);
    }
}

=== FILE: app/Models\GlobalDiscount.php ===

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class GlobalDiscount extends Model
{
    protected $fillable = ['rate', 'is_active'];
    protected $casts = ['is_active' => 'boolean', 'rate' => 'float'];
}


=== FILE: app/Models\Order.php ===

<?php

// app/Models/Order.php
namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;

class Order extends Model
{
    use HasFactory, SoftDeletes; 

    protected $casts = [
        'start_date' => 'date', 
        'end_date' => 'date', 
    ];
    protected $fillable = [
        'order_code',
        'costume_id',
        'user_id',
        'start_date',
        'end_date',
        'total_price',
        'status'
    ];

    public function costume()
    {
        return $this->belongsTo(Costume::class);
    }

    public function user()
    {
        return $this->belongsTo(User::class); 
    }
}

=== FILE: app/Models\RenterStore.php ===

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;

class RenterStore extends Model
{
    use HasFactory;

    protected $fillable = [
        'user_id',
        'store_name',
        'description',
        'store_logo_path',
    ];

    public function user()
    {
        return $this->belongsTo(User::class);
    }
}

=== FILE: app/Models\User.php ===

<?php

namespace App\Models;

// use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Sanctum\HasApiTokens;
use Spatie\Permission\Traits\HasRoles;

class User extends Authenticatable
{
    /** @use HasFactory<\Database\Factories\UserFactory> */
    use HasApiTokens, HasFactory, Notifiable, HasRoles;

    public function costumes()
    {
        return $this->hasMany(Costume::class);
    }
    protected $fillable = [
        'name',
        'email',
        'password',
        'phone_number',
        'address',     
        'profile_picture',
    ];

    protected $hidden = [
        'password',
        'remember_token',
    ];

    protected function casts(): array
    {
        return [
            'email_verified_at' => 'datetime',
            'password' => 'hashed',
        ];
    }
    public function store()
    {
        return $this->hasOne(RenterStore::class);
    }

    public function renter()
    {
        return $this->belongsTo(User::class, 'user_id');
    }

    public function renterStore()
    {
        return $this->renter->store();
    }
}

=== FILE: app/Http/Controllers\AdminController.php ===

<?php

namespace App\Http\Controllers;

use App\Models\Costume;
use App\Models\Order;
use App\Models\User;
use App\Models\GlobalDiscount;
use App\Models\CatalogBanner;
use Illuminate\Http\Request;
use Carbon\Carbon;
use Illuminate\Support\Facades\DB;
use Illuminate\View\View;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Redirect;
use Illuminate\Http\RedirectResponse;
use Illuminate\Support\Facades\Storage;
use Illuminate\Validation\Rule;
use Spatie\Permission\Models\Role; // ADD THIS
use Spatie\Permission\Models\Permission; // ADD THIS

class AdminController extends Controller
{
    public function dashboard(): View
    {
        // 1. GLOBAL KPIs
        $totalCostumes = Costume::where('is_approved', true)->count();
        $totalRenters = User::role('renter')->count();
        $totalUsers = User::role('user')->count();
        $pendingApprovals = Costume::where('is_approved', false)->count();
        $totalRevenue = Order::where('status', 'completed')->sum('total_price');

        // 2. RENTER ANALYTICS SUMMARY (for chart/table data)
        $renterSummaries = User::role('renter')->withCount('costumes')->get()->map(function ($renter) {
            $revenue = Order::whereHas('costume', fn($q) => $q->where('user_id', $renter->id))
                ->where('status', 'completed')
                ->sum('total_price');
            $renter->revenue = $revenue;
            $renter->top_costume = $renter->costumes->first()->name ?? 'N/A';
            return $renter;
        })->sortByDesc('revenue')->take(5);

        // 3. Global Discount Status
        $globalDiscount = GlobalDiscount::first() ?? new GlobalDiscount(['rate' => 0, 'is_active' => false]);

        return view('admin.dashboard', compact(
            'totalCostumes',
            'totalRenters',
            'totalUsers',
            'pendingApprovals',
            'totalRevenue',
            'renterSummaries',
            'globalDiscount'
        ));
    }

    /**
     * Detailed Analytics view for a specific Renter.
     */
    public function viewRenterAnalytics(int $userId): View
    {
        $renter = User::findOrFail($userId);
        $store = $renter->store;

        // 1. Costumes and Sales Count
        $costumes = $renter->costumes()->withCount(['orders' => fn($q) => $q->whereIn('status', ['completed', 'borrowed'])])->get();
        $totalRevenue = $costumes->sum(fn($c) => $c->orders_count * $c->price_per_day); // Simplified revenue estimate

        // 2. Monthly Revenue Data
        $monthlyData = [
            (object) ['month' => 'Jan', 'sales' => 500000],
            (object) ['month' => 'Feb', 'sales' => 750000],
            (object) ['month' => 'Mar', 'sales' => 600000],
            (object) ['month' => 'Apr', 'sales' => 1200000],
        ];

        return view('admin.renter_analytics', compact('renter', 'store', 'costumes', 'monthlyData', 'totalRevenue'));
    }
    public function approvalQueue(): View
    {
        $pendingCostumes = Costume::where('is_approved', false)
            ->with('renter.store')
            ->orderBy('created_at', 'asc')
            ->get();

        $allCostumes = Costume::with('renter.store')->get();

        return view('admin.costume_approval', compact('pendingCostumes', 'allCostumes'));
    }

    public function manageUsers(): View
    {
        $users = User::whereHas('roles', fn($q) => $q->whereIn('name', ['renter', 'user']))->with('roles', 'store')->get();
        return view('admin.manage_users', compact('users'));
    }

    public function monitorTransactions(): View
    {
        $orders = Order::with(['costume.renter', 'user'])->latest()->get();

        return view('admin.monitor_transactions', compact('orders'));
    }

    public function manageCostumes(): View
    {
        $costumes = Costume::with('renter.store')->orderBy('created_at', 'desc')->get();
        return view('admin.manage_costumes', compact('costumes'));
    }

    public function manageDiscounts(): View
    {
        $globalDiscount = GlobalDiscount::first() ?? new GlobalDiscount(['rate' => 0, 'is_active' => false]);
        // Ideally fetch costume-specific discounts here too
        return view('admin.manage_discounts', compact('globalDiscount'));
    }
    public function setGlobalDiscount(Request $request): RedirectResponse
    {
        $validated = $request->validate([
            'rate' => 'required|numeric|min:0|max:100',
            'is_active' => 'nullable|boolean',
        ]);

        GlobalDiscount::updateOrCreate(
            ['id' => 1],
            [
                'rate' => $validated['rate'] / 100,
                'is_active' => $request->has('is_active'),
            ]
        );

        return redirect()->route('admin.discounts.manage')->with('status', 'Global flash sale updated.');
    }

    public function manageBanners(): View
    {
        $banners = CatalogBanner::orderBy('order')->get();
        return view('admin.manage_banners', compact('banners'));
    }

    /**
     * Handle Banner Image and Title updates.
     */
    public function updateBanner(Request $request, int $bannerId): RedirectResponse
    {
        $banner = CatalogBanner::findOrFail($bannerId);

        $validated = $request->validate([
            'title' => 'required|string|max:255',
            'image_file' => 'nullable|image|mimes:jpeg,png,jpg|max:3048',
        ]);

        $imagePath = $banner->image_path;

        if ($request->hasFile('image_file')) {
            if ($imagePath && Storage::disk('public')->exists($imagePath)) {
                Storage::disk('public')->delete($imagePath);
            }
            $imagePath = $request->file('image_file')->store('banners', 'public');
        }

        $banner->update([
            'title' => $validated['title'],
            'image_path' => $imagePath,
        ]);

        return redirect()->route('admin.banners.manage')->with('status', 'Banner updated successfully!');
    }

    /**
     * Show list of all Renters/Stores for management.
     */
    public function manageRenterStores(): View
    {
        $renters = User::role('renter')->with('store')->withCount('costumes')->get();
        return view('admin.manage_stores', compact('renters'));
    }

    /**
     * Show detailed view of a single Renter's Store, including their costumes.
     */
    public function viewRenterStoreDetails(int $userId): View
    {
        $renter = User::role('renter')
            ->where('id', $userId)
            ->with(['store', 'costumes' => fn($q) => $q->withCount('orders')])
            ->firstOrFail();

        return view('admin.view_store_details', compact('renter'));
    }

    /**
     * Show the profile edit form for a specific user (accessible only by Admin).
     */
    public function editUser(int $userId): View
    {
        $user = User::with('store')->findOrFail($userId);
        $isAdminView = true;

        return view('admin.edit_user_profile', compact('user', 'isAdminView'));
    }

    /**
     * Handle updating another user's profile information (accessible only by Admin).
     */
    public function updateUser(Request $request, int $userId): RedirectResponse
    {
        // 1. Fetch user and validate input
        $user = User::findOrFail($userId);
        $validatedData = $request->validate([
            'name' => ['required', 'string', 'max:255'],
            'email' => ['required', 'string', 'email', 'max:255', 'unique:users,email,' . $userId],
            'phone_number' => ['nullable', 'string', 'max:20'],
            'address' => ['nullable', 'string', 'max:500'],
            'profile_picture' => ['nullable', 'image', 'mimes:jpeg,png,jpg', 'max:2048'],
        ]);

        // 2. Handle Profile Picture Upload (reusing logic from ProfileController)
        $profilePicPath = $user->profile_picture;
        if ($request->hasFile('profile_picture')) {
            if ($profilePicPath && Storage::disk('public')->exists($profilePicPath)) {
                Storage::disk('public')->delete($profilePicPath);
            }
            $profilePicPath = $request->file('profile_picture')->store('user_profiles', 'public');
        }
        $validatedData['profile_picture'] = $profilePicPath;

        // 3. Update the user
        $user->update($validatedData);

        return redirect()->route('admin.users')->with('status', $user->name . ' profile updated successfully.');
    }

    /**
     * Sets the approval status of a costume (Admin action).
     */
    public function setCostumeApproval(Request $request, int $costume_id): RedirectResponse
    {
        $costume = Costume::findOrFail($costume_id);

        $validated = $request->validate([
            'action' => ['required', 'in:approve,reject'],
            'notes' => ['nullable', 'string', 'max:500'],
        ]);

        if ($validated['action'] === 'approve') {
            $costume->is_approved = true;
            $message = 'Costume "' . $costume->name . '" has been **APPROVED** and is now live!';
        } else {
            $costume->is_approved = false;
            // NOTE: We do not soft delete/remove on rejection, we just keep is_approved=false
            $message = 'Costume "' . $costume->name . '" has been **REJECTED**. Notes: ' . ($validated['notes'] ?? 'None provided.');
        }
    
        $costume->save();
    
        return Redirect::route('admin.costumes.approval')->with('status', $message);
    }

    /**
     * Updates the role of a user (Admin action).
     */
    /**
     * Updates the role of a user (Admin action).
     */
    public function updateRole(Request $request, int $userId): RedirectResponse
    {
        $userToUpdate = User::findOrFail($userId);
        $currentUser = Auth::user();

        // 1. Core Security Checks
        if ($currentUser->id === $userToUpdate->id) {
            return Redirect::back()->withErrors(['role_error' => 'ERROR: You cannot modify your own role while logged in.']);
        }

        // **NEW CRITICAL CHECK: OWNER PERMISSION**
        if (!$currentUser->hasPermissionTo('user:manage-roles')) {
            // If they can't manage all roles, they can't touch Admin or Owner accounts.
            if ($userToUpdate->hasAnyRole(['admin', 'owner']) || $request->input('role_name') === 'owner' || $request->input('role_name') === 'admin') {
                return Redirect::back()->withErrors(['role_error' => 'ACCESS DENIED: You lack the cosmic clearance to manage this role. Only the true Owner can touch Admin/Owner accounts.']);
            }
        }

        // This is where we ensure only allowed roles are selected.
        // The previous AdminController.php code handled this with a Rule::in(['owner', 'admin', 'renter', 'user'])
        // but the core logic for WHO can update WHO is above.

        $validated = $request->validate([
            'role_name' => ['required', Rule::in(['owner', 'admin', 'renter', 'user'])],
        ]);

        $newRole = $validated['role_name'];

        // 2. Perform Role Sync
        $userToUpdate->syncRoles([$newRole]);

        return Redirect::route('admin.users')->with('status', $userToUpdate->name . ' role updated to ' . ucfirst($newRole) . '.');
    }

    // Add this new method:
    /**
     * Show the Spatie Permission/Role editing form for a specific user (Owner-only).
     */
    public function editUserPermissions(int $userId): View
    {
        // Owner Check is done by the route middleware, but safety first, idiot.
        if (!Auth::user()->hasRole('owner')) {
            abort(403, 'Permission denied. Only the ultimate cosmic being can edit permissions.');
        }

        $userToEdit = User::with('roles', 'permissions')->findOrFail($userId);

        // Fetch all roles except 'owner' (don't let them demote the owner via the dropdown)
        $roles = Role::where('name', '!=', 'owner')->get();

        // Fetch all permissions for the checkboxes
        $allPermissions = Permission::all()->sortBy('name');

        // Permissions currently held by the user (directly and via roles)
        $currentPermissions = $userToEdit->getAllPermissions()->pluck('name')->toArray();

        return view('admin.owner.edit_user_permissions', compact('userToEdit', 'roles', 'allPermissions', 'currentPermissions'));
    }

    /**
     * Handles updating the user's role and direct permissions (Owner-only).
     */
    public function syncUserPermissions(Request $request, int $userId): RedirectResponse
    {
        // Owner Check
        if (!Auth::user()->hasRole('owner')) {
            abort(403, 'Permission denied. You are not the chosen one.');
        }

        $userToUpdate = User::findOrFail($userId);

        // Can't edit yourself
        if (Auth::id() === $userToUpdate->id) {
            return Redirect::back()->withErrors(['error' => 'You cannot modify your own roles/permissions while logged in.']);
        }

        // 1. Validate Input
        $validated = $request->validate([
            // Role can be 'owner', 'admin', 'renter', 'user'
            'role_name' => ['required', Rule::in(Role::pluck('name')->toArray())],
            // Permissions array
            'permissions' => ['nullable', 'array'],
            'permissions.*' => ['exists:permissions,name'],
        ]);

        // 2. Sync Role
        $userToUpdate->syncRoles([$validated['role_name']]);

        // 3. Sync Direct Permissions
        // NOTE: We only sync direct permissions here. Role permissions are handled by Spatie automatically.
        $userToUpdate->syncPermissions($validated['permissions'] ?? []);

        return Redirect::route('admin.users')->with('status', $userToUpdate->name . ' roles and permissions have been brutally overridden.');
    }

    /**
     * Handle updating another Renter's Store details (Admin/Owner action).
     * Reuses the validation logic from ProfileController but targets a specific user.
     */
    public function updateRenterStoreDetails(Request $request, int $userId): RedirectResponse
    {
        $renter = User::role('renter')->with('store')->findOrFail($userId);

        $validatedStore = $request->validate([
            'store_name' => [
                'required',
                'string',
                'max:255',
                // Ignore the current user's ID for the unique check
                Rule::unique(\App\Models\RenterStore::class)->ignore($userId, 'user_id')
            ],
            'description' => ['nullable', 'string', 'max:1000'],
            'store_logo' => ['nullable', 'image', 'mimes:jpeg,png,jpg', 'max:2048'],
        ]);

        $store = $renter->store ?? new \App\Models\RenterStore(['user_id' => $renter->id]);

        $logoPath = $store->store_logo_path;
        if ($request->hasFile('store_logo')) {
            if ($logoPath && Storage::disk('public')->exists($logoPath)) {
                Storage::disk('public')->delete($logoPath);
            }
            $logoPath = $request->file('store_logo')->store('store_logos', 'public');
        }

        $store->updateOrCreate(
            ['user_id' => $renter->id],
            [
                'store_name' => $validatedStore['store_name'],
                'description' => $validatedStore['description'],
                'store_logo_path' => $logoPath,
            ]
        );

        return Redirect::route('admin.stores.view', $renter->id)->with('status', 'Store profile for ' . $renter->name . ' updated successfully by Admin.');
    }
}

=== FILE: app/Http/Controllers\CatalogController.php ===

<?php

// app/Http/Controllers/CatalogController.php

namespace App\Http\Controllers;

use App\Models\Costume;
use App\Models\User; // We need the User model for searching stores/users
use Illuminate\Http\Request;
use App\Models\CatalogBanner;

class CatalogController extends Controller
{
    public function index(Request $request)
    {
        $searchQuery = $request->query('search');
        $perPage = $request->input('per_page', 10);
        $perPageOptions = [10, 25, 50];
        $DISCOUNT_RATE = 0.15;

        $MEDIA_CATEGORIES = ['Anime', 'Movie', 'Game', 'TV', 'Other'];

        $costumesQuery = Costume::query();

        // 1. Apply Search Filter
        if ($searchQuery) {
            $costumesQuery->where(function ($query) use ($searchQuery) {
                $query->where('name', 'like', '%' . $searchQuery . '%')
                    ->orWhere('series', 'like', '%' . $searchQuery . '%')
                    ->orWhereJsonContains('tags', $searchQuery);
            });
        }

        // 2. Fetch all approved costumes with relationships and apply discount
        $costumesCollection = $costumesQuery->where('is_approved', true)
            ->with(['renter.store'])
            ->get()
            ->map(function ($costume) use ($DISCOUNT_RATE) {
                $costume->is_on_sale = true;
                $costume->original_price = $costume->price_per_day;
                $costume->discounted_price = $costume->price_per_day * (1 - $DISCOUNT_RATE);

                $costume->media_group = $costume->tags[0] ?? 'Other';

                return $costume;
            });

        // 3. Manual Pagination
        $currentPage = \Illuminate\Pagination\LengthAwarePaginator::resolveCurrentPage();
        $currentItems = $costumesCollection->slice(($currentPage - 1) * $perPage, $perPage)->all();
        $costumesPaginated = new \Illuminate\Pagination\LengthAwarePaginator(
            $currentItems,
            $costumesCollection->count(),
            $perPage,
            $currentPage,
            ['path' => \Illuminate\Pagination\LengthAwarePaginator::resolveCurrentPath(), 'query' => $request->query()]
        );

        // 4. Group the entire collection by the explicit media type
        $groupedCostumes = $costumesCollection->groupBy('media_group');

        // 5. Redirection logic (omitted)
        $banners = CatalogBanner::orderBy('order')->get(); // <-- NEW

        return view('catalog', compact('costumesCollection', 'costumesPaginated', 'perPage', 'perPageOptions', 'MEDIA_CATEGORIES', 'DISCOUNT_RATE', 'groupedCostumes', 'banners'));
    }
}

=== FILE: app/Http/Controllers\Controller.php ===

<?php

namespace App\Http\Controllers;

abstract class Controller
{
    //
}


=== FILE: app/Http/Controllers\CostumeController.php ===

<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use App\Models\Costume;
use Illuminate\Support\Facades\Storage; // REQUIRED FOR FILE MANAGEMENT
use Illuminate\Http\RedirectResponse;
use Illuminate\Support\Facades\Validator;
use Illuminate\View\View;
use Illuminate\Support\Facades\Redirect;

class CostumeController extends Controller
{
    /**
     * Display a listing of the costumes owned by the current renter.
     */
    public function index()
    {
        $costumes = Auth::user()->costumes()->withCount('orders')->get();

        return view('renter.manage_costumes', compact('costumes'));
    }

    /**
     * Handle the incoming request to store a newly uploaded costume.
     */
    public function store(Request $request): RedirectResponse
    {
        $validated = $request->validate([
            'character_name' => ['required', 'string', 'max:255'],
            'media_series' => ['required', 'string', 'max:255'],
            'size' => ['required', 'string', 'max:50'],
            'condition' => ['required', 'in:new,excellent,good,worn'],
            'price' => ['required', 'integer', 'min:1000'],
            'stock' => ['required', 'integer', 'min:1', 'max:99'],
            'tags' => ['required', 'string'],
            'images' => ['required', 'array', 'max:1'], // Only allowing one image for the 'main_image_path' for now
            'images.*' => ['image', 'mimes:jpeg,png,jpg', 'max:4096'],
        ]);

        // 1. Handle Image Upload
        $mainImagePath = null;
        if ($request->hasFile('images')) {
            $mainImagePath = $request->file('images')[0]->store('costumes', 'public');
        }

        // 2. Create Costume
        Costume::create([
            'user_id' => Auth::id(),
            'name' => $validated['character_name'],
            'series' => $validated['media_series'],
            'size' => $validated['size'],
            'condition' => $validated['condition'],
            'price_per_day' => $validated['price'],
            'stock' => $validated['stock'],
            'tags' => explode(',', $validated['tags']), // Store as JSON array
            'main_image_path' => $mainImagePath,
            'is_approved' => false, // Requires Admin Approval!
        ]);

        return Redirect::route('renter.costumes.manage')->with('status', 'Costume submitted! Awaiting Admin approval.');
    }

    /**
     * Show the form for editing the specified costume.
     */
    public function edit(int $costume_id): View
    {
        $costume = Costume::where('user_id', Auth::id())
            ->findOrFail($costume_id);

        return view('renter.edit_costume', compact('costume'));
    }

    /**
     * Update the specified costume in storage.
     */
    public function update(Request $request, int $costume_id): RedirectResponse
    {
        $costume = Costume::where('user_id', Auth::id())->findOrFail($costume_id);

        $validated = $request->validate([
            'character_name' => ['required', 'string', 'max:255'],
            'media_series' => ['required', 'string', 'max:255'],
            'size' => ['required', 'string', 'max:50'],
            'condition' => ['required', 'in:new,excellent,good,worn'],
            'price' => ['required', 'integer', 'min:1000'],
            'stock' => ['required', 'integer', 'min:1', 'max:99'],
            'tags' => ['required', 'string'],
            'main_image' => ['nullable', 'image', 'mimes:jpeg,png,jpg', 'max:4096'], // Single image replacement
        ]);

        // 1. Handle Image Replacement
        $mainImagePath = $costume->main_image_path;
        if ($request->hasFile('main_image')) {
            // Delete old file if it exists
            if ($mainImagePath && Storage::disk('public')->exists($mainImagePath)) {
                Storage::disk('public')->delete($mainImagePath);
            }
            $mainImagePath = $request->file('main_image')->store('costumes', 'public');
        }

        // 2. Update Costume
        $costume->update([
            'name' => $validated['character_name'],
            'series' => $validated['media_series'],
            'size' => $validated['size'],
            'condition' => $validated['condition'],
            'price_per_day' => $validated['price'],
            'stock' => $validated['stock'],
            'tags' => explode(',', $validated['tags']),
            'main_image_path' => $mainImagePath,
            'is_approved' => $costume->is_approved, // Maintain current approval status on edit
        ]);

        return Redirect::route('renter.costumes.manage')->with('status', $costume->name . ' updated successfully!');
    }

    /**
     * Soft Delete the specified costume.
     */
    public function destroy(int $costume_id): RedirectResponse
    {
        $costume = Costume::where('user_id', Auth::id())->findOrFail($costume_id);

        // Soft Delete (uses SoftDeletes trait)
        $costume->delete();

        return Redirect::route('renter.costumes.manage')->with('status', $costume->name . ' moved to trash (soft deleted).');
    }
}

=== FILE: app/Http/Controllers\OrderController.php ===

<?php

namespace App\Http\Controllers;

use App\Models\Costume;
use App\Models\Order;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Redirect;
use Carbon\Carbon;
use Illuminate\Http\RedirectResponse;
use Illuminate\View\View;   

class OrderController extends Controller
{
    public function createOrder(int $costumeId)
    {
        $costume = Costume::findOrFail($costumeId);
        return view('user.place_order', [
            'costume' => $costume,
        ]);
    }

    public function storeOrder(Request $request): RedirectResponse
    {
        // 1. Validation.
        $request->validate([
            'costume_id' => 'required|exists:costumes,id',
            'start_date' => 'required|date|after_or_equal:today',
            'end_date' => 'required|date|after_or_equal:start_date',
        ]);

        // 2. Fetch the Costume
        $costume = Costume::findOrFail($request->costume_id);

        if ($costume->stock < 1) {
            return Redirect::back()->withErrors(['stock_error' => 'This costume is currently out of stock. Maybe pick something else?']);
        }

        $existingActiveOrder = Order::where('user_id', Auth::id())
            ->where('costume_id', $costume->id)
            ->whereIn('status', ['waiting', 'confirmed', 'borrowed'])
            ->exists();

        if ($existingActiveOrder) {
            return Redirect::back()->withErrors(['stock_error' => 'You already have an active rental or pending order for this specific costume.']);
        }

        // 3. Calculate the dynamic price
        $startDate = Carbon::parse($request->start_date);
        $endDate = Carbon::parse($request->end_date);

        $durationInDays = $startDate->diffInDays($endDate) + 1;
        $totalPrice = $costume->price_per_day * $durationInDays;

        // 4. Create a unique Order Code 
        $orderCode = 'ORD-' . now()->year . now()->format('md') . Auth::id() . rand(100, 999);

        // 5. Create the Order
        $order = Order::create([
            'order_code' => $orderCode,
            'costume_id' => $costume->id,
            'user_id' => Auth::id(),
            'start_date' => $startDate,
            'end_date' => $endDate,
            'total_price' => $totalPrice,
            'status' => 'waiting',
        ]);

        // 6. DECREMENT the stock count
        $costume->decrement('stock');

        // 7. Redirect the user
        return Redirect::route('user.orders')->with('status', 'Order placed successfully! Renter is being notified.');
    }

    /**
     * Confirms a pending order and updates stock availability status.
     * Accessible by RENTER and ADMIN.
     */
    public function confirm(Request $request, int $order_id): RedirectResponse
    {
        $order = Order::with('costume')->findOrFail($order_id);

        // Security Check: Only the associated Renter or Admin can confirm
        if (Auth::id() !== $order->costume->user_id && !Auth::user()->hasRole('admin')) {
            return Redirect::back()->withErrors(['auth_error' => 'You do not have cosmic clearance to confirm this order.']);
        }

        if ($order->status === 'waiting') {
            $order->status = 'confirmed';
            $order->save();
            return Redirect::route('renter.orders')->with('status', 'Order confirmed! Waiting for pickup/shipment.');
        }

        return Redirect::back()->withErrors(['status_error' => 'Order cannot be confirmed from its current status.']);
    }

    /**
     * Rejects a pending order and increments the stock back up.
     * Accessible by RENTER and ADMIN.
     */
    public function reject(Request $request, int $order_id): RedirectResponse
    {
        $order = Order::with('costume')->findOrFail($order_id);

        if (Auth::id() !== $order->costume->user_id && !Auth::user()->hasRole('admin')) {
            return Redirect::back()->withErrors(['auth_error' => 'You do not have cosmic clearance to reject this order.']);
        }

        if ($order->status === 'waiting') {
            $order->status = 'rejected';
            $order->save();

            // Stock Management: Return stock when order is rejected
            $order->costume->increment('stock');

            return Redirect::route('renter.orders')->with('status', 'Order rejected! Stock restored.');
        }

        return Redirect::back()->withErrors(['status_error' => 'Only waiting orders can be rejected.']);
    }

    /**
     * Generic status update for ongoing orders (e.g., Mark as Borrowed or Returned).
     * Accessible by RENTER and ADMIN.
     */
    public function updateStatus(Request $request, int $order_id): RedirectResponse
    {
        $order = Order::with('costume')->findOrFail($order_id);

        $newStatus = $request->input('new_status');
        $allowedStatuses = ['borrowed', 'returned', 'completed']; // Allowed status transitions

        if (Auth::id() !== $order->costume->user_id && !Auth::user()->hasRole('admin')) {
            return Redirect::back()->withErrors(['auth_error' => 'You lack the authorization to update this status.']);
        }

        if (!in_array($newStatus, $allowedStatuses)) {
            return Redirect::back()->withErrors(['status_error' => 'Invalid status provided.']);
        }

        // Handle Stock Return (Completed/Returned status)
        if (in_array($newStatus, ['returned', 'completed']) && $order->status !== 'returned' && $order->status !== 'completed') {
            // Only return stock once, after it has been borrowed/confirmed
            $order->costume->increment('stock');
            $message = 'Order marked as returned and stock restored.';
        } else {
            $message = 'Order status updated successfully.';
        }

        $order->status = $newStatus;
        $order->save();

        return Redirect::route('renter.orders')->with('status', $message);
    }

    /**
     * Show the detailed view of an order (Admin, Renter, or Customer view).
     */
    public function viewDetail(int $order_id): View
    {
        // Load order and necessary relationships
        $order = Order::with(['costume.renter.store', 'user'])->findOrFail($order_id);
        
        // Authorization Check: Must be Admin, or the Customer who placed it, or the Renter who owns the costume.
        if (Auth::user()->hasRole('admin') || Auth::id() === $order->user_id || Auth::id() === $order->costume->user_id) {
            return view('order.detail', compact('order'));
        }

        // SCREAM at unauthorized access
        abort(403, 'Unauthorized access to order details!');
    }
}

=== FILE: app/Http/Controllers\ProfileController.php ===

<?php

namespace App\Http\Controllers;

use App\Http\Requests\ProfileUpdateRequest;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Redirect;
use Illuminate\View\View;
use App\Models\RenterStore;
use Illuminate\Validation\Rule;
use Illuminate\Support\Facades\Storage;


class ProfileController extends Controller
{
    public function edit(Request $request): View
    {
        return view('profile.edit', [
            'user' => $request->user(),
        ]);
    }

    public function update(ProfileUpdateRequest $request): RedirectResponse
    {
        $user = $request->user();

        $user->fill($request->validated());

        $profilePicPath = $user->profile_picture;
        if ($request->hasFile('profile_picture')) {
            if ($profilePicPath && Storage::disk('public')->exists($profilePicPath)) {
                Storage::disk('public')->delete($profilePicPath);
            }
            $profilePicPath = $request->file('profile_picture')->store('user_profiles', 'public');
        }
        $user->profile_picture = $profilePicPath;

        if ($user->isDirty('email')) {
            $user->email_verified_at = null;
        }

        $user->save();

        return Redirect::route('profile.edit')->with('status', 'profile-updated');
    }
    public function destroy(Request $request): RedirectResponse
    {
        $request->validateWithBag('userDeletion', [
            'password' => ['required', 'current_password'],
        ]);

        $user = $request->user();

        Auth::logout();

        $user->delete();

        $request->session()->invalidate();
        $request->session()->regenerateToken();

        return Redirect::to('/');
    }

    public function updateRenterStore(Request $request): RedirectResponse
    {
        $validatedStore = $request->validate([
            'store_name' => [
                'required',
                'string',
                'max:255',
                Rule::unique(RenterStore::class)->ignore(Auth::id(), 'user_id')
            ],
            'description' => ['nullable', 'string', 'max:1000'],
            'store_logo' => ['nullable', 'image', 'mimes:jpeg,png,jpg', 'max:2048'], 
        ]);

        $user = $request->user();

        $logoPath = $user->store->store_logo_path ?? null;
        if ($request->hasFile('store_logo')) {
            if ($logoPath && Storage::disk('public')->exists($logoPath)) {
                Storage::disk('public')->delete($logoPath);
            }
            $logoPath = $request->file('store_logo')->store('store_logos', 'public'); 
        }

        RenterStore::updateOrCreate(
            ['user_id' => $user->id],
            [
                'store_name' => $validatedStore['store_name'],
                'description' => $validatedStore['description'],
                'store_logo_path' => $logoPath,
            ]
        );
        return Redirect::route('profile.edit')->with('status', 'renter-store-updated');
    }

    public function editRenterStore(Request $request): View
    {
        return view('renter.store_profile_setup', [
            'user' => $request->user(),
            'store' => $request->user()->store ?? new RenterStore(),
        ]);
    }
}


=== FILE: app/Http/Controllers\UserOrderController.php ===

<?php

namespace App\Http\Controllers;

use App\Models\Order;
use Illuminate\Support\Facades\Auth;
use Illuminate\View\View;

class UserOrderController extends Controller
{
    /**
     * Display the user's order tracking page with all their orders.
     */
    public function index(): View
    {
        $orders = Order::where('user_id', Auth::id())
            ->with(['costume.renter', 'user'])
            ->latest()
            ->get();
        
        return view('user.track_orders', compact('orders'));
    }
}

=== FILE: app/Http/Controllers\Auth\AuthenticatedSessionController.php ===

<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use App\Http\Requests\Auth\LoginRequest;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\View\View;

class AuthenticatedSessionController extends Controller
{
    public function create(): View
    {
        return view('auth.login');
        
    }

    public function store(LoginRequest $request): RedirectResponse
    {
        $request->authenticate();

        $request->session()->regenerate();

        return redirect()->intended(route('dashboard', absolute: false));

        
    }

    public function destroy(Request $request): RedirectResponse
    {
        Auth::guard('web')->logout();

        $request->session()->invalidate();

        $request->session()->regenerateToken();

        return redirect('/');
    }
    public function rules(): array
    {
        return [
            'email' => ['required', 'string', 'email'],
            'password' => ['required', 'string'],
            'captcha' => ['required', 'captcha'],
        ];
    }
    
}


=== FILE: app/Http/Controllers\Auth\ConfirmablePasswordController.php ===

<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Validation\ValidationException;
use Illuminate\View\View;

class ConfirmablePasswordController extends Controller
{
    /**
     * Show the confirm password view.
     */
    public function show(): View
    {
        return view('auth.confirm-password');
    }

    /**
     * Confirm the user's password.
     */
    public function store(Request $request): RedirectResponse
    {
        if (! Auth::guard('web')->validate([
            'email' => $request->user()->email,
            'password' => $request->password,
        ])) {
            throw ValidationException::withMessages([
                'password' => __('auth.password'),
            ]);
        }

        $request->session()->put('auth.password_confirmed_at', time());

        return redirect()->intended(route('dashboard', absolute: false));
    }
}


=== FILE: app/Http/Controllers\Auth\EmailVerificationNotificationController.php ===

<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;

class EmailVerificationNotificationController extends Controller
{
    /**
     * Send a new email verification notification.
     */
    public function store(Request $request): RedirectResponse
    {
        if ($request->user()->hasVerifiedEmail()) {
            return redirect()->intended(route('dashboard', absolute: false));
        }

        $request->user()->sendEmailVerificationNotification();

        return back()->with('status', 'verification-link-sent');
    }
}


=== FILE: app/Http/Controllers\Auth\EmailVerificationPromptController.php ===

<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\View\View;

class EmailVerificationPromptController extends Controller
{
    /**
     * Display the email verification prompt.
     */
    public function __invoke(Request $request): RedirectResponse|View
    {
        return $request->user()->hasVerifiedEmail()
                    ? redirect()->intended(route('dashboard', absolute: false))
                    : view('auth.verify-email');
    }
}


=== FILE: app/Http/Controllers\Auth\NewPasswordController.php ===

<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use App\Models\User;
use Illuminate\Auth\Events\PasswordReset;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Facades\Password;
use Illuminate\Support\Str;
use Illuminate\Validation\Rules;
use Illuminate\View\View;

class NewPasswordController extends Controller
{
    /**
     * Display the password reset view.
     */
    public function create(Request $request): View
    {
        return view('auth.reset-password', ['request' => $request]);
    }

    /**
     * Handle an incoming new password request.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function store(Request $request): RedirectResponse
    {
        $request->validate([
            'token' => ['required'],
            'email' => ['required', 'email'],
            'password' => ['required', 'confirmed', Rules\Password::defaults()],
        ]);

        // Here we will attempt to reset the user's password. If it is successful we
        // will update the password on an actual user model and persist it to the
        // database. Otherwise we will parse the error and return the response.
        $status = Password::reset(
            $request->only('email', 'password', 'password_confirmation', 'token'),
            function (User $user) use ($request) {
                $user->forceFill([
                    'password' => Hash::make($request->password),
                    'remember_token' => Str::random(60),
                ])->save();

                event(new PasswordReset($user));
            }
        );

        // If the password was successfully reset, we will redirect the user back to
        // the application's home authenticated view. If there is an error we can
        // redirect them back to where they came from with their error message.
        return $status == Password::PASSWORD_RESET
                    ? redirect()->route('login')->with('status', __($status))
                    : back()->withInput($request->only('email'))
                        ->withErrors(['email' => __($status)]);
    }
}


=== FILE: app/Http/Controllers\Auth\PasswordController.php ===

<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\Rules\Password;

class PasswordController extends Controller
{
    /**
     * Update the user's password.
     */
    public function update(Request $request): RedirectResponse
    {
        $validated = $request->validateWithBag('updatePassword', [
            'current_password' => ['required', 'current_password'],
            'password' => ['required', Password::defaults(), 'confirmed'],
        ]);

        $request->user()->update([
            'password' => Hash::make($validated['password']),
        ]);

        return back()->with('status', 'password-updated');
    }
}


=== FILE: app/Http/Controllers\Auth\PasswordResetLinkController.php ===

<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Password;
use Illuminate\View\View;

class PasswordResetLinkController extends Controller
{
    /**
     * Display the password reset link request view.
     */
    public function create(): View
    {
        return view('auth.forgot-password');
    }

    /**
     * Handle an incoming password reset link request.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function store(Request $request): RedirectResponse
    {
        $request->validate([
            'email' => ['required', 'email'],
        ]);

        // We will send the password reset link to this user. Once we have attempted
        // to send the link, we will examine the response then see the message we
        // need to show to the user. Finally, we'll send out a proper response.
        $status = Password::sendResetLink(
            $request->only('email')
        );

        return $status == Password::RESET_LINK_SENT
                    ? back()->with('status', __($status))
                    : back()->withInput($request->only('email'))
                        ->withErrors(['email' => __($status)]);
    }
}


=== FILE: app/Http/Controllers\Auth\RegisteredUserController.php ===

<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use App\Models\User;
use Illuminate\Auth\Events\Registered;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\Rules;
use Illuminate\View\View;

class RegisteredUserController extends Controller
{
    public function create(): View
    {
        return view('auth.register');
    }

    public function store(Request $request): RedirectResponse
    {
        
        $request->validate([
            'name' => ['required', 'string', 'max:255'],
            'email' => ['required', 'string', 'email', 'max:255', 'unique:' . User::class],
            'password' => ['required', 'confirmed', Rules\Password::defaults()],
            'captcha' => ['required', 'captcha'],
        ]);

        $user = User::create([
            'name' => $request->name,
            'email' => $request->email,
            'password' => Hash::make($request->password),
        ]);

        $role = $request->role_type ?? 'user';

        if ($role === 'renter') {
            $user->assignRole('renter');
        } else {
            $user->assignRole('user');
        }

        event(new Registered($user));

        Auth::login($user);

        return redirect(route('dashboard', absolute: false));

        
    }
}

=== FILE: app/Http/Controllers\Auth\VerifyEmailController.php ===

<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Auth\Events\Verified;
use Illuminate\Foundation\Auth\EmailVerificationRequest;
use Illuminate\Http\RedirectResponse;
use Illuminate\Contracts\Auth\MustVerifyEmail;

class VerifyEmailController extends Controller
{
    /**
     * Mark the authenticated user's email address as verified.
     */
    public function __invoke(EmailVerificationRequest $request): RedirectResponse
    {
        if ($request->user()->hasVerifiedEmail()) {
            return redirect()->intended(route('dashboard', absolute: false).'?verified=1');
        }

        return redirect()->intended(route('dashboard', absolute: false).'?verified=1');
    }
}


=== FILE: resources/views\catalog.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Cosmic Catalog ðŸŒŒ <span class="text-indigo-400">Find Your Perfect Role!</span>
        </h2>

        {{-- Search Bar (Fixed at top for filter) --}}
        <div class="mt-4 flex justify-between items-center">
            <form method="GET" action="{{ route('catalog') }}" class="flex w-full max-w-lg mr-4">
                <input type="text" name="search" placeholder="Search by character, series, or any tag..."
                    class="bg-gray-700 border-indigo-500 rounded-l-md text-white px-3 py-2 w-full"
                    value="{{ request('search') }}">
                <button type="submit"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-r-md">
                    Search
                </button>
                @if (request('search'))
                    <a href="{{ route('catalog') }}"
                        class="ml-2 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md">
                        Reset
                    </a>
                @endif
            </form>
        </div>
    </x-slot>

    {{-- Main Content Starts --}}
    <div class="bg-gray-900 min-h-screen">
        <section id="sale-banner" class="max-w-7xl mx-auto sm:px-6 lg:px-8 py-6">
            <h3 class="text-2xl font-bold text-yellow-400 mb-4">ðŸš€ FLASH SALE ACTIVE: {{ $DISCOUNT_RATE * 100 }}% OFF
                ALL COSTUMES!</h3>

            <div x-data="{ current: 1, total: {{ $banners->count() }} }"
                x-init="setInterval(() => { current = (current % total) + 1 }, 5000)"
                class="relative overflow-hidden rounded-lg shadow-2xl">

                {{-- SLIDES CONTAINER --}}
                <div class="relative h-48">
                    @forelse ($banners as $banner)
                        @php
                            $imageUrl = $banner->image_path ? asset('storage/' . $banner->image_path) : asset('default_images/default_costume.png');
                        @endphp

                        <div x-show="current === {{ $banner->order }}" x-transition:enter.opacity x-transition:leave.opacity
                            class="absolute inset-0 w-full h-full bg-cover bg-center flex items-center justify-center text-4xl text-white font-extrabold transition duration-700"
                            style="background-image: url('{{ $imageUrl }}'); background-color: #2D3748; background-size: cover; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                            {{ $banner->title }}
                        </div>
                    @empty
                        <div
                            class="absolute inset-0 w-full h-full bg-gray-600 flex items-center justify-center text-xl text-white">
                            No Banners Set. Admin Fix This!</div>
                    @endforelse
                </div>

                {{-- Navigation Arrows --}}
                <button @click="current = current > 1 ? current - 1 : total"
                    class="absolute top-1/2 left-4 transform -translate-y-1/2 p-3 bg-black/50 hover:bg-black/80 text-white rounded-full transition z-20">
                    &lt;
                </button>
                <button @click="current = current < total ? current + 1 : 1"
                    class="absolute top-1/2 right-4 transform -translate-y-1/2 p-3 bg-black/50 hover:bg-black/80 text-white rounded-full transition z-20">
                    &gt;
                </button>
            </div>
        </section>

        {{-- CATEGORIZED CATALOGS SECTION --}}
        <section id="collections" class="py-12" style="background-color: #0d0d1f;">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <h3 class="text-3xl font-extrabold text-indigo-400 mb-8 border-b border-indigo-700 pb-2">ðŸ“š Featured
                    Collections</h3>

                @if (request('search'))
                    <h4 class="text-2xl font-bold text-gray-300 mb-6">Search Results for: "{{ request('search') }}"</h4>
                @endif

                @foreach ($MEDIA_CATEGORIES as $category)
                    @php
                        $categoryItems = $groupedCostumes[$category] ?? collect();
                    @endphp

                    @if ($categoryItems->isNotEmpty() && !request('search'))
                        <h4 class="text-2xl font-bold text-white mb-4 mt-8 pt-4 border-t border-gray-700">{{ $category }}
                            Costumes ({{ $categoryItems->count() }} items)</h4>
                    @endif

                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-12">
                        @forelse ($categoryItems->take(4) as $costume)
                            {{-- DYNAMIC COSTUME CARD --}}
                            <div
                                class="bg-gray-800 border border-indigo-700 shadow-xl rounded-lg overflow-hidden transition transform hover:scale-[1.02] duration-300 relative">

                                {{-- SALE BADGE --}}
                                @if ($costume->is_on_sale)
                                    <span
                                        class="absolute top-0 right-0 bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-bl-lg z-10">SALE!</span>
                                @endif

                                {{-- IMAGE DISPLAY & FALLBACK LOGIC --}}
                                @php
                                    $costumeImageUrl = $costume->main_image_path
                                        ? asset('storage/' . $costume->main_image_path)
                                        : asset('default_images/default_costume.png');
                                @endphp

                                <div class="h-48 overflow-hidden">
                                    <img src="{{ $costumeImageUrl }}" alt="{{ $costume->name }} costume"
                                        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                                        onerror="this.onerror=null; this.src='{{ asset('default_images/default_costume.png') }}';">
                                </div>


                                <div class="p-4">
                                    {{-- Title and Series --}}
                                    <h3 class="text-xl font-bold text-white truncate">{{ $costume->name }}</h3>
                                    <p class="text-gray-400 text-sm mb-1">Series: {{ $costume->series }}</p>

                                    {{-- RENTER LINK (STORE NAME & AVATAR) --}}
                                    <p class="text-gray-400 text-xs border-b border-gray-700 pb-2">
                                        Renter:
                                        <a href="{{ route('public.store', ['user_id' => $costume->user_id]) }}"
                                            class="text-pink-400 hover:text-pink-300 font-semibold flex items-center">

                                            @php
                                                $renter = $costume->renter;
                                                $storeName = $renter->store->store_name ?? $renter->name . ' Shop';
                                                $logoPath = $renter->store->store_logo_path ?? $renter->profile_picture;
                                                $avatarUrl = $logoPath
                                                    ? asset('storage/' . $logoPath)
                                                    : asset('default_images/default_avatar.png');
                                            @endphp

                                            <img src="{{ $avatarUrl }}" alt="{{ $storeName }} Logo"
                                                class="h-4 w-4 rounded-full object-cover mr-1"
                                                onerror="this.onerror=null; this.src='{{ asset('default_images/default_avatar.png') }}';">

                                            {{ $storeName }}
                                        </a>
                                    </p>

                                    {{-- PRICE DISPLAY (WITH DISCOUNT) --}}
                                    <p class="text-lg font-semibold text-green-400 mt-2 flex flex-col">
                                        <span class="text-xs text-gray-500 line-through">
                                            Rp {{ number_format($costume->original_price, 0, ',', '.') }} / Day
                                        </span>
                                        <span class="text-xl font-extrabold text-indigo-400">
                                            Rp {{ number_format($costume->discounted_price, 0, ',', '.') }} / Day
                                        </span>
                                    </p>

                                    {{-- Link to Costume Detail Page --}}
                                    <a href="{{ route('costume.detail', ['id' => $costume->id]) }}"
                                        class="mt-3 block text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 rounded">
                                        View & Rent Now!
                                    </a>
                                </div>
                            </div>
                        @empty
                            @if (!request('search'))
                                <p class="col-span-4 text-center text-gray-400 text-lg py-10">No cosmic threads categorized as
                                    {{ $category }} yet.</p>
                            @endif
                        @endforelse
                    </div>

                    @if (request('search'))
                        @break
                    @endif
                @endforeach

                {{-- Fallback for empty search results --}}
                @if (request('search') && $costumesPaginated->isEmpty())
                    <p class="col-span-4 text-center text-gray-400 text-lg py-10">No search results found for
                        "{{ request('search') }}" in the entire galaxy.</p>
                @endif
            </div>
        </section>

        {{-- ALL PRODUCTS SECTION --}}
        <section id="all-products" class="py-12" style="background-color: #1a0046;">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <h3 class="text-3xl font-extrabold text-yellow-400 mb-8 border-b border-yellow-700 pb-2">ðŸ“¦ All
                    Available Costumes</h3>

                {{-- PER PAGE DROPDOWN MOVED HERE --}}
                <div class="mb-6 flex justify-end">
                    <form method="GET" action="{{ route('catalog') }}#all-products"
                        class="flex items-center space-x-2 text-gray-400">
                        @if (request('search'))
                            <input type="hidden" name="search" value="{{ request('search') }}">
                        @endif

                        <label for="per_page" class="text-sm">Show:</label>
                        <select name="per_page" id="per_page" onchange="this.form.submit()"
                            class="bg-gray-700 border-indigo-500 rounded-md text-white text-sm py-2 px-3">
                            @foreach ($perPageOptions as $option)
                                <option value="{{ $option }}" @selected($option == $perPage)>
                                    {{ $option }}
                                </option>
                            @endforeach
                        </select>
                        <span class="text-sm">per page</span>
                    </form>
                </div>

                {{-- LIST ALL PAGINATED COSTUMES HERE --}}
                <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    @forelse ($costumesPaginated as $costume)
                        {{-- DYNAMIC COSTUME CARD (Copy-pasted from above for consistency) --}}
                        <div
                            class="bg-gray-800 border border-indigo-700 shadow-xl rounded-lg overflow-hidden transition transform hover:scale-[1.02] duration-300 relative">

                            {{-- SALE BADGE --}}
                            @if ($costume->is_on_sale)
                                <span
                                    class="absolute top-0 right-0 bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-bl-lg z-10">SALE!</span>
                            @endif

                            {{-- IMAGE DISPLAY & FALLBACK LOGIC --}}
                            @php
                                $costumeImageUrl = $costume->main_image_path
                                    ? asset('storage/' . $costume->main_image_path)
                                    : asset('default_images/default_costume.png');
                            @endphp

                            <div class="h-48 overflow-hidden">
                                <img src="{{ $costumeImageUrl }}" alt="{{ $costume->name }} costume"
                                    class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                                    onerror="this.onerror=null; this.src='{{ asset('default_images/default_costume.png') }}';">
                            </div>


                            <div class="p-4">
                                {{-- Title and Series --}}
                                <h3 class="text-xl font-bold text-white truncate">{{ $costume->name }}</h3>
                                <p class="text-gray-400 text-sm mb-1">Series: {{ $costume->series }}</p>

                                {{-- RENTER LINK (STORE NAME & AVATAR) --}}
                                <p class="text-gray-400 text-xs border-b border-gray-700 pb-2">
                                    Renter:
                                    <a href="{{ route('public.store', ['user_id' => $costume->user_id]) }}"
                                        class="text-pink-400 hover:text-pink-300 font-semibold flex items-center">

                                        @php
                                            $renter = $costume->renter;
                                            $storeName = $renter->store->store_name ?? $renter->name . ' Shop';
                                            $logoPath = $renter->store->store_logo_path ?? $renter->profile_picture;
                                            $avatarUrl = $logoPath
                                                ? asset('storage/' . $logoPath)
                                                : asset('default_images/default_avatar.png');
                                        @endphp

                                        <img src="{{ $avatarUrl }}" alt="{{ $storeName }} Logo"
                                            class="h-4 w-4 rounded-full object-cover mr-1"
                                            onerror="this.onerror=null; this.src='{{ asset('default_images/default_avatar.png') }}';">

                                        {{ $storeName }}
                                    </a>
                                </p>

                                {{-- PRICE DISPLAY (WITH DISCOUNT) --}}
                                <p class="text-lg font-semibold text-green-400 mt-2 flex flex-col">
                                    <span class="text-xs text-gray-500 line-through">
                                        Rp {{ number_format($costume->original_price, 0, ',', '.') }} / Day
                                    </span>
                                    <span class="text-xl font-extrabold text-indigo-400">
                                        Rp {{ number_format($costume->discounted_price, 0, ',', '.') }} / Day
                                    </span>
                                </p>

                                {{-- Link to Costume Detail Page --}}
                                <a href="{{ route('costume.detail', ['id' => $costume->id]) }}"
                                    class="mt-3 block text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 rounded">
                                    View & Rent Now!
                                </a>
                            </div>
                        </div>
                    @empty
                        <p class="col-span-4 text-center text-gray-400 text-lg py-10">No items available in the complete
                            catalog.</p>
                    @endforelse
                </div>

                {{-- Pagination Links for All Products --}}
                @if ($costumesPaginated->hasPages())
                    <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 mt-6 pb-3">
                        {{ $costumesPaginated->links() }}
                    </div>
                @endif
            </div>
        </section>

        {{-- ABOUT SECTION --}}
        <section id="about" class="py-12" style="background-color: #0d0d1f;">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 text-gray-300">
                <h3 class="text-3xl font-extrabold text-pink-400 mb-6 border-b border-pink-700 pb-2">ðŸŒŒ About Starium
                    Cosplay Rental</h3>
                <p class="mb-4 text-lg">
                    Starium Cosplay Rental is the galaxy's leading platform connecting aspiring cosplayers with top-tier
                    costume providers. Launched by Edgi Axel Limandibrata from STMIK LIKMI in October 2025, our mission
                    is to make event-ready costumes accessible across the cosmos. We ensure secure, hassle-free rentals
                    managed by our dedicated team and protected.
                </p>
                <p>
                    Whether you need armor for a convention, a historical dress for a photoshoot, or just a T-Rex
                    Kigurumi for laughs, Starium manages the catalog, inventory, and transactions, giving costume
                    providers a powerful system to manage their businesses.</p>
            </div>
        </section>

        {{-- FOOTER SECTION --}}
        @include('layouts.footer')
    </div>
</x-app-layout>

=== FILE: resources/views\admin\costume_approval.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Admin: Costume Approval Center ðŸš¨
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-8">
            {{-- PENDING APPROVALS --}}
            <div class="bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg p-6 border-t-4 border-yellow-500">
                <h3 class="text-2xl font-bold text-yellow-400 mb-6">Costumes Awaiting Review
                    ({{ $pendingCostumes->count() }})</h3>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    @forelse ($pendingCostumes as $costume)
                                    <div class="bg-gray-700 shadow-xl rounded-lg overflow-hidden p-4 border border-yellow-500">
                                        <p class="text-sm text-gray-400">Uploaded by:
                                            <span
                                                class="font-semibold text-pink-400">{{ $costume->renter->store->store_name ?? 'N/A' }}</span>
                                        </p>
                                        <h4 class="text-xl font-bold text-white mt-1">{{ $costume->name }}</h4>
                                        <p class="text-red-400 font-semibold mt-2">Status: PENDING ADMIN APPROVAL</p>

                                        <div class="my-3 bg-gray-600 flex items-center justify-center overflow-hidden rounded-md">
                                            <img src="{{ $costume->main_image_path ? asset('storage/' . $costume->main_image_path) : asset('default_images/default_costume.png') }}"
                                                alt="{{ $costume->name }}" class="h-full w-auto object-cover"
                                                onerror="this.onerror=null; this.src='{{ asset('default_images/default_costume.png') }}';">
                                        </div>

                                        <p class="text-gray-300 text-sm">Price: Rp
                                            {{ number_format($costume->price_per_day, 0, ',', '.') }}/day
                                        </p>

                                        <div class="mt-4 space-x-2">

                                            {{-- APPROVE FORM: Action MUST point to set_approval route --}}
                                            <form action="{{ route('admin.costumes.set_approval', ['costume_id' => $costume->id]) }}"
                                                method="POST" class="inline">
                                                @csrf
                                                <input type="hidden" name="action" value="approve">
                                                <button type="submit"
                                                    class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded text-sm">Approve</button>
                                            </form>

                                            {{-- REJECT LINK (Placeholder for modal/notes) --}}
                                            <a href="#" onclick="
                                            if (confirm('Are you sure you want to REJECT {{ $costume->name }}?')) {
                                                // For quick mockup, trigger rejection via form submission to the same endpoint
                                                document.getElementById('reject-form-{{ $costume->id }}').submit();
                                            }
                                            return false;" class="text-red-400 hover:text-red-600 text-sm">Reject w/ Notes</a>

                                            {{-- HIDDEN REJECT FORM --}}
                                            <form id="reject-form-{{ $costume->id }}"
                                                action="{{ route('admin.costumes.set_approval', ['costume_id' => $costume->id]) }}"
                                                method="POST" class="hidden">
                                                @csrf
                                                <input type="hidden" name="action" value="reject">
                                                <input type="hidden" name="notes"
                                                    value="Rejected by Admin (No reason provided in mockup).">
                                            </form>


                                            <a href="{{ route('costume.detail', ['id' => $costume->id]) }}"
                                                class="text-indigo-400 hover:text-indigo-600 text-sm">View Detail</a>
                                        </div>
                                    </div>
                    @empty
                        <p class="col-span-3 text-gray-400">No costumes awaiting approval. Everything is running smoothly.
                        </p>
                    @endforelse
                </div>
            </div>

            {{-- ALL LISTED COSTUMES --}}
            <div class="bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg p-6 border-t-4 border-indigo-500">
                <h3 class="text-2xl font-bold text-indigo-400 mb-6">All Listed Costumes (Editable/Deletable)</h3>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\admin\dashboard.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Admin Control Deck ðŸš€ <span class="text-red-400">GLOBAL OVERVIEW</span>
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-10">
            <div class="grid grid-cols-4 gap-6 text-center">
                <div class="p-6 bg-gray-800 rounded-lg shadow-xl border-t-4 border-indigo-500">
                    <p class="text-sm text-gray-400">Total Revenue (Completed)</p>
                    <p class="text-2xl font-extrabold text-green-400 mt-2">Rp
                        {{ number_format($totalRevenue, 0, ',', '.') }}</p>
                </div>
                <div class="p-6 bg-gray-800 rounded-lg shadow-xl border-t-4 border-red-500">
                    <p class="text-sm text-gray-400">Total Renters</p>
                    <p class="text-2xl font-extrabold text-white mt-2">{{ $totalRenters }}</p>
                </div>
                <div class="p-6 bg-gray-800 rounded-lg shadow-xl border-t-4 border-yellow-500">
                    <p class="text-sm text-gray-400">Costumes Pending Approval</p>
                    <p class="text-2xl font-extrabold text-white mt-2">{{ $pendingApprovals }}</p>
                </div>
                <div class="p-6 bg-gray-800 rounded-lg shadow-xl border-t-4 border-pink-500">
                    <p class="text-sm text-gray-400">Total Catalog Items</p>
                    <p class="text-2xl font-extrabold text-white mt-2">{{ $totalCostumes }}</p>
                </div>
            </div>

            {{-- ADMIN ACTION LINKS --}}
            <div class="grid grid-cols-3 gap-6 text-center">
                <a href="{{ route('admin.costumes.approval') }}"
                    class="block p-4 bg-yellow-700 hover:bg-yellow-600 rounded-lg shadow-lg transition duration-300">
                    <span class="text-xl font-extrabold text-white">Costume Approvals</span>
                </a>
                <a href="{{ route('admin.users') }}"
                    class="block p-4 bg-indigo-700 hover:bg-indigo-600 rounded-lg shadow-lg transition duration-300">
                    <span class="text-xl font-extrabold text-white">Manage Users</span>
                </a> 
                <a href="{{ route('admin.transactions') }}"
                    class="block p-4 bg-pink-700 hover:bg-indigo-600 rounded-lg shadow-lg transition duration-300">
                    <span class="text-xl font-extrabold text-white">Manage Transaction</span>
                </a>
            </div>
            <div class="grid grid-cols-3 gap-6 text-center">
            <a href="{{ route('admin.discounts.manage') }}"
                    class="block p-4 bg-red-700 hover:bg-red-600 rounded-lg shadow-lg transition duration-300">
                    <span class="text-xl font-extrabold text-white">Manage Discounts</span>
                </a>
                <a href="{{ route('admin.banners.manage') }}"
                    class="block p-4 bg-blue-700 hover:bg-green-600 rounded-lg shadow-lg transition duration-300">
                    <span class="text-xl font-extrabold text-white">Edit Catalog Banners</span>
                </a>
                <a href="{{ route('admin.stores.manage') }}"
                    class="block p-4 bg-purple-700 hover:bg-green-600 rounded-lg shadow-lg transition duration-300">
                    <span class="text-xl font-extrabold text-white">Edit Renter Stores</span>
                </a>
            </div>

            {{-- RENTER SALES RANKING --}}
            <div class="bg-gray-800 rounded-lg shadow-xl p-6">
                <h3 class="text-2xl font-bold text-red-400 mb-6">Top Renters by Total Revenue</h3>

                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Renter</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Total
                                    Revenue</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Costumes
                                    Listed</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Top Costume
                                    Example</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-gray-800 divide-y divide-gray-700 text-gray-200">
                            @forelse ($renterSummaries as $renter)
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-white">{{ $renter->name }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-green-400 font-bold">Rp
                                        {{ number_format($renter->revenue, 0, ',', '.') }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center">{{ $renter->costumes_count }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">{{ $renter->top_costume }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <a href="{{ route('admin.renters.analytics', $renter->id) }}"
                                            class="text-indigo-400 hover:text-indigo-600">View Analytics</a>
                                    </td>
                                </tr>
                            @empty
                                <tr>
                                    <td colspan="5" class="px-6 py-4 text-center text-gray-400">No renter data available.
                                    </td>
                                </tr>
                            @endforelse
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\admin\edit_user_profile.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Admin: Edit Profile for <span class="text-indigo-400">{{ $user->name }}</span> (ID: {{ $user->id }})
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6">

            {{-- 1. USER PROFILE INFO --}}
            <div class="p-4 sm:p-8 bg-gray-800 shadow sm:rounded-lg border-t-4 border-indigo-500">
                <div class="max-w-xl">
                    <header>
                        <h2 class="text-lg font-medium text-gray-900 dark:text-gray-100">
                            {{ __('Core Account Details (Admin Edit)') }}
                        </h2>
                        <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">
                            {{ __("Edit personal, contact, and profile image information.") }}
                        </p>
                    </header>
                
                    <form method="post" action="{{ route('admin.users.update', $user->id) }}" class="mt-6 space-y-6" enctype="multipart/form-data">
                        @csrf
                        @method('patch')
                        
                        {{-- Name and Email (Standard) --}}
                        <div>
                            <x-input-label for="name" :value="__('User/Account Name')" class="text-indigo-400" />
                            <x-text-input id="name" name="name" type="text"
                                class="mt-1 block w-full bg-gray-700 border-gray-600 text-white" :value="old('name', $user->name)" required autofocus />
                            <x-input-error class="mt-2" :messages="$errors->get('name')" />
                        </div>
                        <div>
                            <x-input-label for="email" :value="__('Email')" class="text-indigo-400" />
                            <x-text-input id="email" name="email" type="email"
                                class="mt-1 block w-full bg-gray-700 border-gray-600 text-white" :value="old('email', $user->email)" required />
                            <x-input-error class="mt-2" :messages="$errors->get('email')" />
                        </div>

                        {{-- Profile Picture --}}
                        <div>
                            <x-input-label for="profile_picture" :value="__('Profile Picture')" class="text-indigo-400" />
                            <input id="profile_picture" name="profile_picture" type="file"
                                class="block mt-1 w-full text-sm text-gray-200 border-gray-600 rounded-lg cursor-pointer bg-gray-700 focus:outline-none" />
                            <x-input-error class="mt-2" :messages="$errors->get('profile_picture')" />
                            @if($user->profile_picture)
                                <p class="text-xs text-gray-500 mt-1">Current File: {{ basename($user->profile_picture) }}</p>
                            @endif
                        </div>

                        {{-- Contact Details --}}
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <x-input-label for="phone_number" :value="__('Phone Number')" class="text-indigo-400" />
                                <x-text-input id="phone_number" name="phone_number" type="text"
                                    class="mt-1 block w-full bg-gray-700 border-gray-600 text-white" :value="old('phone_number', $user->phone_number)" />
                                <x-input-error class="mt-2" :messages="$errors->get('phone_number')" />
                            </div>
                            <div class="col-span-1 md:col-span-2">
                                <x-input-label for="address" :value="__('Address')" class="text-indigo-400" />
                                <x-text-input id="address" name="address" type="text"
                                    class="mt-1 block w-full bg-gray-700 border-gray-600 text-white" :value="old('address', $user->address)" />
                                <x-input-error class="mt-2" :messages="$errors->get('address')" />
                            </div>
                        </div>

                        <div class="flex items-center gap-4">
                            <x-primary-button class="bg-red-600 hover:bg-red-700">{{ __('Save Changes (Admin Override)') }}</x-primary-button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\admin\manage_banners.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Admin: Manage Catalog Flash Sale Banners ðŸ–¼ï¸
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-5xl mx-auto sm:px-6 lg:px-8 space-y-8">
            <div class="p-6 bg-gray-800 rounded-lg shadow-xl border-t-4 border-red-500">
                <h3 class="text-2xl font-bold text-red-400 mb-6">3 Catalog Banners (Order is fixed)</h3>

                <div class="space-y-8">
                    @forelse ($banners as $banner)
                        <div class="p-6 bg-gray-700 rounded-lg border-l-4 border-indigo-500">
                            <h4 class="text-xl font-bold text-white mb-4">Banner #{{ $banner->order }}</h4>
                            <form action="{{ route('admin.banners.update', $banner->id) }}" method="POST" enctype="multipart/form-data" class="space-y-4">
                                @csrf
                                
                                {{-- Current Image Display --}}
                                <div class="mb-4">
                                    <p class="text-sm text-gray-400 mb-1">Current Image:</p>
                                    <div class="w-full h-full bg-gray-600 overflow-hidden rounded-md flex items-center justify-center">
                                        @php
                                            $imageUrl = $banner->image_path ? asset('storage/' . $banner->image_path) : asset('default_images/default_costume.png');
                                        @endphp
                                        <img src="{{ $imageUrl }}" alt="Banner Image {{ $banner->order }}" 
                                             class="h-full w-full object-cover"
                                             onerror="this.onerror=null; this.src='{{ asset('default_images/default_costume.png') }}';">
                                    </div>
                                    @if ($banner->image_path)
                                        <p class="text-xs text-gray-500 mt-1">File: {{ basename($banner->image_path) }}</p>
                                    @endif
                                </div>

                                {{-- Title Input --}}
                                <div>
                                    <x-input-label for="title_{{ $banner->id }}" :value="__('Banner Title/Text')" class="text-white" />
                                    <x-text-input id="title_{{ $banner->id }}" name="title" type="text"
                                        class="mt-1 block w-full bg-gray-600 border-gray-500 text-white" 
                                        value="{{ old('title', $banner->title) }}" required />
                                    <x-input-error class="mt-2" :messages="$errors->get('title')" />
                                </div>

                                {{-- Image Upload --}}
                                <div>
                                    <x-input-label for="image_file_{{ $banner->id }}" :value="__('Replace Image (JPG/PNG)')" class="text-white" />
                                    <input id="image_file_{{ $banner->id }}" name="image_file" type="file"
                                        class="block mt-1 w-full text-sm text-gray-200 border-gray-500 rounded-lg cursor-pointer bg-gray-600 focus:outline-none" />
                                    <x-input-error class="mt-2" :messages="$errors->get('image_file')" />
                                </div>

                                <div class="flex justify-end">
                                    <x-primary-button class="bg-pink-600 hover:bg-pink-700">
                                        {{ __('Update Banner') }}
                                    </x-primary-button>
                                </div>
                            </form>
                        </div>
                    @empty
                        <p class="text-gray-400">No banners initialized yet.</p>
                    @endforelse
                </div>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\admin\manage_discounts.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Admin: Discount & Sale Management ðŸ’¸
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-8">

            {{-- 1. GLOBAL FLASH SALE CONTROL --}}
            <div class="bg-gray-800 rounded-lg shadow-xl p-6 border-t-4 border-yellow-500">
                <h3 class="text-2xl font-bold text-yellow-400 mb-4">Global Flash Sale Control</h3>
                
                @if (session('status'))
                    <div class="mb-4 text-sm font-medium text-green-400 p-3 bg-green-900/50 rounded-lg">
                        {{ session('status') }}
                    </div>
                @endif
                
                <p class="text-gray-400 mb-3">This rate is **ADDITIVE** to individual costume discounts (e.g., Global 15% + Costume 5% = 20% Total).</p>
                <form action="{{ route('admin.discounts.global.set') }}" method="POST"
                    class="flex items-center space-x-4">
                    @csrf
                    <label for="global_rate" class="text-white">Global Rate (%)</label>
                    <input type="number" step="0.01" name="rate" id="global_rate"
                        value="{{ old('rate', $globalDiscount->rate * 100) }}"
                        class="bg-gray-700 border-gray-600 text-white rounded-md w-24">
                    <label class="text-white">
                        <input type="checkbox" name="is_active" {{ $globalDiscount->is_active ? 'checked' : '' }}
                            class="rounded text-yellow-500 bg-gray-700 border-gray-600">
                        Active
                    </label>
                    <button type="submit"
                        class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-md">Save Global Sale</button>
                </form>
                <p class="text-sm text-gray-500 mt-2">Current Global Discount: **{{ $globalDiscount->rate * 100 }}%**
                    ({{ $globalDiscount->is_active ? 'ACTIVE' : 'INACTIVE' }})</p>
            </div>

            {{-- 2. INDIVIDUAL COSTUME DISCOUNT MONITORING --}}
            <div class="bg-gray-800 rounded-lg shadow-xl p-6 border-t-4 border-red-500">
                <h3 class="text-2xl font-bold text-red-400 mb-6">Individual Costume Discount Monitor</h3>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Costume</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Renter Store</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Renter Discount (%)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-gray-800 divide-y divide-gray-700 text-gray-200">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">Star Lord Helmet</td>
                                <td class="px-6 py-4 whitespace-nowrap">Cosmic Threads</td>
                                <td class="px-6 py-4 whitespace-nowrap text-red-400 font-bold">5%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <a href="#" class="text-indigo-400 hover:text-indigo-600">Edit Discount</a>
                                    <a href="#" class="text-red-400 hover:text-red-600">Remove</a>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">Naruto Hokage Outfit</td>
                                <td class="px-6 py-4 whitespace-nowrap">Weeb Central</td>
                                <td class="px-6 py-4 whitespace-nowrap text-gray-400">0%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <a href="#" class="text-indigo-400 hover:text-indigo-600">Add Discount</a>
                                    <a href="#" class="text-red-400 hover:text-red-600 opacity-50 cursor-not-allowed">Remove</a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\admin\manage_stores.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Admin: Manage All Renter Stores ðŸª
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg p-6 border-t-4 border-indigo-500">
                <h3 class="text-2xl font-bold text-indigo-400 mb-6">Active Stores List ({{ $renters->count() }} Renters)</h3>

                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Store Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Owner Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Listings Count</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Date Joined</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-gray-800 divide-y divide-gray-700 text-gray-200">
                            @forelse ($renters as $renter)
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap font-bold text-pink-400">{{ $renter->store->store_name ?? 'N/A' }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">{{ $renter->name }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center">{{ $renter->costumes_count }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">{{ $renter->created_at->format('Y-m-d') }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                        <a href="{{ route('admin.stores.view', $renter->id) }}" class="text-indigo-400 hover:text-indigo-600">View/Edit Store</a>
                                        <a href="#" class="text-red-400 hover:text-red-600">Deactivate/Delete</a>
                                    </td>
                                </tr>
                            @empty
                                <tr><td colspan="5" class="px-6 py-4 text-center text-gray-400">No renters registered on the platform.</td></tr>
                            @endforelse
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\admin\manage_users.blade.php ===

@php
    use App\Models\User;
    use Illuminate\Support\Facades\Auth;
    // Fetch all users who are NOT the current Admin
    $users = User::where('id', '!=', Auth::id())->with('roles')->get();

    // NEW: Check if the current user is the owner
    $isOwner = Auth::user()->hasRole('owner'); 
    $availableRoles = ['user', 'renter', 'admin']; // Standard admin can only promote up to admin
    if ($isOwner) {
        $availableRoles[] = 'owner'; // Owner can promote to owner
    }
@endphp

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Admin: Manage Platform Users ðŸ› ï¸
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg p-6 border-t-4 border-red-500">
                <h3 class="text-lg font-bold text-gray-200 mb-4">Platform Accounts List</h3>

                @if ($isOwner)
                <p class="mb-4 text-yellow-400 font-semibold">NOTE: Since you are the Owner, you see the role dropdown and an extra "Edit Permissions" link.</p>
                @endif
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                {{-- ... (Name, Email, Role headers remain the same) ... --}}
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Email</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Role</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-gray-800 divide-y divide-gray-700 text-gray-200">
                            @foreach ($users as $userItem)
                                @php
                                    $role = $userItem->roles->pluck('name')->first() ?? 'Unassigned';
                                    $color = [
                                        'owner' => 'bg-green-600', // NEW
                                        'admin' => 'bg-red-600',
                                        'renter' => 'bg-pink-600',
                                        'user' => 'bg-blue-600',
                                        'Unassigned' => 'bg-gray-500'
                                    ][$role] ?? 'bg-gray-500';
                                @endphp
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{ $userItem->name }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">{{ $userItem->email }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span
                                            class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full {{ $color }} text-white">{{ ucfirst($role) }}</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-y-1">
                                        <div class="flex items-center space-x-2">
                                            <form action="{{ route('admin.users.updateRole', $userItem->id) }}"
                                                method="POST" class="inline-block">
                                                @csrf
                                                <select name="role_name" onchange="this.form.submit()"
                                                    class="bg-gray-700 border-indigo-500 rounded-md text-white text-sm py-1">
                                                    @foreach ($availableRoles as $availableRole)
                                                        {{-- Owner can see and use all roles in the dropdown --}}
                                                        @if ($isOwner || $availableRole !== 'owner') 
                                                            <option value="{{ $availableRole }}" @selected($availableRole === $role)>
                                                                {{ ucfirst($availableRole) }}
                                                            </option>
                                                        @endif
                                                    @endforeach
                                                </select>
                                            </form>
                                        </div>
                                        
                                        {{-- Profile Edit Link (Admin/Owner feature) --}}
                                        <a href="{{ route('admin.users.edit', $userItem->id) }}"
                                            class="text-indigo-400 hover:text-indigo-600 text-xs block">Edit Profile</a>
                                        
                                        {{-- OWNER ONLY: Direct Permission Edit Link --}}
                                        @if ($isOwner)
                                            <a href="{{ route('owner.users.permissions.edit', $userItem->id) }}"
                                                class="text-yellow-400 hover:text-yellow-600 text-xs block font-bold mt-1">
                                                Edit Permissions
                                            </a>
                                        @endif
                                        
                                        <a href="#" class="text-red-400 hover:text-red-600 text-xs block">Deactivate</a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\admin\monitor_transactions.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Admin: Monitor All Cosmic Transactions ðŸ“ˆ
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8" x-data="{ 
            sortColumn: 'order_code', 
            sortDirection: 'asc',
            filterStatus: '',
            orders: {{ json_encode($orders) }}, 

            get filteredOrders() {
                // 1. Filter by Status
                let filtered = this.orders.filter(order => 
                    !this.filterStatus || order.status === this.filterStatus
                );

                // 2. Sort Logic
                return filtered.sort((a, b) => {
                    let aVal = a[this.sortColumn] || '';
                    let bVal = b[this.sortColumn] || '';

                    // Handle nested properties (Costume Name, Renter Name)
                    if (this.sortColumn === 'costume_name') {
                        aVal = a.costume?.name || '';
                        bVal = b.costume?.name || '';
                    } else if (this.sortColumn === 'renter_name') {
                        aVal = a.costume?.renter?.name || '';
                        bVal = b.costume?.renter?.name || '';
                    } else if (this.sortColumn === 'customer_name') {
                        aVal = a.user?.name || '';
                        bVal = b.user?.name || '';
                    }

                    // Numeric Comparison for Price
                    if (this.sortColumn === 'total_price') {
                        aVal = parseFloat(aVal);
                        bVal = parseFloat(bVal);
                    }
                    
                    const comparison = aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                    return this.sortDirection === 'asc' ? comparison : -comparison;
                });
            },
            
            // Function to change sorting
            sort(column) {
                if (this.sortColumn === column) {
                    this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    this.sortColumn = column;
                    this.sortDirection = 'asc';
                }
            }
        }">

            <div class="bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg p-6 border-t-4 border-red-500">
                <h3 class="text-2xl font-bold text-gray-200 mb-4">Current Rental Overview ({{ $orders->count() }} Total)
                </h3>

                <div class="flex space-x-4 mb-4 items-center">
                    {{-- Status Filter Dropdown --}}
                    <label for="filterStatus" class="text-gray-400">Filter Status:</label>
                    <select x-model="filterStatus" id="filterStatus"
                        class="bg-gray-700 border-indigo-500 rounded-md text-white text-sm py-2 px-3">
                        <option value="">ALL STATUSES</option>
                        <option value="waiting">WAITING</option>
                        <option value="confirmed">CONFIRMED</option>
                        <option value="borrowed">BORROWED</option>
                        <option value="returned">RETURNED</option>
                        <option value="completed">COMPLETED</option>
                        <option value="rejected">REJECTED</option>

                    </select>
                    <a :href="`{{ route('order.detail', '') }}/${order.id}`" target="_blank"
                        class="text-sm text-indigo-400 hover:text-indigo-600 mt-1 block">View Details</a>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                {{-- Clickable Headers for Sorting --}}
                                @foreach (['Order ID' => 'order_code', 'Costume' => 'costume_name', 'Renter' => 'renter_name', 'Customer' => 'customer_name', 'Total Price' => 'total_price', 'Status' => 'status'] as $label => $column)
                                    <th @click="sort('{{ $column }}')"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition">
                                        {{ $label }}
                                        <span x-show="sortColumn === '{{ $column }}'"
                                            x-text="sortDirection === 'asc' ? ' â–²' : ' â–¼'"></span>
                                    </th>
                                @endforeach
                                {{-- ADDED ACTIONS HEADER --}}
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-gray-800 divide-y divide-gray-700 text-gray-200">
                            <template x-for="order in filteredOrders" :key="order.order_code">
                                <tr :class="{'bg-gray-900': order.status === 'borrowed'}">
                                    <td class="px-6 py-4 whitespace-nowrap" x-text="order.order_code"></td>
                                    <td class="px-6 py-4 whitespace-nowrap" x-text="order.costume?.name || 'N/A'"></td>
                                    <td class="px-6 py-4 whitespace-nowrap"
                                        x-text="order.costume?.renter?.name || 'N/A'"></td>
                                    <td class="px-6 py-4 whitespace-nowrap" x-text="order.user?.name || 'N/A'"></td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        Rp <span x-text="Number(order.total_price).toLocaleString('id-ID')"></span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap font-semibold" :class="{
                'text-yellow-400': order.status === 'waiting',
                'text-indigo-400': order.status === 'confirmed',
                'text-red-400': order.status === 'borrowed',
                'text-green-400': order.status === 'completed',
                'text-gray-400': order.status === 'rejected' || order.status === 'returned',
            }" x-text="order.status.toUpperCase()">
                                    </td>

                                    {{-- ADDED ACTIONS COLUMN (Status Dropdown) --}}
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <select @change="
                if ($event.target.value === 'reject') {
                    // Handle REJECT separately if needed, but for now we route status updates through the generic one
                    var url = `{{ route('orders.reject', '') }}/${order.id}`;
                    var bodyData = {};
                } else if ($event.target.value) {
                    var url = `{{ route('orders.update.status', '') }}/${order.id}`;
                    var bodyData = { new_status: $event.target.value };
                }

                if ($event.target.value) {
                    fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRF-TOKEN': '{{ csrf_token() }}'
                        },
                        body: JSON.stringify(bodyData)
                    }).then(response => {
                        // Reload page to show status update and stock change
                        window.location.reload(); 
                    });
                }" class="bg-gray-700 border-gray-600 text-white text-xs rounded-md">

                                            <option value="">CHANGE STATUS</option>
                                            <option value="confirmed" :disabled="order.status !== 'waiting'"
                                                :selected="order.status === 'confirmed'">Confirmed</option>
                                            <option value="borrowed" :disabled="order.status !== 'confirmed'"
                                                :selected="order.status === 'borrowed'">Borrowed (Out for Rent)</option>
                                            <option value="returned"
                                                :disabled="order.status === 'rejected' || order.status === 'completed'"
                                                :selected="order.status === 'returned'">Returned (Check-in)</option>
                                            <option value="completed" :disabled="order.status !== 'returned'"
                                                :selected="order.status === 'completed'">Completed (Finalized)</option>
                                            <option value="waiting" :disabled="order.status !== 'rejected'"
                                                :selected="order.status === 'waiting'">Waiting (Reset)</option>
                                            <option value="reject" :disabled="order.status !== 'waiting'">REJECT
                                                (Permanent)</option>
                                        </select>
                                    </td>
                                </tr>
                            </template>

                            <tr x-show="filteredOrders.length === 0">
                                <td colspan="6" class="px-6 py-4 text-center text-gray-400">
                                    No transactions match the current filter or criteria.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\admin\renter_analytics.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Admin: Renter Analytics for âœ¨ {{ $store->store_name ?? $renter->name }}
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-8">
            <div class="p-6 bg-gray-800 rounded-lg shadow-xl border-t-4 border-pink-500">
                <h3 class="text-2xl font-bold text-pink-400 mb-4">Renter Summary ({{ $renter->name }})</h3>
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div class="p-4 bg-gray-700 rounded-lg">
                        <p class="text-sm text-gray-400">Total Listings</p>
                        <p class="text-xl font-bold text-white mt-1">{{ $costumes->count() }}</p>
                    </div>
                    <div class="p-4 bg-gray-700 rounded-lg">
                        <p class="text-sm text-gray-400">Total Estimated Sales</p>
                        <p class="text-xl font-bold text-white mt-1">~Rp {{ number_format($totalRevenue, 0, ',', '.') }}
                        </p>
                    </div>
                    <div class="p-4 bg-gray-700 rounded-lg">
                        <p class="text-sm text-gray-400">Store Status</p>
                        <p class="text-xl font-bold text-green-400 mt-1">Active</p>
                    </div>
                </div>
            </div>
            
            {{-- COSTUME SALES BREAKDOWN --}}
            <div class="bg-gray-800 rounded-lg shadow-xl p-6">
                <h3 class="text-2xl font-bold text-red-400 mb-6">Costume Sales Breakdown</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Costume Name
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Current
                                    Stock</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Total Rented
                                    Count</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-gray-800 divide-y divide-gray-700 text-gray-200">
                            @forelse ($costumes as $costume)
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{ $costume->name }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center">{{ $costume->stock }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center">{{ $costume->orders_count }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                        <a href="#" class="text-indigo-400 hover:text-indigo-600">Edit Costume</a>
                                        <a href="#" class="text-red-400 hover:text-red-600">Delete</a>
                                    </td>
                                </tr>
                            @empty
                                <tr>
                                    <td colspan="4" class="px-6 py-4 text-center text-gray-400">No costumes listed by this
                                        renter.</td>
                                </tr>
                            @endforelse
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\admin\view_store_details.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Admin: Managing Store: <span class="text-pink-400">{{ $renter->store->store_name ?? 'N/A' }}</span>
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-8">

            {{-- 1. STORE PROFILE EDIT --}}
            <div class="bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg p-6 border-t-4 border-pink-500">
                <h3 class="text-2xl font-bold text-pink-400 mb-6">Store Profile & Details (Owner: {{ $renter->name }})
                </h3>

                <form method="post" action="{{ route('admin.stores.update_details', $renter->id) }}"
                    enctype="multipart/form-data" class="mt-6 space-y-6">
                    @csrf
                    @method('patch')

                    {{-- Store Name --}}
                    <div>
                        <x-input-label for="store_name" :value="__('Store Name')" class="text-pink-400" />
                        <x-text-input id="store_name" name="store_name" type="text"
                            class="mt-1 block w-full bg-gray-700 border-gray-600 text-white" :value="old('store_name', $renter->store->store_name ?? $renter->name . ' Shop')" required />
                        <x-input-error class="mt-2" :messages="$errors->get('store_name')" />
                    </div>

                    {{-- Store Logo --}}
                    <div>
                        <x-input-label for="store_logo" :value="__('Store Logo')" class="text-pink-400" />
                        <input id="store_logo" name="store_logo" type="file" Â  Â  Â  Â  Â  Â  Â  Â 
                            class="block mt-1 w-full text-sm text-gray-200 border-gray-600 rounded-lg cursor-pointer bg-gray-700 focus:outline-none" />
                        <x-input-error class="mt-2" :messages="$errors->get('store_logo')" />
                        @if($renter->store && $renter->store->store_logo_path)
                            <p class="text-xs text-gray-500 mt-1">
                                Current File: {{ basename($renter->store->store_logo_path) }}
                            </p>
                        @endif
                    </div>

                    {{-- Store Description --}}
                    <div>
                        <x-input-label for="description" :value="__('Store Description (Public)')"
                            class="text-pink-400" />
                        <textarea id="description" name="description"
                            class="mt-1 block w-full border-gray-600 bg-gray-700 text-white focus:border-pink-500 focus:ring-pink-500 rounded-md shadow-sm">{{ old('description', $renter->store->description ?? 'We rent the best costumes in the entire solar system!') }}</textarea>
                        <x-input-error class="mt-2" :messages="$errors->get('description')" />
                    </div>

                    <div class="flex items-center gap-4">
                        <x-primary-button class="bg-red-600 hover:bg-red-700">
                            {{ __('Save Store Details (Admin Override)') }}
                        </x-primary-button>
                    </div>
                </form>

                <div class="mt-8 pt-4 border-t border-gray-700">
                    <p class="text-sm text-gray-400">
                        To manage the **Owner's personal details** (Name, Email, Phone, Address), please navigate to the
                        main <a href="{{ route('admin.users') }}" class="text-indigo-400 hover:text-indigo-600">Manage
                            Users</a> page.
                    </p>
                </div>
            </div>

            {{-- 2. COSTUME MANAGEMENT TABLE --}}
            <div class="bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg p-6 border-t-4 border-indigo-500">
                <h3 class="text-2xl font-bold text-indigo-400 mb-6">Costumes Listed by This Store
                    ({{ $renter->costumes->count() }})</h3>

                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Costume</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Series</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Stock</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Total Sales
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Approval
                                    Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-gray-800 divide-y divide-gray-700 text-gray-200">
                            @forelse ($renter->costumes as $costume)
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">{{ $costume->name }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">{{ $costume->series }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center text-indigo-400">
                                        {{ $costume->stock }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center">{{ $costume->orders_count }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        @if ($costume->is_approved)
                                            <span
                                                class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-700 text-white">Approved</span>
                                        @else
                                            <span
                                                class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-700 text-white">Pending</span>
                                        @endif
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                        {{-- FIX: Link to Renter's Edit form (Admin/Owner can access if they have
                                        'costume:edit-all') --}}
                                        <a href="{{ route('renter.costumes.edit', $costume->id) }}"
                                            class="text-indigo-400 hover:text-indigo-600">Edit</a>

                                        {{-- FIX: Implement SOFT DELETE form (Admin/Owner can access if they have
                                        'costume:delete-all') --}}
                                        <form action="{{ route('renter.costumes.delete', $costume->id) }}" method="POST"
                                            class="inline"
                                            onsubmit="return confirm('WARNING: Are you absolutely sure you want to SOFT DELETE this costume ({{ $costume->name }})? This is an Admin action.');">
                                            @csrf
                                            @method('DELETE')
                                            <button type="submit" class="text-red-400 hover:text-red-600">Delete
                                                (Soft)</button>
                                        </form>
                                    </td>
                                </tr>
                            @empty
                                <tr>
                                    <td colspan="6" class="px-6 py-4 text-center text-gray-400">This renter has no costumes
                                        listed.</td>
                                </tr>
                            @endforelse
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\admin\owner\edit_user_permissions.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            OWNER DECK: Editing Permissions for <span class="text-yellow-400">{{ $userToEdit->name }}</span> (Current
            Role: <span
                class="font-bold text-red-500">{{ $userToEdit->roles->pluck('name')->first() ?? 'None' }}</span>)
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6">

            <div class="p-4 sm:p-8 bg-gray-800 shadow sm:rounded-lg border-t-4 border-yellow-500">
                <header class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-100">
                        Role & Direct Permission Override
                    </h2>
                    <p class="mt-1 text-sm text-gray-400">
                        WARNING: You are directly editing roles and permissions. This bypasses the default logic.
                    </p>
                </header>

                @if ($errors->any())
                    <div class="mb-4 p-3 bg-red-900/50 rounded-lg">
                        <ul class="text-sm text-red-400 list-disc list-inside">
                            @foreach ($errors->all() as $error)
                                <li>{{ $error }}</li>
                            @endforeach
                        </ul>
                    </div>
                @endif

                <form method="POST" action="{{ route('owner.users.permissions.sync', $userToEdit->id) }}"
                    class="mt-6 space-y-8">
                    @csrf

                    {{-- ROLE SELECTION (Standard/Default Permissions) --}}
                    <div>
                        <x-input-label for="role_name" value="1. Assign Primary Role (Default Permissions)"
                            class="text-yellow-400 text-lg mb-2" />
                        <select id="role_name" name="role_name" required
                            class="mt-1 block w-full bg-gray-700 border-yellow-600 text-white rounded-md shadow-sm">
                            {{-- Owner can assign ANY role, including owner itself --}}
                            @foreach (Spatie\Permission\Models\Role::all() as $roleOption)
                                <option value="{{ $roleOption->name }}" @selected($userToEdit->hasRole($roleOption->name))>
                                    {{ ucfirst($roleOption->name) }}
                                </option>
                            @endforeach
                        </select>
                        <x-input-error class="mt-2" :messages="$errors->get('role_name')" />
                    </div>

                    {{-- DIRECT PERMISSION OVERRIDE (Fine-Grained Control) --}}
                    <div>
                        <x-input-label for="permissions"
                            value="2. Direct Permission Overrides (ADDITIONAL or REMOVE from role)"
                            class="text-yellow-400 text-lg mb-2" />
                        <p class="text-sm text-gray-500 mb-4">Check a box to grant this user the permission directly ,
                            regardless of their role.</p>

                        <div
                            class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 max-h-96 overflow-y-auto p-4 border border-gray-700 rounded-lg bg-gray-700">
                            @foreach ($allPermissions as $permission)
                                                    @php
                                                        // Check if the user has this permission directly assigned
                                                        $hasDirectPermission = $userToEdit->hasDirectPermission($permission->name);

                                                        // Check if the permission is granted via their current role(s)
                                                        // NOTE: $currentPermissions contains ALL permissions (direct + via role)
                                                        $hasViaRole = in_array($permission->name, $currentPermissions) && !$hasDirectPermission;
                                                    @endphp

                                                    <label class="flex items-center text-sm text-gray-300 space-x-2 p-2 rounded-md transition duration-150
                                    {{ $hasDirectPermission ? 'bg-indigo-900 border border-indigo-500'
                                : ($hasViaRole ? 'bg-pink-900/50' : 'hover:bg-gray-600') }}">
                                                        <input type="checkbox" name="permissions[]" value="{{ $permission->name }}"
                                                            class="rounded text-yellow-500 bg-gray-800 border-gray-600"
                                                            @checked(in_array($permission->name, $currentPermissions))>

                                                        <span class="truncate" title="{{ $permission->name }}">
                                                            {{ $permission->name }}
                                                        </span>

                                                        @if ($hasDirectPermission)
                                                            <span class="text-xs text-yellow-500 ml-auto">(Direct)</span>
                                                        @elseif ($hasViaRole)
                                                            <span class="text-xs text-pink-400 ml-auto">(Via Role)</span>
                                                        @endif
                                                    </label>
                            @endforeach
                        </div>

                        <x-input-error class="mt-2" :messages="$errors->get('permissions')" />
                    </div>


                    <div class="flex items-center gap-4">
                        <x-primary-button
                            class="bg-red-600 hover:bg-red-700">{{ __('Save Changes') }}</x-primary-button>
                        <a href="{{ route('admin.users') }}" class="text-gray-400 hover:text-white text-sm">Cancel and
                            Return</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\auth\confirm-password.blade.php ===

<x-guest-layout>
    <div class="mb-4 text-sm text-gray-600 dark:text-gray-400">
        {{ __('This is a secure area of the application. Please confirm your password before continuing.') }}
    </div>

    <form method="POST" action="{{ route('password.confirm') }}">
        @csrf

        <!-- Password -->
        <div>
            <x-input-label for="password" :value="__('Password')" />

            <x-text-input id="password" class="block mt-1 w-full"
                            type="password"
                            name="password"
                            required autocomplete="current-password" />

            <x-input-error :messages="$errors->get('password')" class="mt-2" />
        </div>

        <div class="flex justify-end mt-4">
            <x-primary-button>
                {{ __('Confirm') }}
            </x-primary-button>
        </div>
    </form>
</x-guest-layout>


=== FILE: resources/views\auth\forgot-password.blade.php ===

<x-guest-layout>
    <div class="flex flex-col items-center justify-center p-6 text-center text-white space-y-2"
        style="background-color: #1a0046; border-radius: 0.5rem 0.5rem 0 0;">
        <h1 class="text-3xl font-extrabold text-yellow-400">Lost Your Warp Key?</h1>
    </div>

    <div class="p-6 bg-gray-800 shadow-xl sm:rounded-lg">
        <div class="mb-4 text-sm text-gray-400">
            {{ __('No worries, space traveler. Enter your Cosmic ID (email) and we\'ll send you a password reset link.') }}
        </div>

        <x-auth-session-status class="mb-4" :status="session('status')" />

        <form method="POST" action="{{ route('password.email') }}">
            @csrf

            <div>
                <x-input-label for="email" :value="__('Email Address')" class="text-indigo-400" />
                <x-text-input id="email" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white" type="email"
                    name="email" :value="old('email')" required autofocus />
                <x-input-error :messages="$errors->get('email')" class="mt-2" />
            </div>

            <div class="flex items-center justify-end mt-4">
                <x-primary-button class="bg-yellow-600 hover:bg-yellow-700">
                    {{ __('Send Reset Link') }}
                </x-primary-button>
            </div>
        </form>
    </div>
</x-guest-layout>

=== FILE: resources/views\auth\login.blade.php ===

<x-guest-layout>
    <div class="flex flex-col items-center justify-center p-6 text-center text-white space-y-2"
        style="background-color: #1a0046; border-radius: 0.5rem 0.5rem 0 0;">
        <h1 class="text-3xl font-extrabold text-indigo-400">Welcome back, Traveler!</h1>
        <p class="text-sm text-gray-300">Log in to manage your cosmic journey with Starium Rental.</p>
    </div>

    <div class="p-6 bg-gray-800 shadow-xl sm:rounded-lg">
        <x-auth-session-status class="mb-4" :status="session('status')" />

        <form method="POST" action="{{ route('login') }}" class="mt-4 space-y-6">
            @csrf

            <div>
                <x-input-label for="email" :value="__('Email (Cosmic ID)')" class="text-indigo-400" />
                <x-text-input id="email" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white" type="email"
                    name="email" :value="old('email')" required autofocus autocomplete="username" />
                <x-input-error :messages="$errors->get('email')" class="mt-2" />
            </div>

            <div>
                <x-input-label for="password" :value="__('Password (Warp Key)')" class="text-indigo-400" />
                <x-text-input id="password" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white"
                    type="password" name="password" required autocomplete="current-password" />
                <x-input-error :messages="$errors->get('password')" class="mt-2" />
            </div>

            {{-- <div>
                <x-input-label for="captcha" :value="__('Security Check')" class="text-indigo-400" />

                <div class="flex items-center space-x-3 mt-1">

                    <div class="flex space-x-2 items-center shrink-0">
                        <div id="captcha-img-container"
                            class="w-36 h-10 bg-gray-700 border border-gray-600 rounded-md overflow-hidden flex items-center justify-center">
                            **{!! captcha_img('flat') !!}** </div>

                        <button type="button"
                            onclick="document.getElementById('captcha-img-container').querySelector('img').src = '{{ route('captcha.custom', ['flat']) }}?' + Math.random();"
                            class="p-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full transition duration-150 shrink-0"> 
                            Refresh
                        </button>
                    </div>

                    <x-text-input id="captcha" class="block w-full bg-gray-700 border-gray-600 text-white" type="text"
                        name="captcha" required autocomplete="off" placeholder="Type the code above" />
                </div>

                <x-input-error :messages="$errors->get('captcha')" class="mt-2" />
            </div> --}}

            <div class="block">
                <label for="remember_me" class="inline-flex items-center">
                    <input id="remember_me" type="checkbox"
                        class="rounded dark:bg-gray-700 border-gray-600 text-indigo-500 shadow-sm focus:ring-indigo-500 dark:focus:ring-offset-gray-800"
                        name="remember">
                    <span class="ms-2 text-sm text-gray-400">{{ __('Remember me') }}</span>
                </label>
            </div>

            <div class="flex items-center justify-between mt-6">
                @if (Route::has('password.request'))
                    <a class="underline text-sm text-gray-400 hover:text-white" href="{{ route('password.request') }}">
                        {{ __('Forgot your password?') }}
                    </a>
                @endif

                <x-primary-button class="bg-indigo-600 hover:bg-indigo-700">
                    {{ __('Engage!') }}
                </x-primary-button>
            </div>

            <p class="text-center text-sm text-gray-500 pt-4 border-t border-gray-700">
                New to the cosmos? <a href="{{ route('register') }}"
                    class="text-pink-400 hover:text-pink-300 font-semibold">Register Here</a>.
            </p>

        </form>
    </div>
</x-guest-layout>

=== FILE: resources/views\auth\register.blade.php ===

<x-guest-layout>
    <div class="flex flex-col items-center justify-center p-6 text-center text-white space-y-2"
        style="background-color: #1a0046; border-radius: 0.5rem 0.5rem 0 0;">
        <h1 class="text-3xl font-extrabold text-pink-400">Join the Cosmic Crew!</h1>
        <p class="text-sm text-gray-300">Sign up to explore or launch your own rental shop.</p>
    </div>

    <div class="p-6 bg-gray-800 shadow-xl sm:rounded-lg">
        <form method="POST" action="{{ route('register') }}" class="space-y-6">
            @csrf

            <div class="border-b border-gray-700 pb-4">
                <x-input-label :value="__('Account Type')" class="text-pink-400" />
                <div class="mt-2 flex space-x-6 text-gray-300">
                    <label class="inline-flex items-center">
                        <input type="radio" name="role_type" value="user" checked
                            class="rounded dark:bg-gray-700 border-gray-600 text-indigo-500 focus:ring-indigo-500" />
                        <span class="ms-2 text-sm">{{ __('Renter (Customer)') }}</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="radio" name="role_type" value="renter"
                            class="rounded dark:bg-gray-700 border-gray-600 text-pink-500 focus:ring-pink-500" />
                        <span class="ms-2 text-sm">{{ __('Provider (Costume Renter)') }}</span>
                    </label>
                </div>
            </div>

            <div>
                <x-input-label for="name" :value="__('Name')" class="text-indigo-400" />
                <x-text-input id="name" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white" type="text"
                    name="name" :value="old('name')" required autofocus autocomplete="name" />
                <x-input-error :messages="$errors->get('name')" class="mt-2" />
            </div>

            <div>
                <x-input-label for="email" :value="__('Email')" class="text-indigo-400" />
                <x-text-input id="email" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white" type="email"
                    name="email" :value="old('email')" required autocomplete="username" />
                <x-input-error :messages="$errors->get('email')" class="mt-2" />
            </div>

            <div>
                <x-input-label for="password" :value="__('Password')" class="text-indigo-400" />
                <x-text-input id="password" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white"
                    type="password" name="password" required autocomplete="new-password" />
                <x-input-error :messages="$errors->get('password')" class="mt-2" />
            </div>

            <div>
                <x-input-label for="password_confirmation" :value="__('Confirm Password')" class="text-indigo-400" />
                <x-text-input id="password_confirmation"
                    class="block mt-1 w-full bg-gray-700 border-gray-600 text-white" type="password"
                    name="password_confirmation" required autocomplete="new-password" />
                <x-input-error :messages="$errors->get('password_confirmation')" class="mt-2" />
            </div>

            <div class="pt-4 border-t border-gray-700">
                <x-input-label for="captcha" :value="__('Security Check')" class="text-indigo-400" />

                <div class="flex items-center space-x-3 mt-1">
                    <div class="flex space-x-2 items-center shrink-0">
                        <div id="captcha-img-container-register"
                            class="w-36 h-10 bg-gray-700 border border-gray-600 rounded-md overflow-hidden flex items-center justify-center">
                            **{!! captcha_img('flat') !!}**
                        </div>

                        <button type="button"
                            onclick="document.getElementById('captcha-img-container-register').querySelector('img').src = '{{ route('captcha.custom', ['flat']) }}?' + Math.random();"
                            class="p-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full transition duration-150 shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M16.023 9.348h4.992v-.001m-4.992 0L16.023 21m-4.992-1.998v-.001m4.992-10.999L16.023 9m-4.992-4.998v.001m4.992 10.998v-.001m-10.999 4.992L3.024 16.023m1.992-4.992v.001m-1.992 4.992L3.024 16.023m1.992 4.992L3.024 16.023m1.992 4.992v.001m4.992-10.998v-.001" />
                            </svg>
                        </button>
                    </div>

                    <x-text-input id="captcha" class="block w-full bg-gray-700 border-gray-600 text-white" type="text"
                        name="captcha" required autocomplete="off" placeholder="Type the code above" />
                </div>

                <x-input-error :messages="$errors->get('captcha')" class="mt-2" />
            </div>

            <div class="flex items-center justify-end mt-4">
                <a class="underline text-sm text-gray-400 hover:text-white" href="{{ route('login') }}">
                    {{ __('Already registered?') }}
                </a>

                <x-primary-button class="ms-4 bg-pink-600 hover:bg-pink-700">
                    {{ __('Launch Account!') }}
                </x-primary-button>
            </div>
        </form>
    </div>
</x-guest-layout>

=== FILE: resources/views\auth\reset-password.blade.php ===

<x-guest-layout>
    <form method="POST" action="{{ route('password.store') }}">
        @csrf

        <!-- Password Reset Token -->
        <input type="hidden" name="token" value="{{ $request->route('token') }}">

        <!-- Email Address -->
        <div>
            <x-input-label for="email" :value="__('Email')" />
            <x-text-input id="email" class="block mt-1 w-full" type="email" name="email" :value="old('email', $request->email)" required autofocus autocomplete="username" />
            <x-input-error :messages="$errors->get('email')" class="mt-2" />
        </div>

        <!-- Password -->
        <div class="mt-4">
            <x-input-label for="password" :value="__('Password')" />
            <x-text-input id="password" class="block mt-1 w-full" type="password" name="password" required autocomplete="new-password" />
            <x-input-error :messages="$errors->get('password')" class="mt-2" />
        </div>

        <!-- Confirm Password -->
        <div class="mt-4">
            <x-input-label for="password_confirmation" :value="__('Confirm Password')" />

            <x-text-input id="password_confirmation" class="block mt-1 w-full"
                                type="password"
                                name="password_confirmation" required autocomplete="new-password" />

            <x-input-error :messages="$errors->get('password_confirmation')" class="mt-2" />
        </div>

        <div class="flex items-center justify-end mt-4">
            <x-primary-button>
                {{ __('Reset Password') }}
            </x-primary-button>
        </div>
    </form>
</x-guest-layout>


=== FILE: resources/views\auth\verify-email.blade.php ===

<x-guest-layout>
    <div class="mb-4 text-sm text-gray-600 dark:text-gray-400">
        {{ __('Thanks for signing up! Before getting started, could you verify your email address by clicking on the link we just emailed to you? If you didn\'t receive the email, we will gladly send you another.') }}
    </div>

    @if (session('status') == 'verification-link-sent')
        <div class="mb-4 font-medium text-sm text-green-600 dark:text-green-400">
            {{ __('A new verification link has been sent to the email address you provided during registration.') }}
        </div>
    @endif

    <div class="mt-4 flex items-center justify-between">
        <form method="POST" action="{{ route('verification.send') }}">
            @csrf

            <div>
                <x-primary-button>
                    {{ __('Resend Verification Email') }}
                </x-primary-button>
            </div>
        </form>

        <form method="POST" action="{{ route('logout') }}">
            @csrf

            <button type="submit" class="underline text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800">
                {{ __('Log Out') }}
            </button>
        </form>
    </div>
</x-guest-layout>


=== FILE: resources/views\components\application-logo.blade.php ===

<img src="{{ asset('logo.png') }}" alt="Starium Rental Logo" {{ $attributes }}>


=== FILE: resources/views\components\auth-session-status.blade.php ===

@props(['status'])

@if ($status)
    <div {{ $attributes->merge(['class' => 'font-medium text-sm text-green-600 dark:text-green-400']) }}>
        {{ $status }}
    </div>
@endif


=== FILE: resources/views\components\danger-button.blade.php ===

<button {{ $attributes->merge(['type' => 'submit', 'class' => 'inline-flex items-center px-4 py-2 bg-red-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-red-500 active:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition ease-in-out duration-150']) }}>
    {{ $slot }}
</button>


=== FILE: resources/views\components\dropdown-link.blade.php ===

<a {{ $attributes->merge(['class' => 'block w-full px-4 py-2 text-start text-sm leading-5 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:bg-gray-100 dark:focus:bg-gray-800 transition duration-150 ease-in-out']) }}>{{ $slot }}</a>


=== FILE: resources/views\components\dropdown.blade.php ===

@props(['align' => 'right', 'width' => '48', 'contentClasses' => 'py-1 bg-white dark:bg-gray-700'])

@php
$alignmentClasses = match ($align) {
    'left' => 'ltr:origin-top-left rtl:origin-top-right start-0',
    'top' => 'origin-top',
    default => 'ltr:origin-top-right rtl:origin-top-left end-0',
};

$width = match ($width) {
    '48' => 'w-48',
    default => $width,
};
@endphp

<div class="relative" x-data="{ open: false }" @click.outside="open = false" @close.stop="open = false">
    <div @click="open = ! open">
        {{ $trigger }}
    </div>

    <div x-show="open"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-75"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
            class="absolute z-50 mt-2 {{ $width }} rounded-md shadow-lg {{ $alignmentClasses }}"
            style="display: none;"
            @click="open = false">
        <div class="rounded-md ring-1 ring-black ring-opacity-5 {{ $contentClasses }}">
            {{ $content }}
        </div>
    </div>
</div>


=== FILE: resources/views\components\input-error.blade.php ===

@props(['messages'])

@if ($messages)
    <ul {{ $attributes->merge(['class' => 'text-sm text-red-600 dark:text-red-400 space-y-1']) }}>
        @foreach ((array) $messages as $message)
            <li>{{ $message }}</li>
        @endforeach
    </ul>
@endif


=== FILE: resources/views\components\input-label.blade.php ===

@props(['value'])

<label {{ $attributes->merge(['class' => 'block font-medium text-sm text-gray-700 dark:text-gray-300']) }}>
    {{ $value ?? $slot }}
</label>


=== FILE: resources/views\components\modal.blade.php ===

@props([
    'name',
    'show' => false,
    'maxWidth' => '2xl'
])

@php
$maxWidth = [
    'sm' => 'sm:max-w-sm',
    'md' => 'sm:max-w-md',
    'lg' => 'sm:max-w-lg',
    'xl' => 'sm:max-w-xl',
    '2xl' => 'sm:max-w-2xl',
][$maxWidth];
@endphp

<div
    x-data="{
        show: @js($show),
        focusables() {
            // All focusable element types...
            let selector = 'a, button, input:not([type=\'hidden\']), textarea, select, details, [tabindex]:not([tabindex=\'-1\'])'
            return [...$el.querySelectorAll(selector)]
                // All non-disabled elements...
                .filter(el => ! el.hasAttribute('disabled'))
        },
        firstFocusable() { return this.focusables()[0] },
        lastFocusable() { return this.focusables().slice(-1)[0] },
        nextFocusable() { return this.focusables()[this.nextFocusableIndex()] || this.firstFocusable() },
        prevFocusable() { return this.focusables()[this.prevFocusableIndex()] || this.lastFocusable() },
        nextFocusableIndex() { return (this.focusables().indexOf(document.activeElement) + 1) % (this.focusables().length + 1) },
        prevFocusableIndex() { return Math.max(0, this.focusables().indexOf(document.activeElement)) -1 },
    }"
    x-init="$watch('show', value => {
        if (value) {
            document.body.classList.add('overflow-y-hidden');
            {{ $attributes->has('focusable') ? 'setTimeout(() => firstFocusable().focus(), 100)' : '' }}
        } else {
            document.body.classList.remove('overflow-y-hidden');
        }
    })"
    x-on:open-modal.window="$event.detail == '{{ $name }}' ? show = true : null"
    x-on:close-modal.window="$event.detail == '{{ $name }}' ? show = false : null"
    x-on:close.stop="show = false"
    x-on:keydown.escape.window="show = false"
    x-on:keydown.tab.prevent="$event.shiftKey || nextFocusable().focus()"
    x-on:keydown.shift.tab.prevent="prevFocusable().focus()"
    x-show="show"
    class="fixed inset-0 overflow-y-auto px-4 py-6 sm:px-0 z-50"
    style="display: {{ $show ? 'block' : 'none' }};"
>
    <div
        x-show="show"
        class="fixed inset-0 transform transition-all"
        x-on:click="show = false"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
    >
        <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
    </div>

    <div
        x-show="show"
        class="mb-6 bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-xl transform transition-all sm:w-full {{ $maxWidth }} sm:mx-auto"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
    >
        {{ $slot }}
    </div>
</div>


=== FILE: resources/views\components\nav-link.blade.php ===

@props(['active'])

@php
$classes = ($active ?? false)
            ? 'inline-flex items-center px-1 pt-1 border-b-2 border-indigo-400 dark:border-indigo-600 text-sm font-medium leading-5 text-gray-900 dark:text-gray-100 focus:outline-none focus:border-indigo-700 transition duration-150 ease-in-out'
            : 'inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium leading-5 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-700 focus:outline-none focus:text-gray-700 dark:focus:text-gray-300 focus:border-gray-300 dark:focus:border-gray-700 transition duration-150 ease-in-out';
@endphp

<a {{ $attributes->merge(['class' => $classes]) }}>
    {{ $slot }}
</a>


=== FILE: resources/views\components\primary-button.blade.php ===

<button {{ $attributes->merge(['type' => 'submit', 'class' => 'inline-flex items-center px-4 py-2 bg-gray-800 dark:bg-gray-200 border border-transparent rounded-md font-semibold text-xs text-white dark:text-gray-800 uppercase tracking-widest hover:bg-gray-700 dark:hover:bg-white focus:bg-gray-700 dark:focus:bg-white active:bg-gray-900 dark:active:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition ease-in-out duration-150']) }}>
    {{ $slot }}
</button>


=== FILE: resources/views\components\responsive-nav-link.blade.php ===

@props(['active'])

@php
$classes = ($active ?? false)
            ? 'block w-full ps-3 pe-4 py-2 border-l-4 border-indigo-400 dark:border-indigo-600 text-start text-base font-medium text-indigo-700 dark:text-indigo-300 bg-indigo-50 dark:bg-indigo-900/50 focus:outline-none focus:text-indigo-800 dark:focus:text-indigo-200 focus:bg-indigo-100 dark:focus:bg-indigo-900 focus:border-indigo-700 dark:focus:border-indigo-300 transition duration-150 ease-in-out'
            : 'block w-full ps-3 pe-4 py-2 border-l-4 border-transparent text-start text-base font-medium text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 hover:border-gray-300 dark:hover:border-gray-600 focus:outline-none focus:text-gray-800 dark:focus:text-gray-200 focus:bg-gray-50 dark:focus:bg-gray-700 focus:border-gray-300 dark:focus:border-gray-600 transition duration-150 ease-in-out';
@endphp

<a {{ $attributes->merge(['class' => $classes]) }}>
    {{ $slot }}
</a>


=== FILE: resources/views\components\secondary-button.blade.php ===

<button {{ $attributes->merge(['type' => 'button', 'class' => 'inline-flex items-center px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-500 rounded-md font-semibold text-xs text-gray-700 dark:text-gray-300 uppercase tracking-widest shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-25 transition ease-in-out duration-150']) }}>
    {{ $slot }}
</button>


=== FILE: resources/views\components\text-input.blade.php ===

@props(['disabled' => false])

<input @disabled($disabled) {{ $attributes->merge(['class' => 'border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 focus:border-indigo-500 dark:focus:border-indigo-600 focus:ring-indigo-500 dark:focus:ring-indigo-600 rounded-md shadow-sm']) }}>


=== FILE: resources/views\layouts\app.blade.php ===

<!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-token" content="{{ csrf_token() }}">

    <title>{{ config('app.name', 'Laravel') }}</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css?family=figtree:400,500,600&display=swap" rel="stylesheet" />
    <link rel="icon" href="@yield('favicon', asset('favicon.ico'))">

    <!-- Scripts -->
    @vite(['resources/css/app.css', 'resources/js/app.js'])
</head>

<body class="font-sans antialiased">
    <div class="min-h-screen bg-gray-100 dark:bg-gray-900">
        @include('layouts.navigation')

        <!-- Page Heading -->
        @isset($header)
            <header class="bg-white dark:bg-gray-800 shadow">
                <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
                    {{ $header }}
                </div>
            </header>
        @endisset

        <!-- Page Content -->
        <main class="pb-3">
            {{ $slot }}
        </main>
    </div>
    @yield('scripts')
</body>

</html>

=== FILE: resources/views\layouts\footer.blade.php ===

<footer class="bg-gray-800 border-t border-indigo-700 mt-12 pt-10 pb-6 text-gray-400">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-2 md:grid-cols-2 gap-8">
            {{-- 1. About Starium / Contact --}}
            <div>
                <h4 class="text-xl font-bold text-white mb-4">Starium Rental</h4>
                <p class="text-sm mb-3">The premier space for costume rentals, powered by Laravel and pure cosmic energy.</p>
                <p class="text-sm">
                    Email : support@starium.test <br>
                    Address : Andromeda Galaxy Hub, Earth Sector
                </p>
            </div>

            {{-- 2. Quick Links --}}
            <div>
                <h4 class="text-xl font-bold text-white mb-4">Quick Links</h4>
                <ul class="space-y-2 text-sm">
                    <li><a href="{{ route('catalog') }}#sale-banner" class="hover:text-pink-400 transition">Flash Sale Deals</a></li>
                    <li><a href="{{ route('catalog') }}#about" class="hover:text-pink-400 transition">Our Mission (About)</a></li>
                    <li><a href="{{ route('login') }}" class="hover:text-pink-400 transition">Log In / Register</a></li>
                    <li><p class="mt-2 text-xs">Powered by Laravel, PHP, and Node.js.</p></li>  
            </div>
        </div>

        <div class="mt-10 border-t border-gray-700 pt-6 text-center text-sm">
            &copy; {{ date('Y') }} Starium Cosplay Rental. All Rights Reserved.
        </div>
    </div>
</footer>

=== FILE: resources/views\layouts\guest.blade.php ===

<!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-token" content="{{ csrf_token() }}">

    <title>{{ config('app.name', 'Laravel') }}</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css?family=figtree:400,500,600&display=swap" rel="stylesheet" />

    <!-- Scripts -->
    @vite(['resources/css/app.css', 'resources/js/app.js'])
</head>

<body class="font-sans text-gray-900 antialiased">
    <div class="min-h-screen flex flex-col sm:justify-center items-center pt-6 sm:pt-0"
        style="background-color: #0c001c; background-image: url('{{ asset('images/galaxy_bg.png') }}'); background-size: cover; background-attachment: fixed;">

        <div>
            <a href="/">
                <x-application-logo class="w-20 h-20 fill-current text-indigo-400" />
            </a>
        </div>

        <div class="w-full sm:max-w-md mt-6 px-0 py-0 bg-gray-800 shadow-md overflow-hidden sm:rounded-lg">
            {{ $slot }}
        </div>
    </div>
</body>

</html>

=== FILE: resources/views\layouts\navigation.blade.php ===

@php
    use Illuminate\Support\Facades\Auth;

    $user = Auth::user();
    $isOwner = $user && $user->hasRole('owner');
    $isAdmin = $user && $user->hasRole('admin');
    $isRenter = $user && $user->hasRole('renter');
    $isUser = $user && $user->hasRole('user');
@endphp

<nav x-data="{ open: false }" class="bg-gray-900 border-b border-indigo-700 shadow-lg"
    style="background-image: radial-gradient(circle at center, rgba(30, 0, 70, 0.9) 0%, rgba(10, 0, 30, 1) 100%);">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
            <div class="flex">
                <div class="shrink-0 flex items-center">
                    <a href="{{ route('catalog') }}"
                        class="text-2xl font-extrabold text-white tracking-widest hover:text-indigo-400 transition duration-300">
                        âœ¨ Starium Rental
                    </a>
                </div>

                {{-- Desktop Links --}}
                <div class="hidden space-x-8 sm:-my-px sm:ms-10 sm:flex">
                    <x-nav-link :href="route('catalog')" :active="request()->routeIs('catalog')"
                        class="text-indigo-300 hover:text-white">
                        {{ __('Cosmic Catalog') }}
                    </x-nav-link>

                    {{-- NEW ANCHOR LINKS --}}
                    <x-nav-link href="{{ route('catalog') }}#sale-banner" class="text-yellow-300 hover:text-white">
                        {{ __('Flash Sale') }}
                    </x-nav-link>
                    <x-nav-link href="{{ route('catalog') }}#catalog" class="text-indigo-300 hover:text-white">
                        {{ __('Collections') }}
                    </x-nav-link>
                    <x-nav-link href="{{ route('catalog') }}#about" class="text-pink-300 hover:text-white">
                        {{ __('About Starium') }}
                    </x-nav-link>
                    <x-nav-link href="#" class="text-pink-300 hover:text-white">
                        {{ __('|') }}
                    </x-nav-link>

                    {{-- Auth Links --}}
                    @auth
                        @if ($isOwner)
                            <x-nav-link :href="route('admin.dashboard')" :active="request()->routeIs('admin.dashboard')"
                                class="text-red-300 hover:text-white">
                                {{ __('Owner Deck') }}
                            </x-nav-link>
                        @elseif ($isAdmin)
                            <x-nav-link :href="route('admin.dashboard')" :active="request()->routeIs('admin.dashboard')"
                                class="text-red-300 hover:text-white">
                                {{ __('Admin Deck') }}
                            </x-nav-link>
                        @elseif ($isRenter)
                            <x-nav-link :href="route('renter.dashboard')" :active="request()->routeIs('renter.dashboard')"
                                class="text-pink-300 hover:text-white">
                                {{ __('Renter Panel') }}
                            </x-nav-link>
                        @elseif ($isUser)
                            <x-nav-link :href="route('user.orders')" :active="request()->routeIs('user.orders')"
                                class="text-indigo-300 hover:text-white">
                                {{ __('My Orders') }}
                            </x-nav-link>
                        @endif
                    @endauth
                </div>
            </div>

            {{-- Right Section: Profile Dropdown --}}
            <div class="hidden sm:flex sm:items-center sm:ms-6">
                @guest
                    <div class="space-x-4">
                        <a href="{{ route('login') }}"
                            class="text-indigo-300 hover:text-white transition duration-300 text-sm font-semibold px-3 py-2 border border-indigo-500 rounded-md hover:bg-indigo-700">
                            {{ __('Log in') }}
                        </a>
                        <a href="{{ route('register') }}"
                            class="text-white bg-pink-600 hover:bg-pink-700 transition duration-300 text-sm font-semibold px-3 py-2 rounded-md">
                            {{ __('Register') }}
                        </a>
                    </div>
                @endguest

                @auth
                    <x-dropdown align="right" width="48">
                        <x-slot name="trigger">
                            <button
                                class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-indigo-200 hover:text-white focus:outline-none transition ease-in-out duration-150">
                                @php
                                    $profilePicUrl = Auth::user()->profile_picture
                                        ? asset('storage/' . Auth::user()->profile_picture)
                                        : asset('default_images/default_avatar.png');
                                @endphp

                                <img src="{{ $profilePicUrl }}" alt="{{ Auth::user()->name }} Avatar"
                                    class="h-6 w-6 rounded-full object-cover mr-2 border border-indigo-400"
                                    onerror="this.onerror=null; this.src='{{ asset('default_images/default_avatar.png') }}';">
                                <div>{{ Auth::user()->name }}</div>
                            </button>
                        </x-slot>

                        <x-slot name="content">
                            <x-dropdown-link :href="route('profile.edit')">
                                {{ __('Profile') }}
                            </x-dropdown-link>

                            <!-- Authentication -->
                            <form method="POST" action="{{ route('logout') }}">
                                @csrf
                                <x-dropdown-link :href="route('logout')"
                                    onclick="event.preventDefault(); this.closest('form').submit();">
                                    {{ __('Log Out') }}
                                </x-dropdown-link>
                            </form>
                        </x-slot>
                    </x-dropdown>
                @endauth
            </div>

            {{-- Hamburger for Mobile --}}
            <div class="-me-2 flex items-center sm:hidden">
                <button @click="open = ! open"
                    class="inline-flex items-center justify-center p-2 rounded-md text-indigo-200 hover:text-white hover:bg-indigo-800 focus:outline-none transition duration-150 ease-in-out">
                    <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                        <path :class="{'hidden': open, 'inline-flex': ! open }" class="inline-flex"
                            stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16" />
                        <path :class="{'hidden': ! open, 'inline-flex': open }" class="hidden" stroke-linecap="round"
                            stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    {{-- Responsive (Mobile) Navigation --}}
    <div :class="{'block': open, 'hidden': ! open}" class="hidden sm:hidden bg-gray-800">
        <div class="pt-2 pb-3 space-y-1">
            <x-responsive-nav-link :href="route('catalog')" :active="request()->routeIs('catalog')">
                {{ __('Cosmic Catalog') }}
            </x-responsive-nav-link>

            @auth
                @if ($isAdmin)
                    <x-responsive-nav-link :href="route('admin.dashboard')" :active="request()->routeIs('admin.dashboard')">
                        {{ __('Admin Deck') }}
                    </x-responsive-nav-link>
                @elseif ($isRenter)
                    <x-responsive-nav-link :href="route('renter.dashboard')" :active="request()->routeIs('renter.dashboard')">
                        {{ __('Renter Panel') }}
                    </x-responsive-nav-link>
                @elseif ($isUser)
                    <x-responsive-nav-link :href="route('user.orders')" :active="request()->routeIs('user.orders')">
                        {{ __('My Orders') }}
                    </x-responsive-nav-link>
                @endif
            @endauth
        </div>

        {{-- Mobile Guest Links --}}
        @guest
            <div class="pt-4 pb-1 border-t border-indigo-700">
                <x-responsive-nav-link :href="route('login')">
                    {{ __('Log in') }}
                </x-responsive-nav-link>
                <x-responsive-nav-link :href="route('register')">
                    {{ __('Register') }}
                </x-responsive-nav-link>
            </div>
        @endguest

        {{-- Mobile Profile + Logout --}}
        @auth
            <div class="pt-4 pb-1 border-t border-indigo-700">
                <div class="px-4 text-indigo-200 flex items-center">

                    @php
                        $profilePicUrl = Auth::user()->profile_picture
                            ? asset('storage/' . Auth::user()->profile_picture)
                            : asset('default_images/default_avatar.png');
                    @endphp

                    <img src="{{ $profilePicUrl }}" alt="{{ Auth::user()->name }} Avatar"
                        class="h-8 w-8 rounded-full object-cover mr-3 border border-indigo-400"
                        onerror="this.onerror=null; this.src='{{ asset('default_images/default_avatar.png') }}';">
                    <div>
                        <div class="font-medium text-base">{{ Auth::user()->name }}</div>
                        <div class="font-medium text-sm">{{ Auth::user()->email }}</div>
                    </div>
                </div>

                <div class="mt-3 space-y-1">
                    <x-responsive-nav-link :href="route('profile.edit')">
                        {{ __('Profile') }}
                    </x-responsive-nav-link>

                    <form method="POST" action="{{ route('logout') }}">
                        @csrf
                        <x-responsive-nav-link :href="route('logout')"
                            onclick="event.preventDefault(); this.closest('form').submit();">
                            {{ __('Log Out') }}
                        </x-responsive-nav-link>
                    </form>
                </div>
            </div>
        @endauth
    </div>
</nav>

=== FILE: resources/views\order\detail.blade.php ===

@php
    use App\Models\Order;
    use Illuminate\Support\Facades\Route;
    use Carbon\Carbon;
    // This view expects the $order variable to be passed from a Controller.
    // If accessing directly via route::view (bad practice!), we fetch it here:
    $orderId = Route::current()->parameter('order_id');
    $order = $order ?? Order::with(['costume.renter.store', 'user'])->findOrFail($orderId);

    $statusColor = [
        'waiting' => 'border-yellow-500',
        'confirmed' => 'border-indigo-500',
        'borrowed' => 'border-red-500',
        'returned' => 'border-gray-500',
        'completed' => 'border-green-500',
        'rejected' => 'border-red-800'
    ][$order->status] ?? 'border-gray-600';
@endphp

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Order Details: <span class="text-pink-400">#{{ $order->order_code }}</span> ðŸŒ™
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-gray-800 shadow-xl sm:rounded-lg p-8 space-y-6 border-l-4 {{ $statusColor }}">

                <div class="flex justify-between items-start border-b border-gray-700 pb-4">
                    <div>
                        <p class="text-sm text-gray-400">Order Placed On: {{ $order->created_at->format('Y-m-d H:i') }}
                        </p>
                        <p class="text-4xl font-extrabold mt-2"
                            style="color: {{ $statusColor === 'border-green-500' ? '#10B981' : '#F59E0B' }};">
                            STATUS: {{ strtoupper($order->status) }}
                        </p>
                    </div>

                    {{-- Action Button based on User Role/Status --}}
                    <div>
                        @if (Auth::user()->hasRole('admin'))
                            <a href="{{ route('admin.transactions') }}" class="text-red-400 hover:underline text-sm">&larr;
                                Back to Admin Monitor</a>
                        @elseif (Auth::user()->hasRole('renter'))
                            <a href="{{ route('renter.orders') }}" class="text-red-400 hover:underline text-sm">&larr; Back
                                to Renter Orders</a>
                        @else
                            <a href="{{ route('user.orders') }}" class="text-red-400 hover:underline text-sm">&larr; Back to
                                My Orders</a>
                        @endif
                    </div>
                </div>

                {{-- 2. COSTUME AND RENTER INFO --}}
                <div class="grid grid-cols-3 gap-6 text-gray-300 border-b border-gray-700 pb-6">
                    <div class="col-span-1">
                        <p class="text-lg font-bold text-indigo-400 mb-2">Costume Ordered</p>
                        <a href="{{ route('costume.detail', $order->costume_id) }}"
                            class="text-pink-400 hover:underline">
                            <p class="text-xl font-semibold">{{ $order->costume->name ?? 'N/A' }}</p>
                        </a>
                        <p class="text-sm mt-1">Series: {{ $order->costume->series ?? 'N/A' }}</p>
                        <p class="text-sm">Size: {{ $order->costume->size ?? 'N/A' }}</p>
                    </div>
                    <div class="col-span-1">
                        <p class="text-lg font-bold text-indigo-400 mb-2">Renter/Store</p>
                        <p class="text-white">{{ $order->costume->renter->name ?? 'N/A' }}</p>
                        <p class="text-sm text-gray-500">{{ $order->costume->renter->store->store_name ?? 'N/A' }}</p>
                    </div>
                    <div class="col-span-1">
                        <p class="text-lg font-bold text-indigo-400 mb-2">Customer</p>
                        <p>{{ $order->user->name ?? 'N/A' }}</p>
                        <p class="text-sm text-gray-500">{{ $order->user->email ?? 'N/A' }}</p>
                    </div>
                </div>

                {{-- 3. FINANCIALS AND DATES --}}
                <div class="grid grid-cols-3 gap-6 text-gray-300">
                    <div>
                        <p class="text-lg font-bold text-green-400 mb-2">Rental Period</p>
                        <p>Start: {{ $order->start_date->format('Y-m-d') }}</p>
                        <p>End: {{ $order->end_date->format('Y-m-d') }}</p>
                        <p class="text-sm text-gray-500 mt-1">Duration:
                            {{ $order->start_date->diffInDays($order->end_date) + 1 }} days</p>
                    </div>
                    <div class="col-span-2">
                        <p class="text-lg font-bold text-green-400 mb-2">Financial Breakdown</p>
                        <p>Price per Day: Rp {{ number_format($order->costume->price_per_day ?? 0, 0, ',', '.') }}</p>
                        <p class="text-2xl font-extrabold text-white mt-3">
                            TOTAL PAID: Rp {{ number_format($order->total_price, 0, ',', '.') }}
                        </p>
                    </div>
                </div>

                {{-- 4. RENTER/ADMIN ACTION LOGIC (Quick Status Update) --}}
                @if (Auth::user()->hasRole('admin') || Auth::id() === $order->costume->user_id)
                    <div class="mt-8 pt-6 border-t border-gray-700">
                        <p class="text-lg font-bold text-red-400 mb-3">Update Order Status</p>

                        <form x-data="{ newStatus: '' }" @submit.prevent="
                                    let url;
                                    let body = {};

                                    if (newStatus === 'reject') {
                                        url = '{{ route('renter.orders.reject', $order->id) }}';
                                    } else {
                                        url = '{{ route('renter.orders.update.status', $order->id) }}';
                                        body.new_status = newStatus;
                                    }

                                    fetch(url, {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                            'X-CSRF-TOKEN': '{{ csrf_token() }}'
                                        },
                                        body: JSON.stringify(body)
                                    }).then(response => {
                                        if (response.ok) {
                                            window.location.reload(); // Reload to see the status change
                                        } else {
                                            alert('Error updating status. Check console.');
                                        }
                                    });
                                  " class="flex space-x-4 items-center">

                            <select x-model="newStatus" required
                                class="bg-gray-700 border-red-500 rounded-md text-white text-sm py-2 px-3">
                                <option value="">Select New Status</option>
                                <option value="confirmed" {{ $order->status === 'confirmed' ? 'disabled' : '' }}>Confirmed
                                    (Ready for Pickup)</option>
                                <option value="borrowed" {{ $order->status === 'borrowed' ? 'disabled' : '' }}>Borrowed (Out
                                    for Rent)</option>
                                <option value="returned" {{ $order->status === 'returned' || $order->status === 'completed' ? 'disabled' : '' }}>Returned (Awaiting Check)</option>
                                <option value="completed" {{ $order->status === 'completed' ? 'disabled' : '' }}>Completed
                                    (Finalize)</option>
                                <option value="rejected" {{ $order->status === 'rejected' ? 'disabled' : '' }}>Reject
                                    (Pending/Waiting only)</option>
                            </select>

                            <x-primary-button type="submit" class="bg-red-600 hover:bg-red-700"
                                x-bind:disabled="newStatus === '' || '{{ $order->status }}' === 'completed' || '{{ $order->status }}' === 'rejected'">
                                Update Order
                            </x-primary-button>
                            <p class="text-sm text-gray-500" x-show="newStatus === 'rejected'">Warning: Rejecting returns
                                stock.</p>
                        </form>
                    </div>
                @endif
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\profile\edit.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            {{ __('Cosmic Account Settings') }}
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6">

            {{-- 1. STANDARD PROFILE INFO --}}
            <div class="p-4 sm:p-8 bg-gray-800 shadow sm:rounded-lg border-t-4 border-indigo-500">
                <div class="max-w-xl">
                    @include('profile.partials.update-profile-information-form')
                </div>
            </div>

            {{-- 2. RENTER STORE SETUP --}}
            @if (Auth::user()->hasRole('renter'))
                <div class="p-4 sm:p-8 bg-gray-800 shadow sm:rounded-lg border-t-4 border-pink-500">
                    <div class="max-w-xl">
                        <h2 class="text-xl font-medium text-pink-400 border-b border-pink-700 pb-2 mb-4">
                            {{ __('Renter Shop & Store Details') }}
                        </h2>
                        @include('profile.partials.renter-store-form')
                    </div>
                </div>
            @endif

            {{-- 3. PASSWORD UPDATE --}}
            <div class="p-4 sm:p-8 bg-gray-800 shadow sm:rounded-lg border-t-4 border-yellow-500">
                <div class="max-w-xl">
                    @include('profile.partials.update-password-form')
                </div>
            </div>

            {{-- 4. DELETE ACCOUNT --}}
            <div class="p-4 sm:p-8 bg-gray-800 shadow sm:rounded-lg border-t-4 border-red-500">
                <div class="max-w-xl">
                    @include('profile.partials.delete-user-form')
                </div>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\profile\partials\delete-user-form.blade.php ===

<section class="space-y-6">
    <header>
        <h2 class="text-lg font-medium text-gray-900 dark:text-gray-100">
            {{ __('Delete Account') }}
        </h2>

        <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">
            {{ __('Once your account is deleted, all of its resources and data will be permanently deleted. Before deleting your account, please download any data or information that you wish to retain.') }}
        </p>
    </header>

    <x-danger-button
        x-data=""
        x-on:click.prevent="$dispatch('open-modal', 'confirm-user-deletion')"
    >{{ __('Delete Account') }}</x-danger-button>

    <x-modal name="confirm-user-deletion" :show="$errors->userDeletion->isNotEmpty()" focusable>
        <form method="post" action="{{ route('profile.destroy') }}" class="p-6">
            @csrf
            @method('delete')

            <h2 class="text-lg font-medium text-gray-900 dark:text-gray-100">
                {{ __('Are you sure you want to delete your account?') }}
            </h2>

            <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">
                {{ __('Once your account is deleted, all of its resources and data will be permanently deleted. Please enter your password to confirm you would like to permanently delete your account.') }}
            </p>

            <div class="mt-6">
                <x-input-label for="password" value="{{ __('Password') }}" class="sr-only" />

                <x-text-input
                    id="password"
                    name="password"
                    type="password"
                    class="mt-1 block w-3/4"
                    placeholder="{{ __('Password') }}"
                />

                <x-input-error :messages="$errors->userDeletion->get('password')" class="mt-2" />
            </div>

            <div class="mt-6 flex justify-end">
                <x-secondary-button x-on:click="$dispatch('close')">
                    {{ __('Cancel') }}
                </x-secondary-button>

                <x-danger-button class="ms-3">
                    {{ __('Delete Account') }}
                </x-danger-button>
            </div>
        </form>
    </x-modal>
</section>


=== FILE: resources/views\profile\partials\renter-store-form.blade.php ===

<section>
    <p class="mt-1 text-sm text-gray-400">
        {{ __("Manage your public-facing store name, logo, and description. This is what customers see in the catalog.") }}
    </p>

    <form method="post" action="{{ route('renter.store.update') }}" enctype="multipart/form-data"
        class="mt-6 space-y-6">
        @csrf
        @method('patch')

        {{-- Store Name --}}
        <div>
            <x-input-label for="store_name" :value="__('Store Name')" class="text-pink-400" />
            <x-text-input id="store_name" name="store_name" type="text"
                class="mt-1 block w-full bg-gray-700 border-gray-600 text-white" :value="old('store_name', $user->store->store_name ?? $user->name . ' Shop')" required />
            <x-input-error class="mt-2" :messages="$errors->get('store_name')" />
        </div>

        {{-- Store Logo --}}
        <div>
            <x-input-label for="store_logo" :value="__('Store Logo')" class="text-pink-400" />
            <input id="store_logo" name="store_logo" type="file" Â  Â  Â  Â  Â  Â  Â  Â 
                class="block mt-1 w-full text-sm text-gray-200 border-gray-600 rounded-lg cursor-pointer bg-gray-700 focus:outline-none" />
            <x-input-error class="mt-2" :messages="$errors->get('store_logo')" />
            @if($user->store && $user->store->store_logo_path)
                <p class="text-xs text-gray-500 mt-1">
                    Current File: {{ basename($user->store->store_logo_path) }}
                </p>
            @endif
        </div>

        {{-- Store Description --}}
        <div>
            <x-input-label for="description" :value="__('Store Description (Public)')" class="text-pink-400" />
            <textarea id="description" name="description"
                class="mt-1 block w-full border-gray-600 bg-gray-700 text-white focus:border-pink-500 focus:ring-pink-500 rounded-md shadow-sm">{{ old('description', $user->store->description ?? 'We rent the best costumes in the entire solar system!') }}</textarea>
            <x-input-error class="mt-2" :messages="$errors->get('description')" />
        </div>

        {{-- Submit Button + Status --}}
        <div class="flex items-center gap-4">
            <x-primary-button class="bg-pink-600 hover:bg-pink-700">
                {{ __('Save Store Details') }}
            </x-primary-button>

            @if (session('status') === 'renter-store-updated')
                <p x-data="{ show: true }" x-show="show" x-transition x-init="setTimeout(() => show = false, 2000)"
                    class="text-sm text-green-600 dark:text-green-400">
                    {{ __('Store Saved.') }}
                </p>
            @endif
        </div>
    </form>
</section>

=== FILE: resources/views\profile\partials\update-password-form.blade.php ===

<section>
    <header>
        <h2 class="text-lg font-medium text-gray-900 dark:text-gray-100">
            {{ __('Update Password') }}
        </h2>

        <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">
            {{ __('Ensure your account is using a long, random password to stay secure.') }}
        </p>
    </header>

    <form method="post" action="{{ route('password.update') }}" class="mt-6 space-y-6">
        @csrf
        @method('put')

        <div>
            <x-input-label for="update_password_current_password" :value="__('Current Password')" />
            <x-text-input id="update_password_current_password" name="current_password" type="password" class="mt-1 block w-full" autocomplete="current-password" />
            <x-input-error :messages="$errors->updatePassword->get('current_password')" class="mt-2" />
        </div>

        <div>
            <x-input-label for="update_password_password" :value="__('New Password')" />
            <x-text-input id="update_password_password" name="password" type="password" class="mt-1 block w-full" autocomplete="new-password" />
            <x-input-error :messages="$errors->updatePassword->get('password')" class="mt-2" />
        </div>

        <div>
            <x-input-label for="update_password_password_confirmation" :value="__('Confirm Password')" />
            <x-text-input id="update_password_password_confirmation" name="password_confirmation" type="password" class="mt-1 block w-full" autocomplete="new-password" />
            <x-input-error :messages="$errors->updatePassword->get('password_confirmation')" class="mt-2" />
        </div>

        <div class="flex items-center gap-4">
            <x-primary-button>{{ __('Save') }}</x-primary-button>

            @if (session('status') === 'password-updated')
                <p
                    x-data="{ show: true }"
                    x-show="show"
                    x-transition
                    x-init="setTimeout(() => show = false, 2000)"
                    class="text-sm text-gray-600 dark:text-gray-400"
                >{{ __('Saved.') }}</p>
            @endif
        </div>
    </form>
</section>


=== FILE: resources/views\profile\partials\update-profile-information-form.blade.php ===

<section>
    <header>
        <h2 class="text-lg font-medium text-gray-900 dark:text-gray-100">
            {{ __('Cosmic Profile Details') }}
        </h2>

        <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">
            {{ __("Update your basic contact and profile information for the platform.") }}
        </p>
    </header>

    <form method="post" action="{{ route('profile.update') }}" class="mt-6 space-y-6" enctype="multipart/form-data">
        @csrf
        @method('patch')

        <div>
            <x-input-label for="name" :value="__('User/Account Name')" class="text-indigo-400" />
            <x-text-input id="name" name="name" type="text"
                class="mt-1 block w-full bg-gray-700 border-gray-600 text-white" :value="old('name', $user->name)"
                required autofocus autocomplete="name" />
            <x-input-error class="mt-2" :messages="$errors->get('name')" />
        </div>

        <div>
            <x-input-label for="email" :value="__('Email')" class="text-indigo-400" />
            <x-text-input id="email" name="email" type="email"
                class="mt-1 block w-full bg-gray-700 border-gray-600 text-white" :value="old('email', $user->email)"
                required autocomplete="username" />
            <x-input-error class="mt-2" :messages="$errors->get('email')" />

            @if ($user instanceof \Illuminate\Contracts\Auth\MustVerifyEmail && !$user->hasVerifiedEmail())
                <p class="text-sm mt-2 text-gray-800 dark:text-gray-200">
                    {{ __('Your email address is unverified.') }}

                    <button form="send-verification"
                        class="underline text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800">
                        {{ __('Click here to re-send the verification email.') }}
                    </button>
                </p>

                @if (session('status') === 'verification-link-sent')
                    <p class="mt-2 font-medium text-sm text-green-600 dark:text-green-400">
                        {{ __('A new verification link has been sent to your email address.') }}
                    </p>
                @endif
            @endif
        </div>

        <div>
            <x-input-label for="profile_picture" :value="__('Public Profile Picture')" class="text-indigo-400" />
            <input id="profile_picture" name="profile_picture" type="file"
                class="block mt-1 w-full text-sm text-gray-200 border-gray-600 rounded-lg cursor-pointer bg-gray-700 focus:outline-none" />
            <x-input-error class="mt-2" :messages="$errors->get('profile_picture')" />

            @if ($user->profile_picture)
                <p class="text-xs text-gray-500 mt-1">
                    Current File: {{ basename($user->profile_picture) }}
                </p>
            @endif
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <x-input-label for="phone_number" :value="__('Phone Number')" class="text-indigo-400" />
                <x-text-input id="phone_number" name="phone_number" type="text"
                    class="mt-1 block w-full bg-gray-700 border-gray-600 text-white" :value="old('phone_number', $user->phone_number)" />
                <x-input-error class="mt-2" :messages="$errors->get('phone_number')" />
            </div>

            <div class="col-span-1 md:col-span-2">
                <x-input-label for="address" :value="__('Address')" class="text-indigo-400" />
                <x-text-input id="address" name="address" type="text"
                    class="mt-1 block w-full bg-gray-700 border-gray-600 text-white" :value="old('address', $user->address)" />
                <x-input-error class="mt-2" :messages="$errors->get('address')" />
            </div>
        </div>

        <div class="flex items-center gap-4">
            <x-primary-button class="bg-indigo-600 hover:bg-indigo-700">
                {{ __('Save Changes') }}
            </x-primary-button>

            @if (session('status') === 'profile-updated')
                <p x-data="{ show: true }" x-show="show" x-transition x-init="setTimeout(() => show = false, 2000)"
                    class="text-sm text-green-600 dark:text-green-400">
                    {{ __('Saved.') }}
                </p>
            @endif
        </div>
    </form>
</section>

=== FILE: resources/views\renter\dashboard.blade.php ===

@php
    use Illuminate\Support\Facades\Auth;
    use App\Models\Order;
    use App\Models\Costume;

    $user = Auth::user();

    $costumeIds = $user->costumes->pluck('id');

    $totalOrders = Order::whereIn('costume_id', $costumeIds)->count();
    $activeOrders = Order::whereIn('costume_id', $costumeIds)
        ->whereIn('status', ['waiting', 'confirmed', 'borrowed'])
        ->count();
    $totalRevenue = Order::whereIn('costume_id', $costumeIds)
        ->whereIn('status', ['completed', 'borrowed']) 
        ->sum('total_price');

    $costumeSales = Order::selectRaw('costume_id, COUNT(*) as rental_count, SUM(total_price) as total_earnings')
        ->whereIn('costume_id', $costumeIds)
        ->whereIn('status', ['completed', 'borrowed'])
        ->groupBy('costume_id')
        ->with('costume')
        ->orderByDesc('rental_count')
        ->get();

    $monthlyRevenue = [
        (object) ['month' => 'Jan', 'sales' => 1200000],
        (object) ['month' => 'Feb', 'sales' => 1500000],
        (object) ['month' => 'Mar', 'sales' => 1800000],
        (object) ['month' => 'Apr', 'sales' => 900000],
    ];
    $monthlyRevenueJson = json_encode(array_column($monthlyRevenue, 'sales'));
@endphp

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Renter Store Panel âœ¨ <span class="text-pink-400">Your Cosmic Catalog</span>
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-gray-800 bg-opacity-90 overflow-hidden shadow-xl sm:rounded-lg p-8 space-y-10">
                <p class="text-3xl font-extrabold text-pink-400">Welcome back, {{ $user->name }}.</p>

                {{-- 1. TOP LEVEL METRICS --}}
                <div class="grid grid-cols-3 gap-6 text-center">
                    <div class="p-4 bg-indigo-700 rounded-lg shadow-xl">
                        <p class="text-sm text-indigo-200">Total Listings</p>
                        <p class="text-4xl font-extrabold text-white mt-1">{{ $costumeIds->count() }}</p>
                    </div>
                    <div class="p-4 bg-yellow-700 rounded-lg shadow-xl">
                        <p class="text-sm text-yellow-200">Active Rentals / Pending</p>
                        <p class="text-4xl font-extrabold text-white mt-1">{{ $activeOrders }}</p>
                    </div>
                    <div class="p-4 bg-green-700 rounded-lg shadow-xl">
                        <p class="text-sm text-green-200">Total Revenue</p>
                        <p class="text-3xl font-extrabold text-white mt-1">
                            Rp {{ number_format($totalRevenue, 0, ',', '.') }}
                        </p>
                    </div>
                </div>

                {{-- 2. ACTION NAVIGATION --}}
                <div class="mt-8 grid grid-cols-3 gap-6 text-center">
                    <a href="{{ route('renter.profile.setup') }}"
                        class="block p-6 bg-pink-700 hover:bg-pink-600 rounded-lg shadow-lg transition duration-300">
                        <span class="text-3xl font-extrabold text-white">Setup Profile</span>
                    </a>
                    <a href="{{ route('renter.costumes.manage') }}"
                        class="block p-6 bg-indigo-700 hover:bg-indigo-600 rounded-lg shadow-lg transition duration-300">
                        <span class="text-3xl font-extrabold text-white">Manage Costumes</span>
                    </a>
                    <a href="{{ route('renter.orders') }}"
                        class="block p-6 bg-yellow-700 hover:bg-yellow-600 rounded-lg shadow-lg transition duration-300">
                        <span class="text-3xl font-extrabold text-white">View Orders</span>
                    </a>
                </div>

                {{-- 3. SALES ANALYTIC --}}
                <h3 class="text-2xl font-bold text-indigo-400 border-b border-gray-700 pb-3 mt-8">Sales Overview</h3>

                <div class="grid grid-cols-1 gap-8">
                    <div class="bg-gray-700 p-6 rounded-lg shadow-inner">
                        <h4 class="text-lg font-semibold text-white mb-4">Top Costumes by Rental Count
                            ({{ $costumeSales->count() }})</h4>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-600">
                                <thead class="bg-gray-600">
                                    <tr>
                                        <th class="px-3 py-2 text-left text-xs font-medium text-white uppercase">Costume
                                        </th>
                                        <th class="px-3 py-2 text-left text-xs font-medium text-white uppercase">Rentals
                                        </th>
                                        <th class="px-3 py-2 text-left text-xs font-medium text-white uppercase">
                                            Earnings (Rp)</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-gray-700 divide-y divide-gray-600 text-gray-200">
                                    @forelse ($costumeSales as $sale)
                                        <tr>
                                            <td class="px-3 py-2 whitespace-nowrap text-sm">
                                                {{ $sale->costume->name ?? 'Deleted' }}</td>
                                            <td class="px-3 py-2 whitespace-nowrap text-sm">{{ $sale->rental_count }}</td>
                                            <td class="px-3 py-2 whitespace-nowrap text-sm">
                                                {{ number_format($sale->total_earnings, 0, ',', '.') }}</td>
                                        </tr>
                                    @empty
                                        <tr>
                                            <td colspan="3" class="px-3 py-2 text-center text-gray-400">No sales data yet.
                                            </td>
                                        </tr>
                                    @endforelse
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\renter\edit_costume.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Renter: Edit Cosmic Costume: <span class="text-pink-400">{{ $costume->name }}</span> ðŸš€
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg p-6 border-t-4 border-pink-500">
                <form action="{{ route('renter.costumes.update', $costume->id) }}" method="POST" enctype="multipart/form-data" class="space-y-6">
                    @csrf
                    @method('PATCH')

                    {{-- Costume Status Indicator --}}
                    <p class="text-sm font-bold {{ $costume->is_approved ? 'text-green-400' : 'text-yellow-400' }} pb-2 border-b border-gray-700">
                        Status: {{ $costume->is_approved ? 'LIVE in Catalog' : 'PENDING ADMIN APPROVAL' }}
                    </p>

                    {{-- Costume Basic Details --}}
                    <div>
                        <x-input-label for="character_name" :value="__('Character Name')" class="text-pink-400" />
                        <x-text-input id="character_name"
                            class="block mt-1 w-full bg-gray-700 border-gray-600 text-white" type="text"
                            name="character_name" value="{{ old('character_name', $costume->name) }}" required autofocus />
                    </div>

                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <x-input-label for="media_series" :value="__('Media Series (Anime/Game/Book)')"
                                class="text-pink-400" />
                            <x-text-input id="media_series"
                                class="block mt-1 w-full bg-gray-700 border-gray-600 text-white" type="text"
                                name="media_series" value="{{ old('media_series', $costume->series) }}" required />
                        </div>
                        <div>
                            <x-input-label for="size" :value="__('Size (e.g., M, L, Custom)')" class="text-pink-400" />
                            <x-text-input id="size" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white"
                                type="text" name="size" value="{{ old('size', $costume->size) }}" required />
                        </div>
                    </div>

                    {{-- Price and Condition --}}
                    <div class="grid grid-cols-3 gap-6">
                        <div>
                            <x-input-label for="price" :value="__('Price per Day (Rp)')" class="text-pink-400" />
                            <x-text-input id="price" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white"
                                type="number" name="price" value="{{ old('price', $costume->price_per_day) }}" required />
                        </div>
                        <div>
                            <x-input-label for="stock" :value="__('Stock')" class="text-pink-400" />
                            <x-text-input id="stock" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white"
                                type="number" name="stock" value="{{ old('stock', $costume->stock) }}" required />
                        </div>
                        <div>
                            <x-input-label for="condition" :value="__('Condition')" class="text-pink-400" />
                            <select id="condition" name="condition"
                                class="block mt-1 w-full border-gray-600 bg-gray-700 text-white focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm">
                                @foreach (['new', 'excellent', 'good', 'worn'] as $cond)
                                    <option value="{{ $cond }}" @selected(old('condition', $costume->condition) === $cond)>{{ ucfirst($cond) }}</option>
                                @endforeach
                            </select>
                        </div>
                    </div>

                    {{-- Tags and Image --}}
                    <div>
                        <x-input-label for="tags" :value="__('Tags (Comma Separated)')"
                            class="text-pink-400" />
                        {{-- Tags are stored as JSON array, convert back to string for editing --}}
                        <x-text-input id="tags" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white"
                            type="text" name="tags" placeholder="e.g., Fantasy, Armor, Event Promo" 
                            value="{{ old('tags', is_array($costume->tags) ? implode(', ', $costume->tags) : $costume->tags) }}" required />
                    </div>
                    
                    {{-- Image Replacement --}}
                    <div class="border-t border-gray-700 pt-4">
                        <x-input-label for="main_image" :value="__('Replace Main Costume Image')"
                            class="text-pink-400" />
                        <div class="flex items-center space-x-4 mt-2">
                            <div class="w-24 h-24 bg-gray-700 overflow-hidden rounded-lg flex-shrink-0">
                                @php
                                    $imageUrl = $costume->main_image_path ? asset('storage/' . $costume->main_image_path) : asset('default_images/default_costume.png');
                                @endphp
                                <img src="{{ $imageUrl }}" alt="Current Image" class="w-full h-full object-cover"
                                     onerror="this.onerror=null; this.src='{{ asset('default_images/default_costume.png') }}';">
                            </div>
                            <input id="main_image"
                                class="block w-full text-sm text-gray-200 border-gray-600 rounded-lg cursor-pointer bg-gray-700 focus:outline-none"
                                type="file" name="main_image" />
                        </div>
                    </div>
                    

                    <div class="flex items-center justify-end">
                        <x-primary-button class="bg-pink-600 hover:bg-pink-700">
                            {{ __('Save Changes') }}
                        </x-primary-button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\renter\manage_costumes.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight flex justify-between items-center">
            Renter: Costume Management Deck ðŸŒŒ
            <a href="{{ route('renter.costumes.upload') }}"
                class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-lg text-sm transition duration-300">
                + Upload New Costume
            </a>
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8" x-data="{
            sortColumn: 'name', 
            sortDirection: 'asc',
            filterStatus: '',
            costumes: {{ json_encode($costumes) }}, 

            get filteredCostumes() {
                // 1. Filter Logic
                let filtered = this.costumes.filter(costume => 
                    !this.filterStatus || 
                    (this.filterStatus === 'live' && costume.is_approved) ||
                    (this.filterStatus === 'pending' && !costume.is_approved)
                );

                // 2. Sort Logic
                return filtered.sort((a, b) => {
                    let aVal = a[this.sortColumn] || '';
                    let bVal = b[this.sortColumn] || '';

                    // Convert numbers/booleans for correct sorting
                    if (this.sortColumn === 'stock' || this.sortColumn === 'price_per_day') {
                        aVal = parseFloat(aVal);
                        bVal = parseFloat(bVal);
                    } else if (this.sortColumn === 'is_approved') {
                        // Sort boolean values (false/pending first)
                        aVal = a.is_approved;
                        bVal = b.is_approved;
                    }
                    
                    const comparison = aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                    return this.sortDirection === 'asc' ? comparison : -comparison;
                });
            },
            
            sort(column) {
                if (this.sortColumn === column) {
                    this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    this.sortColumn = column;
                    this.sortDirection = 'asc';
                }
            }
        }">

            <div class="bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg p-6 border-t-4 border-indigo-500">
                <h3 class="text-2xl font-bold text-white mb-6">My Current Catalog (<span
                        x-text="costumes.length"></span> Listings)</h3>

                <div class="flex space-x-4 mb-4 items-center">
                    <label for="filterStatus" class="text-gray-400">Filter Status:</label>
                    <select x-model="filterStatus" id="filterStatus"
                        class="bg-gray-700 border-pink-500 rounded-md text-white text-sm py-2 px-3">
                        <option value="">ALL STATUSES</option>
                        <option value="live">LIVE (Approved)</option>
                        <option value="pending">PENDING ADMIN</option>
                    </select>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                @foreach (['Costume Name' => 'name', 'Series' => 'series', 'Stock' => 'stock', 'Price/Day' => 'price_per_day', 'Status' => 'is_approved'] as $label => $column)
                                    <th @click="sort('{{ $column }}')"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600 transition">
                                        {{ $label }}
                                        <span x-show="sortColumn === '{{ $column }}'"
                                            x-text="sortDirection === 'asc' ? ' â–²' : ' â–¼'"></span>
                                    </th>
                                @endforeach
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-gray-800 divide-y divide-gray-700 text-gray-200">
                            <template x-for="costume in filteredCostumes" :key="costume.id">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap" x-text="costume.name"></td>
                                    <td class="px-6 py-4 whitespace-nowrap" x-text="costume.series"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center text-lg font-bold text-indigo-400"
                                        x-text="costume.stock"></td>
                                    <td class="px-6 py-4 whitespace-nowrap">Rp <span
                                            x-text="Number(costume.price_per_day).toLocaleString('id-ID')"></span></td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span
                                            class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full text-white"
                                            :class="{'bg-green-700': costume.is_approved, 'bg-yellow-700': !costume.is_approved}"
                                            x-text="costume.is_approved ? 'LIVE' : 'PENDING ADMIN'">
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                        {{-- ðŸ¤¬ EDIT LINK FIX: Force the path structure and use Alpine for ID injection
                                        --}}
                                        @php
                                            // Generate the base URL structure using a dummy placeholder ID (e.g., /costumes/XX/edit)
                                            // We use 'XX' instead of '0' for cleaner replacement later.
                                            $editUrlBase = route('renter.costumes.edit', ['costume_id' => 'XX']); 
                                        @endphp

                                        <a :href="'{{ $editUrlBase }}'.replace('XX', costume.id)"
                                            class="text-indigo-400 hover:text-indigo-600">Edit</a>

                                        {{-- DELETE (SOFT) FORM FIX: Use the same replacement method --}}
                                        @php
                                            $deleteUrlBase = route('renter.costumes.delete', ['costume_id' => 'XX']);
                                        @endphp
                                        <form :action="'{{ $deleteUrlBase }}'.replace('XX', costume.id)" method="POST"
                                            class="inline"
                                            @submit.prevent="if (confirm('Are you sure you want to soft delete ' + costume.name + '?')) $el.submit()">
                                            @csrf
                                            @method('DELETE')
                                            <button type="submit" class="text-red-400 hover:text-red-600">Delete
                                                (Soft)</button>
                                        </form>
                                    </td>
                                </tr>
                            </template>

                            <tr x-show="filteredCostumes.length === 0">
                                <td colspan="6" class="px-6 py-4 text-center text-gray-400">
                                    No costumes match the current filter.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\renter\store_profile_setup.blade.php ===

@php
    use Illuminate\Support\Facades\Auth;
    $user = $user ?? Auth::user();
    $store = $store ?? $user->store ?? new \App\Models\RenterStore();
@endphp
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Renter: Set Up Cosmic Store Profile ðŸª
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg p-6 space-y-8 border-t-4 border-pink-500">
                @include('profile.partials.renter-store-form', ['user' => $user])
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\renter\upload_costume.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Renter: Upload New Cosmic Costume ðŸš€
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg p-6 border-t-4 border-pink-500">
                <form action="{{ route('renter.costumes.store') }}" method="POST" enctype="multipart/form-data"
                    class="space-y-6">
                    @csrf
                    <div>
                        <x-input-label for="character_name" :value="__('Character Name')" class="text-pink-400" />
                        <x-text-input id="character_name"
                            class="block mt-1 w-full bg-gray-700 border-gray-600 text-white" type="text"
                            name="character_name" required autofocus />
                    </div>

                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <x-input-label for="media_series" :value="__('Media Series (Anime/Game/Book)')"
                                class="text-pink-400" />
                            <x-text-input id="media_series"
                                class="block mt-1 w-full bg-gray-700 border-gray-600 text-white" type="text"
                                name="media_series" required />
                        </div>
                        <div>
                            <x-input-label for="size" :value="__('Size (e.g., M, L, Custom)')" class="text-pink-400" />
                            <x-text-input id="size" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white"
                                type="text" name="size" required />
                        </div>
                    </div>

                    {{-- Price and Condition --}}
                    <div class="grid grid-cols-3 gap-6">
                        <div>
                            <x-input-label for="price" :value="__('Price (Rp)')" class="text-pink-400" />
                            <x-text-input id="price" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white"
                                type="number" name="price" required />
                        </div>
                        <div>
                            <x-input-label for="rental_period" :value="__('Price Per...')" class="text-pink-400" />
                            <select id="rental_period" name="rental_period"
                                class="block mt-1 w-full border-gray-600 bg-gray-700 text-white focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm">
                                <option value="day">Day</option>
                                <option value="week">Week</option>
                                <option value="month">Month</option>
                            </select>
                        </div>
                        <div>
                            <x-input-label for="condition" :value="__('Condition')" class="text-pink-400" />
                            <select id="condition" name="condition"
                                class="block mt-1 w-full border-gray-600 bg-gray-700 text-white focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm">
                                <option value="new">New</option>
                                <option value="excellent">Excellent</option>
                                <option value="good">Good</option>
                                <option value="worn">Worn</option>
                            </select>
                        </div>
                    </div>

                    {{-- Stock, Tags, and Images --}}
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <x-input-label for="stock" :value="__('Stock')" class="text-pink-400" />
                            <x-text-input id="stock" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white"
                                type="number" name="stock" value="1" required />
                        </div>
                        <div>
                            <x-input-label for="tags" :value="__('Tags (Comma Separated: Naruto, Kimono, Armor)')"
                                class="text-pink-400" />
                            <x-text-input id="tags" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white"
                                type="text" name="tags" placeholder="e.g., Fantasy, Armor, Event Promo" required />
                        </div>
                    </div>

                    <div>
                        <x-input-label for="images" :value="__('Costume Images (Multiple allowed)')"
                            class="text-pink-400" />
                        <input id="images"
                            class="block mt-1 w-full text-sm text-gray-200 border-gray-600 rounded-lg cursor-pointer bg-gray-700 focus:outline-none"
                            type="file" name="images[]" multiple required />
                    </div>

                    <p class="text-sm text-yellow-400 mt-2">NOTE: This costume will require Admin Approval before
                        showing in the catalog.</p>

                    <div class="flex items-center justify-end">
                        <x-primary-button class="bg-pink-600 hover:bg-pink-700">
                            {{ __('Submit Costume for Approval') }}
                        </x-primary-button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\renter\view_orders.blade.php ===

@php
    use App\Models\Order;
    use Illuminate\Support\Facades\Auth;

    $renterCostumes = Auth::user()->costumes->pluck('id');

    $orders = Order::whereIn('costume_id', $renterCostumes)
        ->with('user', 'costume')
        ->latest()
        ->get();

    $pendingOrders = $orders->where('status', 'waiting');
    // FIX 1: INCLUDE 'returned' in Ongoing Rentals for final check
    $ongoingRentals = $orders->whereIn('status', ['confirmed', 'borrowed', 'returned']);
    // FIX 2: Only 'completed' and 'rejected' are truly past/archived
    $pastOrders = $orders->whereIn('status', ['completed', 'rejected']);
@endphp

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Renter: Incoming Orders ðŸ“¥
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <h3 class="text-2xl font-bold text-yellow-400 mb-6">Orders Awaiting Your Cosmic Confirmation
                ({{ $pendingOrders->count() }})</h3>

            <div class="space-y-4">
                @forelse ($pendingOrders as $order)
                    {{-- Pending Order Card --}}
                    <div class="bg-gray-800 p-4 rounded-lg border border-yellow-500 shadow-lg">
                        <p class="text-xs text-gray-400">Order ID: {{ $order->order_code }} | Customer:
                            {{ $order->user->name ?? 'N/A' }}
                        </p>
                        <h4 class="text-xl font-bold text-white mt-1">Costume:
                            {{ $order->costume->name ?? 'Costume Deleted' }} (Size {{ $order->costume->size ?? 'N/A' }})
                        </h4>
                        <p class="text-sm text-gray-300">Dates: {{ $order->start_date->format('d M') }} to
                            {{ $order->end_date->format('d M') }} ({{ $order->start_date->diffInDays($order->end_date) }}
                            Days)
                        </p>
                        <p class="text-sm text-yellow-400 font-semibold mt-2">Status: WAITING CONFIRMATION</p>
                        <div class="mt-3 space-x-2">
                            {{-- CONFIRM FORM --}}
                            <form action="{{ route('renter.orders.confirm', $order->id) }}" method="POST" class="inline">
                                @csrf
                                <button type="submit"
                                    class="bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-3 rounded text-sm">Confirm
                                    Order</button>
                            </form>

                            {{-- REJECT FORM --}}
                            <form action="{{ route('renter.orders.reject', $order->id) }}" method="POST" class="inline">
                                @csrf
                                <button type="submit"
                                    class="bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded text-sm">Reject</button>
                            </form>

                            <a href="{{ route('costume.detail', $order->costume_id) }}" target="_blank"
                                class="text-indigo-400 hover:text-indigo-600 text-sm">View Costume</a>
                        </div>
                    </div>
                @empty
                    <p class="text-gray-400">No new orders awaiting confirmation. Quiet night in the cosmos.</p>
                @endforelse
            </div>

            <h3 class="text-2xl font-bold text-indigo-400 mb-6 mt-12">Ongoing Confirmed Rentals
                ({{ $ongoingRentals->count() }})</h3>
            <div class="space-y-4">
                @forelse ($ongoingRentals as $order)
                    @php
                        $color = $order->status === 'confirmed' ? 'border-indigo-500' : 'border-red-500';
                        $statusText = strtoupper($order->status);
                    @endphp
                    <div class="bg-gray-800 p-4 rounded-lg border border-yellow-500 shadow-lg border-l-4 {{ $color }}">
                        <p class="text-xs text-gray-400">Order ID: {{ $order->order_code }} | Customer:
                            {{ $order->user->name ?? 'N/A' }}
                        </p>
                        <h4 class="text-xl font-bold text-white mt-1">Costume:
                            {{ $order->costume->name ?? 'Costume Deleted' }} (Size {{ $order->costume->size ?? 'N/A' }})
                        </h4>
                        <p class="text-sm text-gray-300">Dates: {{ $order->start_date->format('d M') }} to
                            {{ $order->end_date->format('d M') }} ({{ $order->start_date->diffInDays($order->end_date) }}
                            Days)
                        </p>
                        <p class="text-2xl font-extrabold text-indigo-400 mt-3">STATUS: {{ $statusText }}</p>
                        <div class="mt-3 space-x-2">

                            {{-- ðŸ’¥ NEW: MARK AS COMPLETED BUTTON (Only appears after RETURNED) --}}
                            @if ($order->status === 'returned')
                                <form action="{{ route('renter.orders.update.status', $order->id) }}" method="POST"
                                    class="inline">
                                    @csrf
                                    <input type="hidden" name="new_status" value="completed">
                                    <button type="submit"
                                        class="bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-3 rounded text-sm">
                                        Confirm Check & Finalize
                                    </button>
                                </form>
                            @endif

                            {{-- MARK AS RETURNED FORM (Only show if borrowed/confirmed) --}}
                            @if ($order->status === 'borrowed' || $order->status === 'confirmed')
                                <form action="{{ route('renter.orders.update.status', $order->id) }}" method="POST"
                                    class="inline">
                                    @csrf
                                    <input type="hidden" name="new_status" value="returned">
                                    <button type="submit"
                                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded text-sm">Mark
                                        as Returned</button>
                                </form>
                            @endif

                            {{-- MARK AS BORROWED FORM (Only show if status is confirmed) --}}
                            @if ($order->status === 'confirmed')
                                <form action="{{ route('renter.orders.update.status', $order->id) }}" method="POST"
                                    class="inline">
                                    @csrf
                                    <input type="hidden" name="new_status" value="borrowed">
                                    <button type="submit"
                                        class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-1 px-3 rounded text-sm">Mark
                                        as Borrowed</button>
                                </form>
                            @endif

                            <a href="{{ route('order.detail', $order->id) }}" target="_blank"
                                class="text-indigo-400 hover:text-indigo-600 text-sm">View Details</a>
                        </div>
                    </div>
                @empty
                    <p class="text-gray-400">No confirmed orders are currently out for rental.</p>
                @endforelse
            </div>

            <h3 class="text-2xl font-bold text-green-400 mb-6 mt-12">Rental History (Completed/Rejected)</h3>
            <div class="space-y-4">
                @forelse ($pastOrders as $order)
                    @php
                        $color = ($order->status === 'completed') ? 'border-green-500' : 'border-red-800';
                        $statusText = strtoupper($order->status);
                    @endphp
                    <div class="bg-gray-800 p-4 rounded-lg shadow-lg border-l-4 {{ $color }}">
                        <p class="text-xs text-gray-400">Order ID: {{ $order->order_code }} | Customer:
                            {{ $order->user->name ?? 'N/A' }}
                        </p>
                        <h4 class="text-xl font-bold text-white mt-1">Costume:
                            {{ $order->costume->name ?? 'Costume Deleted' }} (Size {{ $order->costume->size ?? 'N/A' }})
                        </h4>
                        <p class="text-sm text-gray-300">Dates: {{ $order->start_date->format('d M') }} to
                            {{ $order->end_date->format('d M') }}
                        </p>
                        <p class="text-xl font-extrabold mt-3"
                            style="color: {{ $color === 'border-green-500' ? '#10B981' : '#F87171' }};">
                            STATUS: {{ $statusText }}
                        </p>
                        <div class="mt-3 space-x-2">
                            <a href="{{ route('order.detail', $order->id) }}"
                                class="text-indigo-400 hover:text-indigo-600 text-sm">View Details</a>
                        </div>
                    </div>
                @empty
                    <p class="text-gray-400">No completed or rejected orders in history.</p>
                @endforelse
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\store\public_store.blade.php ===

@php
    use App\Models\User;
    use App\Models\Costume;
    use Illuminate\Support\Facades\Route;

    $renterId = Route::current()->parameter('user_id') ?? 1; 
    $renterUser = User::with('store')->find($renterId);
    $store = $renterUser->store ?? null;
    $costumes = $renterUser ? $renterUser->costumes()->where('is_approved', true)->get() : collect();

    $storeName = $store->store_name ?? 'Starium Shop';
    $storeDesc = $store->description ?? 'No description provided.';
@endphp

<x-app-layout>
    <x-slot name="header">
        <div class="flex items-center justify-between">
            <h2 class="font-semibold text-xl text-gray-200 leading-tight">
                {{ $storeName }}'s Cosmic Storefront âœ¨
            </h2>
            {{-- BACK BUTTON --}}
            <a href="javascript:history.back()"
                class="text-sm text-indigo-400 hover:text-white transition duration-300">
                &larr; Back to Catalog
            </a>
        </div>
    </x-slot>
    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">

            {{-- 1. PUBLIC STORE PROFILE HEADER --}}
            <div class="bg-gray-800 p-8 rounded-lg shadow-xl mb-10 border-l-4 border-pink-500">
                <div class="flex items-center space-x-6">
                    @php
                        $logoPath = $store->store_logo_path ?? null;
                        $logoUrl = $logoPath
                            ? asset('storage/' . $logoPath)
                            : asset('default_images/default_avatar.png'); 

                        $fallbackInitial = strtoupper(substr($storeName, 0, 1));
                    @endphp

                    <img src="{{ $logoUrl }}" alt="{{ $storeName }} Logo"
                        class="w-20 h-20 rounded-full object-cover border-4 border-pink-500"
                        onerror="this.onerror=null; this.src='{{ asset('default_images/default_avatar.png') }}';">

                    {{-- END FIXED LOGO/AVATAR DISPLAY --}}
                    <div>
                        <h1 class="text-3xl font-extrabold text-pink-400">{{ $storeName }}</h1>
                        <p class="text-gray-300 mt-1">{{ $storeDesc }}</p>
                        <p class="text-sm text-gray-500 mt-2">
                            ðŸ“ Base Address: {{ $renterUser->address ?? 'N/A' }}
                        </p>
                    </div>
                </div>
            </div>



            {{-- 2. STORE COSTUMES LIST --}}
            <h3 class="text-2xl font-bold text-indigo-400 mb-6">Available Costumes ({{ $costumes->count() }})</h3>

            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
                @forelse ($costumes as $costume)
                    {{-- DYNAMIC COSTUME CARD --}}
                    <div
                        class="bg-gray-800 border border-indigo-700 shadow-xl rounded-lg overflow-hidden transition transform hover:scale-[1.02] duration-300">

                        @php
                            $costumeImageUrl = $costume->main_image_path
                                ? asset('storage/' . $costume->main_image_path)
                                : asset('default_images/default_costume.png');
                        @endphp

                        <div class="h-48 overflow-hidden">
                            <img src="{{ $costumeImageUrl }}" alt="{{ $costume->name }} costume"
                                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                                onerror="this.onerror=null; this.src='{{ asset('default_images/default_costume.png') }}';">
                        </div>

                        <div class="p-4">
                            <h3 class="text-xl font-bold text-white truncate">{{ $costume->name }}</h3>
                            <p class="text-gray-400 text-sm">Series: {{ $costume->series }}</p>
                            <p class="text-lg font-semibold text-indigo-400 mt-2">Rp
                                {{ number_format($costume->price_per_day, 0, ',', '.') }} / Day
                            </p>

                            <a href="{{ route('costume.detail', ['id' => $costume->id]) }}"
                                class="mt-3 block text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 rounded">
                                View & Rent
                            </a>
                        </div>
                    </div>
                @empty
                    <p class="col-span-4 text-center text-gray-400 text-lg py-10">This renter has no active costumes yet.
                    </p>
                @endforelse
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\user\costume_detail.blade.php ===

@php
    use App\Models\Costume;
    use Illuminate\Support\Facades\Route;

    $DISCOUNT_RATE = 0.15;

    $costumeId = Route::current()->parameter('id');

    $costume = Costume::with('renter.store')->find($costumeId);

    $costume->is_on_sale = true;
    $costume->original_price = $costume->price_per_day;
    $costume->discounted_price = $costume->original_price * (1 - $DISCOUNT_RATE);

    if (!$costume) {
        $costume = (object) [
            'name' => 'Costume Not Found',
            'series' => 'N/A',
            'size' => 'N/A',
            'condition' => 'N/A',
            'price_per_day' => 0,
            'stock' => 0,
            'tags' => ['Error'],
            'is_on_sale' => false,
            'discounted_price' => 0,
            'original_price' => 0,
        ];
    }

    $tags = $costume->tags ?? ['Error'];
    $costumeName = $costume->name;
    $renterStoreName = $costume->renter->store->store_name ?? 'Unknown Store';
@endphp

<x-app-layout>
    <x-slot name="header">
        <div class="flex items-center justify-between">
            <h2 class="font-semibold text-xl text-gray-200 leading-tight">
                Costume Detail: {{ $costumeName }} ðŸŒ™
            </h2>
        </div>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div
                class="grid grid-cols-1 lg:grid-cols-3 gap-8 bg-gray-800 border border-indigo-700 p-6 rounded-lg shadow-xl">
                {{-- Image Gallery (Dummy) --}}
                <div class="lg:col-span-2">
                    @php
                        $costumeImagePath = $costume->main_image_path
                            ? asset('storage/' . $costume->main_image_path)
                            : asset('default_images/default_costume.png');
                    @endphp

                    <div
                        class="bg-gray-700 rounded-lg flex items-center justify-center text-gray-400 text-2xl font-bold overflow-hidden">

                        <img src="{{ $costumeImagePath }}" alt="{{ $costumeName }} Costume" class="h-full object-cover"
                            onerror="this.onerror=null; this.src='{{ asset('default_images/default_costume.png') }}';">

                    </div>
                </div>

                {{-- Details and Order Box --}}
                <div class="lg:col-span-1 text-gray-200">
                    <h2 class="text-4xl font-bold text-green-400 mt-4 flex flex-col">
                        @if ($costume->is_on_sale)
                            <span class="text-lg font-semibold text-gray-500 line-through">
                                Rp {{ number_format($costume->original_price, 0, ',', '.') }} / Day
                            </span>
                        @endif
                        <span class="text-4xl font-extrabold text-indigo-400">
                            Rp {{ number_format($costume->discounted_price, 0, ',', '.') }} <span
                                class="text-xl text-gray-400">/ Day</span>
                        </span>
                    </h2>

                    <div class="mt-6 p-4 bg-gray-700 rounded-lg border-l-4 border-pink-500 relative">
                        @if ($costume->is_on_sale)
                            <span
                                class="absolute top-0 right-0 bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-bl-lg z-10">
                                FLASH SALE!
                            </span>
                        @endif

                        <p class="text-sm">Renter: <a
                                href="{{ route('public.store', ['user_id' => $costume->user_id ?? 0]) }}"
                                class="text-pink-400 hover:underline">{{ $renterStoreName }}</a>
                        </p>
                        <p class="text-sm text-red-400 font-bold">Stock: {{ $costume->stock }} | Availability:
                            {{ $costume->stock > 0 ? 'Available Now!' : 'Out of Stock!' }}
                        </p>
                    </div>

                    <div class="mt-6 space-y-3">
                        @if ($costume->stock > 0)
                            <p class="text-sm text-green-400 font-bold">
                                Stock Available: {{ $costume->stock }} units!
                            </p>
                            <a href="{{ route('order.place', ['costume_id' => $costume->id]) }}"
                                class="w-full block text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg text-lg transition duration-300">
                                Rent Now!
                            </a>
                        @else
                            <p class="text-lg text-red-500 font-extrabold text-center border border-red-500 p-3 rounded-lg">
                                ALL STOCK RENTED OUT!
                            </p>
                        @endif
                    </div>


                    <div class="mt-6">
                        <p class="text-sm font-semibold border-b border-gray-600 pb-1 mb-2">Tags:</p>
                        @foreach ($tags as $tag)
                            <span
                                class="inline-block bg-indigo-800 text-indigo-100 px-3 py-1 text-xs font-semibold rounded-full mr-2 mb-2">{{ $tag }}</span>
                        @endforeach
                    </div>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\user\place_order.blade.php ===

@php
    use App\Models\Costume;

    $costume = $costume ?? Costume::find(request()->route('costume_id'));

    $price = $costume->price_per_day ?? 60000;
    $costumeName = $costume->name ?? 'Costume Not Found';
    $costumeId = $costume->id ?? 0;
@endphp

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            Place Order: Confirm Rental ðŸ›’
        </h2>
    </x-slot>

    {{-- Alpine.js for live price calculation --}}
    <div class="py-12" style="background-color: #0d0d1f;" x-data="{
            startDate: '',
            endDate: '',
            pricePerDay: {{ $price }},
            duration: 0,
            totalPrice: 0,

            calculatePrice() {
                if (this.startDate && this.endDate) {
                    const start = new Date(this.startDate);
                    const end = new Date(this.endDate);
                    const diffTime = Math.abs(end - start);
                    // +1 because the rental includes the start day
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;

                    if (diffDays > 0) {
                        this.duration = diffDays;
                        this.totalPrice = this.pricePerDay * diffDays;
                    } else {
                        this.duration = 0;
                        this.totalPrice = 0;
                    }
                } else {
                    this.duration = 0;
                    this.totalPrice = 0;
                }
            },

            formatRupiah(number) {
                return 'Rp ' + number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            }
        }">
        <div class="max-w-4xl mx-auto sm:px-6 lg:px-8">
        @if ($errors->has('stock_error'))
            <div class="bg-red-800 p-4 rounded-lg mb-6 border border-red-500 text-white font-bold">
                <p>ðŸš¨ Renting Failed!</p>
                <p class="text-sm mt-1">{{ $errors->first('stock_error') }}</p>
            </div>
        @endif
        <div class="max-w-4xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg p-6 border-t-4 border-indigo-500">
                <h3 class="text-3xl font-bold text-white mb-4">
                    Renting: {{ $costumeName }}
                </h3>

                <p class="text-lg text-gray-300 mb-6">
                    Price: Rp {{ number_format($price, 0, ',', '.') }} / Day
                </p>

                {{-- Booking form --}}
                <form action="{{ route('order.store') }}" method="POST" class="space-y-6">
                    @csrf

                    {{-- Costume ID --}}
                    <input type="hidden" name="costume_id" value="{{ $costumeId }}">

                    {{-- Start Date --}}
                    <div>
                        <x-input-label for="start_date" :value="__('Rental Start Date')" class="text-indigo-400" />
                        <x-text-input id="start_date" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white"
                            type="date" name="start_date" required x-model="startDate" x-on:change="calculatePrice" />
                    </div>

                    {{-- End Date --}}
                    <div>
                        <x-input-label for="end_date" :value="__('Rental End Date')" class="text-indigo-400" />
                        <x-text-input id="end_date" class="block mt-1 w-full bg-gray-700 border-gray-600 text-white"
                            type="date" name="end_date" required x-model="endDate" x-on:change="calculatePrice" />
                    </div>

                    {{-- Live Summary --}}
                    <div class="p-4 bg-gray-700 rounded-lg text-gray-200 border-l-4 border-green-500">
                        <h4 class="font-bold text-xl mb-2 text-green-400">
                            Order Summary (Live Calculation)
                        </h4>

                        <div class="flex justify-between">
                            <p>Duration:</p>
                            <p class="font-bold" x-text="duration > 0 ? duration + ' Days' : 'Select Dates'"></p>
                        </div>

                        <div class="flex justify-between">
                            <p>
                                Rental Cost (<span x-text="duration">0</span> days @
                                Rp {{ number_format($price, 0, ',', '.') }}/day):
                            </p>
                            <p x-text="formatRupiah(totalPrice)"></p>
                        </div>

                        <div class="flex justify-between font-bold text-2xl mt-3 text-green-400">
                            <p>Grand Total:</p>
                            <p x-text="formatRupiah(totalPrice)"></p>
                        </div>
                    </div>

                    <div class="flex items-center justify-end mt-4">
                        <x-primary-button class="bg-indigo-600 hover:bg-indigo-700" x-bind:disabled="duration <= 0">
                            {{ __('Place Booking & Await Confirmation') }}
                        </x-primary-button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: resources/views\user\track_orders.blade.php ===

<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-200 leading-tight">
            User: Track My Cosmic Orders ðŸ—ºï¸
        </h2>
    </x-slot>

    <div class="py-12" style="background-color: #0d0d1f;">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8" x-data="{
            filterStatus: 'active', // Default to active orders
            orders: {{ json_encode($orders) }},

            get filteredOrders() {
                return this.orders.filter(order => {
                    const activeStatuses = ['waiting', 'confirmed', 'borrowed'];
                    const pastStatuses = ['returned', 'completed', 'rejected'];

                    if (this.filterStatus === 'active') {
                        return activeStatuses.includes(order.status);
                    } else if (this.filterStatus === 'past') {
                        return pastStatuses.includes(order.status);
                    } else {
                        return order.status === this.filterStatus;
                    }
                });
            }
        }">

            {{-- FILTER BUTTONS --}}
            <div class="mb-6 flex space-x-4">
                <button @click="filterStatus = 'active'"
                    :class="{'bg-indigo-600 border-indigo-400': filterStatus === 'active', 'bg-gray-700 border-gray-600': filterStatus !== 'active'}"
                    class="p-3 text-white font-bold rounded-lg border">
                    Active Rentals (<span
                        x-text="orders.filter(o => ['waiting', 'confirmed', 'borrowed'].includes(o.status)).length"></span>)
                </button>
                <button @click="filterStatus = 'waiting'"
                    :class="{'bg-yellow-600 border-yellow-400': filterStatus === 'waiting', 'bg-gray-700 border-gray-600': filterStatus !== 'waiting'}"
                    class="p-3 text-white font-bold rounded-lg border">
                    Needs Confirmation (<span x-text="orders.filter(o => o.status === 'waiting').length"></span>)
                </button>
                <button @click="filterStatus = 'past'"
                    :class="{'bg-green-600 border-green-400': filterStatus === 'past', 'bg-gray-700 border-gray-600': filterStatus !== 'past'}"
                    class="p-3 text-white font-bold rounded-lg border">
                    Past History (<span
                        x-text="orders.filter(o => ['returned', 'completed', 'rejected'].includes(o.status)).length"></span>)
                </button>
            </div>

            <h3 class="text-2xl font-bold text-white mb-6">Showing: <span x-text="filterStatus.toUpperCase()"></span>
                Orders (<span x-text="filteredOrders.length"></span>)</h3>

            <div class="space-y-6">
                <template x-for="order in filteredOrders" :key="order.order_code">
                    <div class="bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg p-6 border-l-4" :class="{
                            'border-yellow-500': order.status === 'waiting',
                            'border-indigo-500': order.status === 'confirmed',
                            'border-red-500': order.status === 'borrowed',
                            'border-green-500': order.status === 'completed',
                            'border-gray-500': order.status === 'rejected' || order.status === 'returned',
                         }">

                        <h3 class="text-xl font-bold text-white"
                            x-text="`Order #${order.order_code}: ${order.costume?.name || 'Costume Deleted'}`"></h3>

                        <p class="text-sm text-gray-400 mt-1">
                            Rented from: <span x-text="order.costume?.renter?.name || 'N/A'"></span> |
                            Dates: <span
                                x-text="new Date(order.start_date).toLocaleDateString('en-US', {day:'numeric', month:'short'})"></span>
                            -
                            <span
                                x-text="new Date(order.end_date).toLocaleDateString('en-US', {day:'numeric', month:'short'})"></span>
                        </p>

                        <p class="text-2xl font-extrabold mt-3" :class="{
                                'text-yellow-400': order.status === 'waiting',
                                'text-indigo-400': order.status === 'confirmed' || order.status === 'borrowed',
                                'text-green-400': order.status === 'completed',
                                'text-red-400': order.status === 'rejected' || order.status === 'returned',
                           }" x-text="`STATUS: ${order.status.toUpperCase()}`">
                        </p>

                        <p class="text-sm text-gray-300 mt-2">
                            Total Paid: Rp <span x-text="Number(order.total_price).toLocaleString('id-ID')"></span>
                        </p>

                        <a x-show="order.status === 'completed'" href="#"
                            class="text-indigo-400 hover:text-indigo-600 text-sm mt-2 block">Leave a Review</a>
                    </div>
                </template>

                <p x-show="filteredOrders.length === 0" class="text-gray-400">
                    No orders match the current status filter.
                </p>
            </div>
        </div>
    </div>
</x-app-layout>

=== FILE: routes\auth.php ===

<?php

use App\Http\Controllers\Auth\AuthenticatedSessionController;
use App\Http\Controllers\Auth\ConfirmablePasswordController;
use App\Http\Controllers\Auth\EmailVerificationNotificationController;
use App\Http\Controllers\Auth\EmailVerificationPromptController;
use App\Http\Controllers\Auth\NewPasswordController;
use App\Http\Controllers\Auth\PasswordController;
use App\Http\Controllers\Auth\PasswordResetLinkController;
use App\Http\Controllers\Auth\RegisteredUserController;
use App\Http\Controllers\Auth\VerifyEmailController;
use Illuminate\Support\Facades\Route;

Route::middleware('guest')->group(function () {
    Route::get('register', [RegisteredUserController::class, 'create'])
        ->name('register');

    Route::post('register', [RegisteredUserController::class, 'store']);

    Route::get('login', [AuthenticatedSessionController::class, 'create'])
        ->name('login');

    Route::post('login', [AuthenticatedSessionController::class, 'store']);

    Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])
        ->name('password.request');

    Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])
        ->name('password.email');

    Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])
        ->name('password.reset');

    Route::post('reset-password', [NewPasswordController::class, 'store'])
        ->name('password.store');
});

Route::middleware('auth')->group(function () {
    Route::get('verify-email', EmailVerificationPromptController::class)
        ->name('verification.notice');

    Route::get('verify-email/{id}/{hash}', VerifyEmailController::class)
        ->middleware(['signed', 'throttle:6,1'])
        ->name('verification.verify');

    Route::post('email/verification-notification', [EmailVerificationNotificationController::class, 'store'])
        ->middleware('throttle:6,1')
        ->name('verification.send');

    Route::get('confirm-password', [ConfirmablePasswordController::class, 'show'])
        ->name('password.confirm');

    Route::post('confirm-password', [ConfirmablePasswordController::class, 'store']);

    Route::put('password', [PasswordController::class, 'update'])->name('password.update');

    Route::post('logout', [AuthenticatedSessionController::class, 'destroy'])
        ->name('logout');
});


=== FILE: routes\console.php ===

<?php

use Illuminate\Foundation\Inspiring;
use Illuminate\Support\Facades\Artisan;

Artisan::command('inspire', function () {
    $this->comment(Inspiring::quote());
})->purpose('Display an inspiring quote');


=== FILE: routes\web.php ===

<?php

// routes/web.php 

use App\Http\Controllers\ProfileController;
use Illuminate\Support\Facades\Route;
use Illuminate\Support\Facades\Auth;
use App\Http\Controllers\OrderController;
use App\Http\Controllers\CostumeController;
use App\Http\Controllers\UserOrderController;
use App\Http\Controllers\RenterStoreController;
use App\Http\Controllers\CatalogController;
use App\Http\Controllers\AdminController;
use Spatie\Permission\Models\Role;

Route::get('/', [CatalogController::class, 'index'])->name('catalog');
Route::view('/store/{user_id}', 'store.public_store')->name('public.store');
Route::get('captcha/{config?}', [Mews\Captcha\CaptchaController::class, 'getCaptcha'])->name('captcha.custom');

Route::middleware('auth')->group(function () {
    // --- STANDARD BREEZE PROFILE ROUTES ---
    Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');
    Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');
    Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');

    Route::patch('/renter/store', [ProfileController::class, 'updateRenterStore'])->name('renter.store.update');

    // Update the main dashboard redirection logic to prioritize the new Owner role.
    Route::get('/dashboard', function () {
        // Owner check added from previous instruction
        if (Auth::user()->hasRole('owner')) {
            return redirect()->route('admin.dashboard');
        }
        if (Auth::user()->hasRole('admin')) {
            return redirect()->route('admin.dashboard');
        }
        if (Auth::user()->hasRole('renter')) {
            return redirect()->route('renter.dashboard');
        }
        return redirect()->route('catalog');
    })->name('dashboard');


    // --- OWNER-ONLY PERMISSION ROUTES (Layered protection) ---
    Route::middleware(['role:owner'])->group(function () {
        Route::get('/owner/users/{user_id}/permissions', [AdminController::class, 'editUserPermissions'])->name('owner.users.permissions.edit');
        Route::post('/owner/users/{user_id}/permissions/sync', [AdminController::class, 'syncUserPermissions'])->name('owner.users.permissions.sync');
    });

    // --- ADMIN ROUTES (Protected by admin|owner role, permissions checked by middleware in the group) ---
    Route::middleware(['role:admin|owner'])->prefix('admin')->name('admin.')->group(function () {

        // ANALYTICS & DASHBOARD (Protected by specific permissions)
        Route::get('/home', [AdminController::class, 'dashboard'])->middleware('permission:platform:view-global-kpis')->name('dashboard');
        Route::get('/renters/{user_id}/analytics', [AdminController::class, 'viewRenterAnalytics'])->middleware('permission:analytics:view-renter')->name('renters.analytics');

        // MANAGEMENT 
        Route::get('/users', [AdminController::class, 'manageUsers'])->name('users');
        Route::get('/costumes/all', [AdminController::class, 'manageCostumes'])->name('costumes.manage');
        Route::get('/costumes/approval', [AdminController::class, 'approvalQueue'])->middleware('permission:costume:approve-reject')->name('costumes.approval');
        Route::post('/costumes/{costume_id}/set-approval', [AdminController::class, 'setCostumeApproval'])->middleware('permission:costume:approve-reject')->name('costumes.set_approval');

        // DISCOUNT/BANNER MANAGEMENT
        Route::get('/discounts', [AdminController::class, 'manageDiscounts'])->middleware('permission:discount:manage-global')->name('discounts.manage');
        Route::post('/discounts/global', [AdminController::class, 'setGlobalDiscount'])->middleware('permission:discount:manage-global')->name('discounts.global.set');
        Route::get('/transactions', [AdminController::class, 'monitorTransactions'])->name('transactions');
        Route::get('/banners', [AdminController::class, 'manageBanners'])->middleware('permission:platform:manage-banners')->name('banners.manage');
        Route::post('/banners/{id}', [AdminController::class, 'updateBanner'])->middleware('permission:platform:manage-banners')->name('banners.update');

        Route::get('/stores', [AdminController::class, 'manageRenterStores'])->name('stores.manage');
        Route::get('/stores/{user_id}/view', [AdminController::class, 'viewRenterStoreDetails'])->name('stores.view');

        // USER EDIT & ROLE UPDATE (Permissions handled in Controller/Middleware)
        Route::get('/users/{user_id}/edit', [AdminController::class, 'editUser'])->middleware('permission:user:edit-renter-user|user:manage-roles')->name('users.edit');
        Route::patch('/users/{user_id}/update', [AdminController::class, 'updateUser'])->middleware('permission:user:edit-renter-user|user:manage-roles')->name('users.update');
        Route::post('/users/{user_id}/update-role', [AdminController::class, 'updateRole'])->middleware('permission:user:edit-renter-user|user:manage-roles')->name('users.updateRole');

        // NEW: Route for Admin to update another user's RenterStore
        Route::patch('/stores/{user_id}/update-store', [AdminController::class, 'updateRenterStoreDetails'])->name('stores.update_details');
    });

    // --- RENTER ROUTES (Protected by renter|admin|owner role) ---
    Route::middleware(['role:renter|admin|owner'])->prefix('renter')->name('renter.')->group(function () {
        Route::view('/home', 'renter.dashboard')->name('dashboard');

        // **!!! THE MISSING ROUTE NAME IS FIXED HERE !!!**
        Route::get('/profile/setup', [ProfileController::class, 'editRenterStore'])->name('profile.setup');

        Route::get('/costumes/manage', [CostumeController::class, 'index'])->name('costumes.manage');

        // Costume CRUD
        Route::get('/costumes/upload', fn() => view('renter.upload_costume'))->middleware('permission:costume:create')->name('costumes.upload');
        Route::post('/costumes/store', [CostumeController::class, 'store'])->middleware('permission:costume:create')->name('costumes.store');
        Route::get('/costumes/{costume_id}/edit', [CostumeController::class, 'edit'])->middleware('permission:costume:edit-own|costume:edit-all')->name('costumes.edit');
        Route::patch('/costumes/{costume_id}/update', [CostumeController::class, 'update'])->middleware('permission:costume:edit-own|costume:edit-all')->name('costumes.update');
        Route::delete('/costumes/{costume_id}/delete', [CostumeController::class, 'destroy'])->middleware('permission:costume:delete-own|costume:delete-all')->name('costumes.delete');

        Route::view('/orders', 'renter.view_orders')->name('orders');

        Route::prefix('orders')->name('orders.')->group(function () {
            Route::post('/{order_id}/confirm', [OrderController::class, 'confirm'])->middleware('permission:order:confirm-reject')->name('confirm');
            Route::post('/{order_id}/reject', [OrderController::class, 'reject'])->middleware('permission:order:confirm-reject')->name('reject');
            Route::post('/{order_id}/update-status', [OrderController::class, 'updateStatus'])->middleware('permission:order:update-status')->name('update.status');
        });
    });

    // --- USER ROUTES (Accessible by any logged-in user, including Renter/Admin/Owner) ---
    Route::view('/costume/detail/{id}', 'user.costume_detail')->name('costume.detail');
    Route::get('/order/place/{costume_id}', [OrderController::class, 'createOrder'])->name('order.place');
    Route::post('/order/store', [OrderController::class, 'storeOrder'])->name('order.store');
    Route::get('/my-orders', [UserOrderController::class, 'index'])->name('user.orders');
    Route::get('/order/view/{order_id}', [OrderController::class, 'viewDetail'])->name('order.detail');
});

require __DIR__ . '/auth.php';

=== FILE: database\factories\UserFactory.php ===

<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Str;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\User>
 */
class UserFactory extends Factory
{
    /**
     * The current password being used by the factory.
     */
    protected static ?string $password;

    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'name' => fake()->name(),
            'email' => fake()->unique()->safeEmail(),
            'email_verified_at' => now(),
            'password' => static::$password ??= Hash::make('password'),
            'remember_token' => Str::random(10),
        ];
    }

    /**
     * Indicate that the model's email address should be unverified.
     */
    public function unverified(): static
    {
        return $this->state(fn (array $attributes) => [
            'email_verified_at' => null,
        ]);
    }
}


=== FILE: database\migrations\0001_01_01_000000_create_users_table.php ===

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('email')->unique();
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password');
            $table->rememberToken();
            $table->timestamps();
        });

        Schema::create('password_reset_tokens', function (Blueprint $table) {
            $table->string('email')->primary();
            $table->string('token');
            $table->timestamp('created_at')->nullable();
        });

        Schema::create('sessions', function (Blueprint $table) {
            $table->string('id')->primary();
            $table->foreignId('user_id')->nullable()->index();
            $table->string('ip_address', 45)->nullable();
            $table->text('user_agent')->nullable();
            $table->longText('payload');
            $table->integer('last_activity')->index();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('users');
        Schema::dropIfExists('password_reset_tokens');
        Schema::dropIfExists('sessions');
    }
};


=== FILE: database\migrations\0001_01_01_000001_create_cache_table.php ===

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('cache', function (Blueprint $table) {
            $table->string('key')->primary();
            $table->mediumText('value');
            $table->integer('expiration');
        });

        Schema::create('cache_locks', function (Blueprint $table) {
            $table->string('key')->primary();
            $table->string('owner');
            $table->integer('expiration');
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('cache');
        Schema::dropIfExists('cache_locks');
    }
};


=== FILE: database\migrations\0001_01_01_000002_create_jobs_table.php ===

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('jobs', function (Blueprint $table) {
            $table->id();
            $table->string('queue')->index();
            $table->longText('payload');
            $table->unsignedTinyInteger('attempts');
            $table->unsignedInteger('reserved_at')->nullable();
            $table->unsignedInteger('available_at');
            $table->unsignedInteger('created_at');
        });

        Schema::create('job_batches', function (Blueprint $table) {
            $table->string('id')->primary();
            $table->string('name');
            $table->integer('total_jobs');
            $table->integer('pending_jobs');
            $table->integer('failed_jobs');
            $table->longText('failed_job_ids');
            $table->mediumText('options')->nullable();
            $table->integer('cancelled_at')->nullable();
            $table->integer('created_at');
            $table->integer('finished_at')->nullable();
        });

        Schema::create('failed_jobs', function (Blueprint $table) {
            $table->id();
            $table->string('uuid')->unique();
            $table->text('connection');
            $table->text('queue');
            $table->longText('payload');
            $table->longText('exception');
            $table->timestamp('failed_at')->useCurrent();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('jobs');
        Schema::dropIfExists('job_batches');
        Schema::dropIfExists('failed_jobs');
    }
};


=== FILE: database\migrations\2025_10_05_164609_create_permission_tables.php ===

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        $teams = config('permission.teams');
        $tableNames = config('permission.table_names');
        $columnNames = config('permission.column_names');
        $pivotRole = $columnNames['role_pivot_key'] ?? 'role_id';
        $pivotPermission = $columnNames['permission_pivot_key'] ?? 'permission_id';

        throw_if(empty($tableNames), new Exception('Error: config/permission.php not loaded. Run [php artisan config:clear] and try again.'));
        throw_if($teams && empty($columnNames['team_foreign_key'] ?? null), new Exception('Error: team_foreign_key on config/permission.php not loaded. Run [php artisan config:clear] and try again.'));

        Schema::create($tableNames['permissions'], static function (Blueprint $table) {
            // $table->engine('InnoDB');
            $table->bigIncrements('id'); // permission id
            $table->string('name');       // For MyISAM use string('name', 225); // (or 166 for InnoDB with Redundant/Compact row format)
            $table->string('guard_name'); // For MyISAM use string('guard_name', 25);
            $table->timestamps();

            $table->unique(['name', 'guard_name']);
        });

        Schema::create($tableNames['roles'], static function (Blueprint $table) use ($teams, $columnNames) {
            // $table->engine('InnoDB');
            $table->bigIncrements('id'); // role id
            if ($teams || config('permission.testing')) { // permission.testing is a fix for sqlite testing
                $table->unsignedBigInteger($columnNames['team_foreign_key'])->nullable();
                $table->index($columnNames['team_foreign_key'], 'roles_team_foreign_key_index');
            }
            $table->string('name');       // For MyISAM use string('name', 225); // (or 166 for InnoDB with Redundant/Compact row format)
            $table->string('guard_name'); // For MyISAM use string('guard_name', 25);
            $table->timestamps();
            if ($teams || config('permission.testing')) {
                $table->unique([$columnNames['team_foreign_key'], 'name', 'guard_name']);
            } else {
                $table->unique(['name', 'guard_name']);
            }
        });

        Schema::create($tableNames['model_has_permissions'], static function (Blueprint $table) use ($tableNames, $columnNames, $pivotPermission, $teams) {
            $table->unsignedBigInteger($pivotPermission);

            $table->string('model_type');
            $table->unsignedBigInteger($columnNames['model_morph_key']);
            $table->index([$columnNames['model_morph_key'], 'model_type'], 'model_has_permissions_model_id_model_type_index');

            $table->foreign($pivotPermission)
                ->references('id') // permission id
                ->on($tableNames['permissions'])
                ->onDelete('cascade');
            if ($teams) {
                $table->unsignedBigInteger($columnNames['team_foreign_key']);
                $table->index($columnNames['team_foreign_key'], 'model_has_permissions_team_foreign_key_index');

                $table->primary([$columnNames['team_foreign_key'], $pivotPermission, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_permissions_permission_model_type_primary');
            } else {
                $table->primary([$pivotPermission, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_permissions_permission_model_type_primary');
            }

        });

        Schema::create($tableNames['model_has_roles'], static function (Blueprint $table) use ($tableNames, $columnNames, $pivotRole, $teams) {
            $table->unsignedBigInteger($pivotRole);

            $table->string('model_type');
            $table->unsignedBigInteger($columnNames['model_morph_key']);
            $table->index([$columnNames['model_morph_key'], 'model_type'], 'model_has_roles_model_id_model_type_index');

            $table->foreign($pivotRole)
                ->references('id') // role id
                ->on($tableNames['roles'])
                ->onDelete('cascade');
            if ($teams) {
                $table->unsignedBigInteger($columnNames['team_foreign_key']);
                $table->index($columnNames['team_foreign_key'], 'model_has_roles_team_foreign_key_index');

                $table->primary([$columnNames['team_foreign_key'], $pivotRole, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_roles_role_model_type_primary');
            } else {
                $table->primary([$pivotRole, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_roles_role_model_type_primary');
            }
        });

        Schema::create($tableNames['role_has_permissions'], static function (Blueprint $table) use ($tableNames, $pivotRole, $pivotPermission) {
            $table->unsignedBigInteger($pivotPermission);
            $table->unsignedBigInteger($pivotRole);

            $table->foreign($pivotPermission)
                ->references('id') // permission id
                ->on($tableNames['permissions'])
                ->onDelete('cascade');

            $table->foreign($pivotRole)
                ->references('id') // role id
                ->on($tableNames['roles'])
                ->onDelete('cascade');

            $table->primary([$pivotPermission, $pivotRole], 'role_has_permissions_permission_id_role_id_primary');
        });

        app('cache')
            ->store(config('permission.cache.store') != 'default' ? config('permission.cache.store') : null)
            ->forget(config('permission.cache.key'));
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        $tableNames = config('permission.table_names');

        if (empty($tableNames)) {
            throw new \Exception('Error: config/permission.php not found and defaults could not be merged. Please publish the package configuration before proceeding, or drop the tables manually.');
        }

        Schema::drop($tableNames['role_has_permissions']);
        Schema::drop($tableNames['model_has_roles']);
        Schema::drop($tableNames['model_has_permissions']);
        Schema::drop($tableNames['roles']);
        Schema::drop($tableNames['permissions']);
    }
};


=== FILE: database\migrations\2025_10_05_165010_create_personal_access_tokens_table.php ===

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('personal_access_tokens', function (Blueprint $table) {
            $table->id();
            $table->morphs('tokenable');
            $table->text('name');
            $table->string('token', 64)->unique();
            $table->text('abilities')->nullable();
            $table->timestamp('last_used_at')->nullable();
            $table->timestamp('expires_at')->nullable()->index();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('personal_access_tokens');
    }
};


=== FILE: database\migrations\2025_10_06_144819_create_costumes_table.php ===

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('costumes', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->constrained()->onDelete('cascade'); 
            $table->string('name');
            $table->string('series');
            $table->string('size');
            $table->string('condition');
            $table->unsignedBigInteger('price_per_day');
            $table->integer('stock')->default(1);
            $table->string('main_image_path');
            $table->boolean('is_approved')->default(false); 
            $table->json('tags')->nullable();
            $table->timestamps();
            $table->softDeletes(); 
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('costumes');
    }
};

=== FILE: database\migrations\2025_10_06_144823_create_orders_table.php ===

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('orders', function (Blueprint $table) {
            $table->id();
            $table->string('order_code')->unique();
            $table->foreignId('costume_id')->constrained()->onDelete('cascade');
            $table->foreignId('user_id')->constrained()->onDelete('cascade'); // Customer/User ID
            $table->date('start_date');
            $table->date('end_date');
            $table->unsignedBigInteger('total_price');
            $table->enum('status', ['waiting', 'confirmed', 'borrowed', 'returned', 'completed', 'rejected'])->default('waiting');
            $table->timestamps();
            $table->softDeletes();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('orders');
    }
};

=== FILE: database\migrations\2025_10_06_153558_add_details_to_users_table.php ===

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::table('users', function (Blueprint $table) {
            $table->string('phone_number')->nullable();
            $table->text('address')->nullable();
            $table->string('profile_picture')->nullable();
        });
    }

    public function down(): void
    {
        Schema::table('users', function (Blueprint $table) {
            $table->dropColumn(['phone_number', 'address', 'profile_picture']);
        });
    }
};

=== FILE: database\migrations\2025_10_06_154025_create_renter_stores_table.php ===

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('renter_stores', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->unique()->constrained()->onDelete('cascade'); // Links to Renter user
            $table->string('store_name')->unique();
            $table->text('description')->nullable();
            $table->string('store_logo_path')->nullable();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('renter_stores');
    }
};

=== FILE: database\migrations\2025_10_15_153135_create_global_discounts_table.php ===

<?php

// database/migrations/*_create_global_discounts_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('global_discounts', function (Blueprint $table) {
            $table->id();
            // Store discount as a percentage (e.g., 0.15 for 15%)
            $table->decimal('rate', 4, 2)->default(0.00);
            $table->boolean('is_active')->default(false);
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('global_discounts');
    }
};

=== FILE: database\migrations\2025_10_18_153106_create_catalog_banners_table.php ===

<?php

// database/migrations/*_create_catalog_banners_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up(): void
    {
        Schema::create('catalog_banners', function (Blueprint $table) {
            $table->id();
            $table->string('title');
            $table->string('image_path')->nullable(); 
            $table->integer('order')->unique();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('catalog_banners');
    }
};

=== FILE: database\seeders\BannerSeeder.php ===

<?php

// database/seeders/BannerSeeder.php

namespace Database\Seeders;

use App\Models\CatalogBanner;
use Illuminate\Database\Seeder;

class BannerSeeder extends Seeder
{
    public function run(): void
    {
        CatalogBanner::firstOrCreate(['order' => 1], [
            'title' => 'Anime & Manga Discount!',
            'image_path' => 'banners/1.jpg',
        ]);
        CatalogBanner::firstOrCreate(['order' => 2], [
            'title' => 'Movie & TV Event Savings!',
            'image_path' => 'banners/2.jpg',
        ]);
        CatalogBanner::firstOrCreate(['order' => 3], [
            'title' => 'Game Character Sale!',
            'image_path' => 'banners/3.jpg',
        ]);
    }
}

=== FILE: database\seeders\DatabaseSeeder.php ===

<?php

namespace Database\Seeders;

use App\Models\User;
use App\Models\Costume;
use App\Models\Order;
use App\Models\RenterStore;
use Illuminate\Database\Seeder;
use Spatie\Permission\Models\Role;
use Carbon\Carbon; // Added for orders

class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        // --- 1. SETUP ROLES AND BASE USERS ---
        Role::firstOrCreate(['name' => 'owner']);
        Role::firstOrCreate(['name' => 'admin']);
        Role::firstOrCreate(['name' => 'renter']);
        Role::firstOrCreate(['name' => 'user']);

        $FILE_PATHS = [
            'owner_avatar' => 'user_profiles/3.png',
            'admin_avatar' => 'user_profiles/3.png',
            'user_avatar' => 'user_profiles/2.png',
            'renter1_avatar' => 'user_profiles/4.png',
            'renter2_avatar' => 'user_profiles/5.png',
            'renter3_avatar' => 'user_profiles/1.png',
        ];

        User::firstOrCreate(['email' => 'owner@starium.test'], [
            'name' => 'Owner Boss', // Renamed for clarity, since they are the owner now
            'password' => bcrypt('password'),
            'profile_picture' => $FILE_PATHS['owner_avatar'],
        ])->assignRole('owner'); // <--- NOW THEY ARE THE OWNER!

        User::firstOrCreate(['email' => 'admin@starium.test'], [
            'name' => 'Admin Boss',
            'password' => bcrypt('password'),
            'profile_picture' => $FILE_PATHS['admin_avatar'],
        ])->assignRole('admin');

        $user = User::firstOrCreate(['email' => 'user@starium.test'], [
            'name' => 'Regular User',
            'password' => bcrypt('password'),
            'profile_picture' => $FILE_PATHS['user_avatar'],
        ])->assignRole('user');


        // --- 2. CREATE MULTIPLE RENTER USERS & STORES ---
        $rentersData = [
            [
                'user' => [
                    'name' => 'Captain Cosmic',
                    'email' => 'renter1@starium.test',
                    'phone_number' => '0811-1234-5678',
                    'address' => 'Andromeda Galaxy Hub 1',
                    'profile_picture' => 'user_profiles/4.png',
                ],
                'store' => [
                    'name' => 'Cosmic Threads',
                    'description' => 'The largest collection of space and sci-fi costumes!',
                    'logo' => 'store_logos/cosmicthreads.png',
                ],
                'costumes' => [
                    ['name' => 'Star Lord Helmet Jacket', 'series' => 'Guardians of Galaxy', 'price' => 120000, 'tags' => ['Movie', 'Star Lord', 'Sci-Fi']],
                    ['name' => 'Gundam Pilot Suit', 'series' => 'Mobile Suit Gundam', 'price' => 95000, 'tags' => ['Anime', 'Gundam', 'Mecha']],
                    ['name' => 'Flash Speedster Suit', 'series' => 'DC Comics', 'price' => 110000, 'tags' => ['Movie', 'Flash', 'Superhero']],
                    ['name' => 'Alien Xenomorph Suit', 'series' => 'Alien', 'price' => 150000, 'tags' => ['Movie', 'Xenomorph', 'Horror']],
                    ['name' => 'Jedi Knight Robes', 'series' => 'Star Wars', 'price' => 60000, 'tags' => ['Movie', 'Jedi', 'Fantasy']],
                    ['name' => 'Master Chief Armor', 'series' => 'Halo', 'price' => 130000, 'tags' => ['Game', 'Master Chief', 'Armor']],
                    ['name' => 'EVA Unit-01 Plugsuit', 'series' => 'Evangelion', 'price' => 105000, 'tags' => ['Anime', 'Shinji', 'Mecha']],
                ],
            ],
            [
                'user' => [
                    'name' => 'Princess Aurora',
                    'email' => 'renter2@starium.test',
                    'phone_number' => '0822-9876-5432',
                    'address' => 'Nebula Cluster HQ 7',
                    'profile_picture' => 'user_profiles/5.png',
                ],
                'store' => [
                    'name' => 'Fairy Dust Rentals',
                    'description' => 'Fantasy, magic, and royal attire for all your event needs.',
                    'logo' => 'store_logos/fairydustrentals.png',
                ],
                'costumes' => [
                    ['name' => 'Sailor Moon Uniform', 'series' => 'Sailor Moon', 'price' => 50000, 'tags' => ['Anime', 'Sailor Moon', 'Magical Girl']],
                    ['name' => 'Elsa Ice Dress', 'series' => 'Frozen', 'price' => 70000, 'tags' => ['Movie', 'Elsa', 'Princess']],
                    ['name' => 'Genshin Impact (Focalors)', 'series' => 'Genshin Impact', 'price' => 85000, 'tags' => ['Game', 'Focalors', 'Fantasy']],
                    ['name' => 'Witcher Geralt Armor', 'series' => 'The Witcher', 'price' => 90000, 'tags' => ['Game', 'Geralt', 'Fantasy']],
                    ['name' => 'Cinderella Ball Gown', 'series' => 'Cinderella', 'price' => 80000, 'tags' => ['Movie', 'Cinderella', 'Princess']],
                    ['name' => 'T-Rex Kigurumi', 'series' => 'Jurassic Park', 'price' => 45000, 'tags' => ['Other', 'T-Rex', 'Funny']], // Changed series to give it a media context
                    ['name' => 'Daenerys Targaryen Gown', 'series' => 'Game of Thrones', 'price' => 115000, 'tags' => ['TV', 'Daenerys', 'Fantasy']],
                ],
            ],
            [
                'user' => [
                    'name' => 'The Anime King',
                    'email' => 'renter3@starium.test',
                    'phone_number' => '0833-1122-3344',
                    'address' => 'Tokyo-3 Outpost 5',
                    'profile_picture' => 'user_profiles/1.png',
                ],
                'store' => [
                    'name' => 'Weeb Central',
                    'description' => 'The hottest anime and manga threads in the Milky Way!',
                    'logo' => 'store_logos/weebcentral.png',
                ],
                'costumes' => [
                    ['name' => 'Naruto Hokage Outfit', 'series' => 'Naruto', 'price' => 70000, 'tags' => ['Anime', 'Naruto', 'Ninja']],
                    ['name' => 'Attack on Titan Uniform', 'series' => 'Attack on Titan', 'price' => 60000, 'tags' => ['Anime', 'Eren', 'Military']],
                    ['name' => 'Demon Slayer Tanjiro Kimono', 'series' => 'Demon Slayer', 'price' => 65000, 'tags' => ['Anime', 'Tanjiro', 'Kimono']],
                    ['name' => 'One Piece Luffy Gear 5', 'series' => 'One Piece', 'price' => 125000, 'tags' => ['Anime', 'Luffy', 'Shonen']],
                    ['name' => 'Kirito Black Swordsman', 'series' => 'Sword Art Online', 'price' => 75000, 'tags' => ['Anime', 'Kirito', 'Game']],
                    ['name' => 'Fullmetal Alchemist Uniform', 'series' => 'Fullmetal Alchemist', 'price' => 80000, 'tags' => ['Anime', 'Edward', 'Military']],
                    ['name' => 'Lelouch Lamperouge Zero', 'series' => 'Code Geass', 'price' => 100000, 'tags' => ['Anime', 'Lelouch', 'Uniform']],
                ],
            ],
        ];

        foreach ($rentersData as $data) {
            $renter = User::firstOrCreate(
                ['email' => $data['user']['email']],
                array_merge($data['user'], ['password' => bcrypt('password')])
            );
            $renter->assignRole('renter');

            RenterStore::firstOrCreate(
                ['user_id' => $renter->id],
                [
                    'store_name' => $data['store']['name'],
                    'description' => $data['store']['description'],
                    'store_logo_path' => $data['store']['logo'],
                ]
            );

            foreach ($data['costumes'] as $costumeData) {
                $imageName = 'costumes/' . str_replace([' ', '&', '(', ')'], ['_', '', '', ''], strtolower($costumeData['name'])) . '.jpg';

                Costume::firstOrCreate(
                    ['name' => $costumeData['name']],
                    [
                        'user_id' => $renter->id,
                        'series' => $costumeData['series'],
                        'size' => 'M',
                        'condition' => 'Excellent',
                        'price_per_day' => $costumeData['price'],
                        'stock' => 1,
                        'main_image_path' => $imageName,
                        'is_approved' => true,
                        'tags' => $costumeData['tags'],
                    ]
                );
            }
        }

        // --- 3. CREATE PENDING COSTUMES FOR APPROVAL ---
        $pendingCostumesData = [
            ['user_id' => 4, 'name' => 'Deadpool Suit', 'series' => 'Marvel', 'price' => 150000, 'tags' => ['Movie', 'Deadpool', 'Anti-Hero']],
            ['user_id' => 4, 'name' => 'Space Marine Armor', 'series' => 'Warhammer 40k', 'price' => 200000, 'tags' => ['Game', 'Space Marine', 'Armor']],

            ['user_id' => 5, 'name' => 'Alice in Wonderland Dress', 'series' => 'Disney', 'price' => 70000, 'tags' => ['Movie', 'Alice', 'Fantasy']],
            ['user_id' => 5, 'name' => 'Belle Ball Gown', 'series' => 'Beauty and the Beast', 'price' => 90000, 'tags' => ['Movie', 'Belle', 'Princess']],

            ['user_id' => 6, 'name' => 'Ichigo Bankai', 'series' => 'Bleach', 'price' => 110000, 'tags' => ['Anime', 'Ichigo', 'Shonen']],
            ['user_id' => 6, 'name' => 'Goku Ultra Instinct', 'series' => 'Dragon Ball', 'price' => 130000, 'tags' => ['Anime', 'Goku', 'Shonen']],
        ];

        foreach ($pendingCostumesData as $costumeData) {
            $imageName = 'costumes/' . str_replace([' ', '&', '(', ')'], ['_', '', '', ''], strtolower($costumeData['name'])) . '.jpg';

            Costume::firstOrCreate(['name' => $costumeData['name']], [
                'user_id' => $costumeData['user_id'],
                'series' => $costumeData['series'],
                'size' => 'M',
                'condition' => 'New',
                'price_per_day' => $costumeData['price'],
                'stock' => 1,
                'main_image_path' => $imageName,
                'is_approved' => false,
                'tags' => $costumeData['tags'],
            ]);
        }

        // --- 3. CREATE DUMMY ORDERS ---
        $statuses = ['waiting', 'confirmed', 'borrowed', 'returned', 'completed', 'rejected'];
        $orderCounter = 1;
        $customer = User::where('email', 'user@starium.test')->first();

        if ($customer) {
            $renters = User::role('renter')->get();

            foreach ($renters as $renter) {
                $costumes = $renter->costumes;
                if ($costumes->isEmpty()) {
                    continue;
                }

                foreach ($statuses as $status) {
                    $costume = $costumes->get(($orderCounter - 1) % $costumes->count());

                    // Define dates based on status
                    switch ($status) {
                        case 'completed':
                            $start = Carbon::now()->subMonths(1)->startOfMonth()->subDays(5);
                            $end = $start->copy()->addDays(5);
                            break;
                        case 'returned':
                            $start = Carbon::now()->subWeeks(1)->subDays(3);
                            $end = $start->copy()->addDays(7);
                            break;
                        case 'borrowed':
                            $start = Carbon::now()->subDays(2);
                            $end = Carbon::now()->addDays(5);
                            break;
                        case 'confirmed':
                            $start = Carbon::now()->addDays(5);
                            $end = $start->copy()->addDays(3);
                            break;
                        case 'waiting':
                            $start = Carbon::now()->addDays(15);
                            $end = $start->copy()->addDays(2);
                            break;
                        case 'rejected':
                            $start = Carbon::now()->subMonths(2);
                            $end = $start->copy()->addDays(4);
                            break;
                        default:
                            $start = Carbon::now();
                            $end = $start->copy()->addDays(3);
                    }

                    $duration = $start->diffInDays($end) + 1;
                    $totalPrice = $costume->price_per_day * $duration;

                    Order::firstOrCreate(['order_code' => 'ORD-' . str_pad($orderCounter, 3, '0', STR_PAD_LEFT)], [
                        'costume_id' => $costume->id,
                        'user_id' => $customer->id,
                        'start_date' => $start,
                        'end_date' => $end,
                        'total_price' => $totalPrice,
                        'status' => $status,
                    ]);

                    $orderCounter++;
                }
            }
        }

        $this->call(BannerSeeder::class); // Assuming you made one

        // NEW: Call Permission Seeder before other seeds to ensure roles exist
        $this->call(PermissionSeeder::class);
    }
}

=== FILE: database\seeders\PermissionSeeder.php ===

<?php
// database/seeders/PermissionSeeder.php (NEW)

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use Spatie\Permission\Models\Role;
use Spatie\Permission\Models\Permission;

class PermissionSeeder extends Seeder
{
    public function run()
    {
        // Reset cached roles and permissions
        app()[\Spatie\Permission\PermissionRegistrar::class]->forgetCachedPermissions();

        // 1. Define Permissions
        $permissions = [
            // RENTER PERMISSIONS (Base Functionality)
            'costume:create',
            'costume:edit-own',
            'costume:delete-own',
            'order:confirm-reject',
            'order:update-status',

            // ADMIN PERMISSIONS (Oversight and Moderation)
            'costume:approve-reject',
            'costume:edit-all',
            'costume:delete-all',
            'analytics:view-renter',
            'discount:manage-global',
            'user:edit-renter-user', // Can edit Renter/User profiles

            // OWNER PERMISSIONS (God Mode)
            'user:manage-roles', // Can change any user's role
            'platform:view-global-kpis',
            'platform:manage-banners',
        ];

        foreach ($permissions as $permission) {
            Permission::firstOrCreate(['name' => $permission]);
        }

        // 2. Assign Permissions to Roles

        $owner = Role::where('name', 'owner')->first();
        $admin = Role::where('name', 'admin')->first();
        $renter = Role::where('name', 'renter')->first();
        $user = Role::where('name', 'user')->first();

        // OWNER: All Permissions (God Mode)
        $owner->givePermissionTo(Permission::all());

        // ADMIN: Moderation and Oversight
        $admin->givePermissionTo([
            'costume:approve-reject',
            'costume:edit-all',
            'costume:delete-all',
            'analytics:view-renter',
            'discount:manage-global',
            'user:edit-renter-user',
            'platform:view-global-kpis',
            'platform:manage-banners',
        ]);

        // RENTER: Costume Management
        $renter->givePermissionTo([
            'costume:create',
            'costume:edit-own',
            'costume:delete-own',
            'order:confirm-reject',
            'order:update-status',
        ]);

        // USER: No special permissions (can only view and order)
    }
}

=== FILE: .env ===

APP_NAME="Starium Cosplay Rental"
APP_ENV=local
APP_KEY=base64:aoU8r9C/BtYJV5EJoJW27M7y6htU6lLcuy+Dd5hLT0s=
APP_DEBUG=true
APP_URL=http://localhost

APP_LOCALE=en
APP_FALLBACK_LOCALE=en
APP_FAKER_LOCALE=en_US

APP_MAINTENANCE_DRIVER=file
# APP_MAINTENANCE_STORE=database

PHP_CLI_SERVER_WORKERS=4

BCRYPT_ROUNDS=12

LOG_CHANNEL=stack
LOG_STACK=single
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=project_2023130007
DB_USERNAME=root
DB_PASSWORD=4090

SESSION_DRIVER=database
SESSION_LIFETIME=120
SESSION_ENCRYPT=false
SESSION_PATH=/
SESSION_DOMAIN=null

BROADCAST_CONNECTION=log
FILESYSTEM_DISK=local
QUEUE_CONNECTION=database

CACHE_STORE=database
# CACHE_PREFIX=

MEMCACHED_HOST=127.0.0.1

REDIS_CLIENT=phpredis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

MAIL_MAILER=log
MAIL_SCHEME=null
MAIL_HOST=127.0.0.1
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_FROM_ADDRESS="hello@example.com"
MAIL_FROM_NAME="${APP_NAME}"

AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=
AWS_USE_PATH_STYLE_ENDPOINT=false

VITE_APP_NAME="${APP_NAME}"


=== FILE: .env.example ===

APP_NAME=Laravel
APP_ENV=local
APP_KEY=
APP_DEBUG=true
APP_URL=http://localhost

APP_LOCALE=en
APP_FALLBACK_LOCALE=en
APP_FAKER_LOCALE=en_US

APP_MAINTENANCE_DRIVER=file
# APP_MAINTENANCE_STORE=database

PHP_CLI_SERVER_WORKERS=4

BCRYPT_ROUNDS=12

LOG_CHANNEL=stack
LOG_STACK=single
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug

DB_CONNECTION=sqlite
# DB_HOST=127.0.0.1
# DB_PORT=3306
# DB_DATABASE=laravel
# DB_USERNAME=root
# DB_PASSWORD=

SESSION_DRIVER=database
SESSION_LIFETIME=120
SESSION_ENCRYPT=false
SESSION_PATH=/
SESSION_DOMAIN=null

BROADCAST_CONNECTION=log
FILESYSTEM_DISK=local
QUEUE_CONNECTION=database

CACHE_STORE=database
# CACHE_PREFIX=

MEMCACHED_HOST=127.0.0.1

REDIS_CLIENT=phpredis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

MAIL_MAILER=log
MAIL_SCHEME=null
MAIL_HOST=127.0.0.1
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_FROM_ADDRESS="hello@example.com"
MAIL_FROM_NAME="${APP_NAME}"

AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=
AWS_USE_PATH_STYLE_ENDPOINT=false

VITE_APP_NAME="${APP_NAME}"


=== FILE: composer.json ===

{
    "$schema": "https://getcomposer.org/schema.json",
    "name": "laravel/laravel",
    "type": "project",
    "description": "The skeleton application for the Laravel framework.",
    "keywords": ["laravel", "framework"],
    "license": "MIT",
    "require": {
        "php": "^8.2",
        "laravel/framework": "^12.0",
        "laravel/sanctum": "^4.2",
        "laravel/tinker": "^2.10.1",
        "mews/captcha": "^3.4",
        "spatie/laravel-permission": "^6.21"
    },
    "require-dev": {
        "fakerphp/faker": "^1.23",
        "laravel/breeze": "^2.3",
        "laravel/pail": "^1.2.2",
        "laravel/pint": "^1.24",
        "laravel/sail": "^1.41",
        "mockery/mockery": "^1.6",
        "nunomaduro/collision": "^8.6",
        "phpunit/phpunit": "^11.5.3"
    },
    "autoload": {
        "psr-4": {
            "App\\": "app/",
            "Database\\Factories\\": "database/factories/",
            "Database\\Seeders\\": "database/seeders/"
        }
    },
    "autoload-dev": {
        "psr-4": {
            "Tests\\": "tests/"
        }
    },
    "scripts": {
        "post-autoload-dump": [
            "Illuminate\\Foundation\\ComposerScripts::postAutoloadDump",
            "@php artisan package:discover --ansi"
        ],
        "post-update-cmd": [
            "@php artisan vendor:publish --tag=laravel-assets --ansi --force"
        ],
        "post-root-package-install": [
            "@php -r \"file_exists('.env') || copy('.env.example', '.env');\""
        ],
        "post-create-project-cmd": [
            "@php artisan key:generate --ansi",
            "@php -r \"file_exists('database/database.sqlite') || touch('database/database.sqlite');\"",
            "@php artisan migrate --graceful --ansi"
        ],
        "pre-package-uninstall": [
            "Illuminate\\Foundation\\ComposerScripts::prePackageUninstall"
        ],
        "dev": [
            "Composer\\Config::disableProcessTimeout",
            "npx concurrently -c \"#93c5fd,#c4b5fd,#fb7185,#fdba74\" \"php artisan serve\" \"php artisan queue:listen --tries=1\" \"php artisan pail --timeout=0\" \"npm run dev\" --names=server,queue,logs,vite --kill-others"
        ],
        "test": [
            "@php artisan config:clear --ansi",
            "@php artisan test"
        ]
    },
    "extra": {
        "laravel": {
            "dont-discover": []
        }
    },
    "config": {
        "optimize-autoloader": true,
        "preferred-install": "dist",
        "sort-packages": true,
        "allow-plugins": {
            "pestphp/pest-plugin": true,
            "php-http/discovery": true
        }
    },
    "minimum-stability": "stable",
    "prefer-stable": true
}


=== FILE: package.json ===

{
    "$schema": "https://json.schemastore.org/package.json",
    "private": true,
    "type": "module",
    "scripts": {
        "build": "vite build",
        "dev": "vite"
    },
    "devDependencies": {
        "@tailwindcss/forms": "^0.5.2",
        "@tailwindcss/vite": "^4.0.0",
        "alpinejs": "^3.4.2",
        "autoprefixer": "^10.4.2",
        "axios": "^1.11.0",
        "concurrently": "^9.0.1",
        "laravel-vite-plugin": "^2.0.0",
        "postcss": "^8.4.31",
        "tailwindcss": "^3.1.0",
        "vite": "^7.0.7"
    }
}
